{"instruction": "PTN-VP和VC性能查看方法。业务开通或故障分析", "input": "", "output": "案例主题:PTN-VP和VC性能查看方法\n案例编号:AL201909292931\n网络场景:PTN设备组网业务的VP和VC性能的查看，一个端口配置了多条基于VLAN的业务时无法直接通过端口收发包情况来分析特定VLAN业务收发包情况。\n现象描述:业务开通或故障分析\n处理过程:单盘收发包与端口对应关系：\nVP层接收流量=NNI口到SYS口方向流量；VP层发送流量=SYS口到NNI口方向流量。\nVC层接收流量=SYS口到UNI口方向流量；VC层发送流量=UNI口到SYS口方向流量。\n虚通道就是VC 虚通路就是tunnel\n性能查看位置：\nPTN 640：VP、VC性能均在交叉盘中查看\nPTN 660:下框业务：VP性能在NNI侧单盘查看、VC性能在UNI端口所在单盘查看\n上框业务：VP性能在NNI侧单盘查看，VC性能在交叉盘中查看\nPTN 680：VP性能在NNI侧单盘查看、VC性能在UNI端口所在单盘查看\nPTN 690：手动打开采集任务，在相应的线路盘查看VP/VC性能\nPTN 650：通过子网界面查看\n网管子网查看性能：选择tunnel/pw-->右键-->告警/性能查询-->查询当前性能\n \n640设备：\n根据tunnel id （vp虚通路号）对应数据转发情况\n在子网界面无法统计出对于的tunnel id 信息，因此需要通过查看单盘状态中的查看对应的ID，如图：\n\n图1 通过标签查找tunnel id\n\n图2 子网路由信息中的640设备的tunnel id一般对应LSP：XX\n对于下行业务，对应的ID为11，对于上行业务，对应的ID为12；在查看单盘性能：1）对于下行业务，对应的ID为11，对于上行业务，对应的ID为12；在查看单盘性能：\n\n图3 通过虚通路号查看性能\n根据PW ID（VC虚通道号）对应数据转发情况\n在子网和单盘状态PW变长信息中查看对应的ID信息，如图：\n\n图4 通过L2VPN查看PW id\n\n图5通过PW标签定位PW id\n\n图6 通过虚通道号查看性能\n对应VC的发送性能是业务从U口到SYS口方向数据，可以简单理解为VC从U口接收到数据包，转发至VP的性能（VP的发送）；VC的接收性能是从SYS口向U口方向数据，可以简单理解为VC从VP接收到数据包，转发至U口的性能（U口的发送）。\n660设备：\n根据tunnel id （vp虚通路号）对应数据转发情况\n通过单盘状态和子网tunnel路由信息均可获取VP虚通路号，如下图：\n\n图7 通过标签查找tunnel id\n\n图8 通过tunnel路由信息查找tunnel id\n在业务盘中查看性能：\n\n图9 通过虚通路号查看性能\n根据PW ID（VC虚通道号）对应数据转发情况\n通过L2VPN中路由信息获取PW ID：\n\n下框业务在业务盘查看VC性能，上框业务在交叉盘查看：\n\n680设备：\n根据tunnel id （逻辑口--VP）对应数据转发情况\n通业务获取tunnel id对应逻辑口--VP：825和逻辑口--VP：826：\n\n在线路盘查看VP性能：\n\n通过L2VPN中路由信息获取逻辑口--VC:4\n\n通过单盘状态可以获取VcId\n\n在业务单盘查看VC性能：（只能看到发送性能为正常，机制问题）\n\n690设备：\n690设备VP、VC的性能纯PTN设备是不一样的，默认是关的需要手动打开，通过tunnel/PW标签获取lsp-name/pw-name,左键网元-->性能-->网元性能开关-->采集对象设置，设置采集任务。\nVP：\n\n \n\nVC：\n\n \n\n在LSP的出口盘查看VP和VC的性能：\n\n\n \n650设备V3：\n通过tunnel/PW标签获取lsp-name/pw-name,左键网元-->性能-->网元性能开关-->采集对象设置，设置采集任务。\n通过网管子网界面查看性能：\n\n命令行查询：\nFH-C650#show performance-task all all //查询采集任务\nindex type object performance\n1 lsp lsp-name=218-5.230-2.7.1e10e9d0,path-type=primary ALL\n2 lsp lsp-name=218-5.230-2.8.1e10e9d0,path-type=primary ALL\n3 lsp lsp-name=230-2.218-5.1.1e10e9d0,path-type=primary ALL\n4 lsp lsp-name=230-2.218-5.2.1e10e9d0,path-type=primary ALL\n5 vpws-vc pw-name=218-5.230-2.4.1e10e9d1 ALL\nFH-C650#show ne-performance lsp lsp-name 218-5.230-2.7.1e10e9d0 path-type primary //VP\nFH-C650#show ne-performance vpws-vc pw-name 218-5.230-2.4.1e10e9d1 //VC\n根因:不涉及\r\n \n解决方案:不涉及\r\n \n原因分类:无\n"}
{"instruction": "650U3MAC LOSS issue。1．How to Analyzing the MAC/SN loss issue or not\n1)    telnet device and use command show arp all\n\nCheck the ARP table is correct or not and also check the ARP type. If only Dynamic and Static type , but no interface type. Then go next step.\n2)    Check equipment version. If equipment is under V3 version, then go next step.\n3)    Check in OS layer. Use eepromMsgGet command to display the equipment local MAC information.\n\n\n\n\nCommand\n\n\nMeaning\n\n\n\n\neepromMsgGet 32\n\n\nshow SN\n\n\n\n\neepromMsgGet 96\n\n\nshow ESN(E-labe)\n\n\n\n\neepromMsgGet 97\n\n\nShow local MAC\n\n\n\n\neepromMsgGet 98\n\n\nshow MAC mask\n\n\n\n\nIf any command gives empty or incorrect feedback, the issue can be confirmed as MAC/SN loss. NOC need to rewrite the respective parameters.", "input": "", "output": "案例主题:650U3MAC LOSS issue\n案例编号:AL201910173231\n网络场景:650U3 may have MAC setting issue when manufactured\r\n \n现象描述:1．How to Analyzing the MAC/SN loss issue or not\n1)    telnet device and use command show arp all\n\nCheck the ARP table is correct or not and also check the ARP type. If only Dynamic and Static type , but no interface type. Then go next step.\n2)    Check equipment version. If equipment is under V3 version, then go next step.\n3)    Check in OS layer. Use eepromMsgGet command to display the equipment local MAC information.\n\n\n\n\nCommand\n\n\nMeaning\n\n\n\n\neepromMsgGet 32\n\n\nshow SN\n\n\n\n\neepromMsgGet 96\n\n\nshow ESN(E-labe)\n\n\n\n\neepromMsgGet 97\n\n\nShow local MAC\n\n\n\n\neepromMsgGet 98\n\n\nshow MAC mask\n\n\n\n\nIf any command gives empty or incorrect feedback, the issue can be confirmed as MAC/SN loss. NOC need to rewrite the respective parameters.\n处理过程:Solving the MAC/SN loss issue\n1)    Local team supporting\nFH product was labeled once it was manufactured from factory. The MAC information was included and can be easily found on the subrack.\n\nLike above picture showing,\nFirst line :160495560156 is device SN\nSecond line :48-F9-7C-53-0B-00 is device MAC\nAnd last line:1.25.148.1 is device ESN\n \n2)   Rewrite the lost parameter\nUse command eepromMsgSet to write lost parameter according to the label attached. While setting, need follow the bellowing principle.\nAfter setting each parameter, please use eepromMsgGet to check and confirm\na.Write SN\nAdding number 3 in front of every number.\nIf SN is 160495560156,\nThe command should be: eepromMsgSet 32 313630343935353630313536.\n \nb.Write ESN\nAdding 3 in front of every number, replace every dot use 2e.\nIf ESN is 1.25.148.1\nThe command should be: eepromMsgSet 96 312e32352e3134382e31\n \nc.Write MAC\nMAC can be directly set\nIf MAC is 48-F9-7C-53-0B-00\nThe command should be: eepromMsgSet 97 48f97c530b00\n \nd.Write MAC mask\nMAC mask can only be set as 30\nThe command should be: eepromMsgSet 98 30\n \n3)   Reboot all system\nAfter confirming setting parameters, power off and power on the equipment. Wait till it stable.\n \n\nCheck and Confirm \nWait till it stable and use eepromMsgGet to check every parameters also use show arp all to confirm CLI layer\n根因:650U3 may have MAC setting issue when manufactured\n解决方案:setting MAC configuration again\r\n \n原因分类:无\n"}
{"instruction": "V210R230T01版本升级至V210R230T02版本加密方式的变化，导致设备无法登陆。软件版本升级至V210R230T02_20190904后发现设备无法登陆，经排查是由于加密方式变化导致密码改变。\n ", "input": "", "output": "案例主题:V210R230T01版本升级至V210R230T02版本加密方式的变化，导致设备无法登陆\n案例编号:AL201911143741\n网络场景:S7800系列交换机软件版本由V210R230T01版本升级至V210R230T02_20190904版本.\n现象描述:软件版本升级至V210R230T02_20190904后发现设备无法登陆，经排查是由于加密方式变化导致密码改变。\n \n处理过程:S7800交换机采用tacacs认证，SSH登陆的方式。\n升级前的配置关于登陆的相关配置如下：\n username admin group administrators password 87ddfc083a9bbc0cf481946fdff80a80\r\n username sd-noc group operators password 87ddfc083a9bbc0cf481946fdff80a80\r\n username sd-noc domain ssh\r\n username lyread group guests password bccd1f7145cd8d77d899db42f65ed751\r\n username lyread domain ssh\r\n!\r\n sshd\r\n no sshd auth pubkey\r\n ssh login authentication aaa method tac-au1 auth-type pap\r\n!\r\n snmp community 02eed27f71d582be ro view internet\r\n!\r\n aaa\r\n tacacs-server tac-server1 ip-address 60.217.43.86 key Unacs@12 port 49 single-connection disable\r\n tacacs-server tac-server1 src-ip 218.57.196.234\r\n tacacs-server tac-server2 ip-address 60.217.43.78 key Unacs@12 port 49 single-connection disable\r\n tacacs-server tac-server2 src-ip 218.57.196.234\r\n server-group tac-login tacacs-server tac-server1\r\n server-group tac-login tacacs-server tac-server2\r\n aaa authentication login method tac-au1 server-group tac-login local\r\n aaa authorization method tac-au2 server-group tac-login local\r\n aaa account login method tac-au3 server-group tac-login local\r\n!\r\nline vty 1 10\r\n login authentication aaa method tac-au1 auth-type pap\r\n login account aaa method tac-au3\r\n login authorization aaa method tac-au2\n \n可以发现tacacs-server的key是明文的\n \n升级前后的对比变化和处理方式如下：\n \n升级前tacacs配置（明文显示）\ntacacs-server tac-server1 ip-address 60.217.43.86 key Unacs@12 port 49 single-connection disable\r\ntacacs-server tac-server2 ip-address 60.217.43.78 key Unacs@12 port 49 single-connection disable\n\r\n升级后tacacs配置（密文显示，但应该不是Unacs@12的密文）\n tacacs-server tac-server1 ip-address 60.217.43.86 key efacef1200000000\r\n tacacs-server tac-server2 ip-address 60.217.43.78 key efacef1200000000\n \n重新配置key  Unacs@12，正确的密文显示如下，重新配置后可以正常ssh tacacs认证登陆设备\r\ntacacs-server tac-server1 ip-address 60.217.43.86 key 0ed880ca2b386f4e\r\ntacacs-server tac-server2 ip-address 60.217.43.78 key 0ed880ca2b386f4e \n \nsnmp community的密文，本地账号的密码的密文与升级前也不一致，也对这些进行了重新配置。\n \n升级前本地账号密码\nusername admin group administrators password 87ddfc083a9bbc0cf481946fdff80a80\r\nusername admin reauth-interval 0\r\nusername sd-noc group operators password 87ddfc083a9bbc0cf481946fdff80a80\r\nusername sd-noc domain ssh\r\nusername lyread group guests password bccd1f7145cd8d77d899db42f65ed751\r\nusername lyread domain ssh\r\nuser privilege level administrators password 306b6341993337d4\r\nuser privilege level operators password 306b6341993337d4\r\nuser privilege level users password 306b6341993337d4\r\nuser privilege level guests password 306b6341993337d4\r\n升级后本地账号密码\r\nusername admin group administrators password $21$kijv$87ddfc083a9bbc0cf481946fdff80a80\r\nusername admin reauth-interval 0\r\nusername sd-noc group operators password $21$kijv$87ddfc083a9bbc0cf481946fdff80a80\r\nusername sd-noc domain ssh\r\nusername lyread group guests password $21$kijv$bccd1f7145cd8d77d899db42f65ed751\r\nusername lyread domain ssh\r\nuser privilege level administrators password $9$kijv$e7015e4ca31c3ae839aa564bc4b0f361\r\nuser privilege level operators password $9$kijv$e7015e4ca31c3ae839aa564bc4b0f361\r\nuser privilege level users password $9$kijv$e7015e4ca31c3ae839aa564bc4b0f361\r\nuser privilege level guests password $9$kijv$e7015e4ca31c3ae839aa564bc4b0f361\n \n升级前snmp community\n\r\nsnmp community 02eed27f71d582be ro view internet \n\r\n升级后snmp community\n\r\nsnmp community $9$kijv$277d8f2fbfc2763fa4b92e0dd8ccc4a3 ro cipher view internet\n根因:早期版本和现在T02版本中加密的实现方式发生了变化，所以这种不同加密方式的版本之间升级会造成密码识别不出来，进而升级之后密码错误，会影响所有带密码的命令行，包括但不限于user、snmp community、aaa等模块。\n解决方案:1、若采用本地升级的方式，将相关的密码配置备份，在升级完成后重新进行配置即可；\n2、若采用远程升级的方式，需要将认证方式更改为本地认证，并打开telnet服务，确认设备能够正常的telnet登陆，并保存配置。设备重启后T02版本生效，使用super密码登陆设备，将user、snmp community、aaa等密码重新进行配置，配置完毕确认能够正常登陆后，认证方式和登陆方式更改为原来的方式，并进行验证确认。\n原因分类:无\n"}
{"instruction": "光层控平网络、SPC OCH、EOSC机盘故障。1、通过网管SPC倒换日志发现，存在大量的SPC OCH重路由，通过日志转换，均为5号节点，对1号节点方向线路故障导致；\n方法：通过将故障节点号、故障链路号转化为16进制数，可以定位故障段落；\n2、5号节点频繁上报DBL_FAIL告警\n\n\n\nSwitch Time\n故障节点号\n故障链路号\n16进制故障节点号\n16进制故障链路号\n\n\n2019-11-23 19:23:07\n168953097\n287768576\nA120509\n11270000\n\n\n2019-11-23 19:22:19\n168953097\n287768576\nA120509\n11270000\n\n\n2019-11-23 19:22:15\n168953097\n287768576\nA120509\n11270000\n\n\n2019-11-23 19:22:15\n168953097\n287768576\nA120509\n11270000\n\n\n2019-11-23 19:22:15\n168953097\n287768576\nA120509\n11270000\n\n\n2019-11-23 19:22:15\n168953097\n287768576\nA120509\n11270000\n\n\n2019-11-23 19:21:59\n168953097\n287768576\nA120509\n11270000\n\n\n2019-11-23 19:21:27\n168953097\n287768576\nA120509\n11270000\n\n\n2019-11-23 19:20:50\n168953097\n287768576\nA120509\n11270000\n\n\n2019-11-23 19:20:50\n168953097\n287768576\nA120509\n11270000\n\n\n2019-11-23 19:20:50\n168953097\n287768576\nA120509\n11270000\n\n\n2019-11-23 19:01:06\n168953097\n287768576\nA120509\n11270000\n\n\n2019-11-23 19:00:44\n168953097\n287768576\nA120509\n11270000\n\n\n2019-11-23 19:00:40\n168953097\n287768576\nA120509\n11270000\n\n\n2019-11-23 19:00:40\n168953097\n287768576\nA120509\n11270000\n\n\n\n", "input": "", "output": "案例主题:光层控平网络、SPC OCH、EOSC机盘故障\n案例编号:AL201911263942\n网络场景:\r\n \n        某光层控平5号节点，频繁上报DBL_FAIL告警，导致从1号至5号的SPC OCH频繁发生重路由；\n \n\n现象描述:1、通过网管SPC倒换日志发现，存在大量的SPC OCH重路由，通过日志转换，均为5号节点，对1号节点方向线路故障导致；\n方法：通过将故障节点号、故障链路号转化为16进制数，可以定位故障段落；\n2、5号节点频繁上报DBL_FAIL告警\n\n\n\nSwitch Time\n故障节点号\n故障链路号\n16进制故障节点号\n16进制故障链路号\n\n\n2019-11-23 19:23:07\n168953097\n287768576\nA120509\n11270000\n\n\n2019-11-23 19:22:19\n168953097\n287768576\nA120509\n11270000\n\n\n2019-11-23 19:22:15\n168953097\n287768576\nA120509\n11270000\n\n\n2019-11-23 19:22:15\n168953097\n287768576\nA120509\n11270000\n\n\n2019-11-23 19:22:15\n168953097\n287768576\nA120509\n11270000\n\n\n2019-11-23 19:22:15\n168953097\n287768576\nA120509\n11270000\n\n\n2019-11-23 19:21:59\n168953097\n287768576\nA120509\n11270000\n\n\n2019-11-23 19:21:27\n168953097\n287768576\nA120509\n11270000\n\n\n2019-11-23 19:20:50\n168953097\n287768576\nA120509\n11270000\n\n\n2019-11-23 19:20:50\n168953097\n287768576\nA120509\n11270000\n\n\n2019-11-23 19:20:50\n168953097\n287768576\nA120509\n11270000\n\n\n2019-11-23 19:01:06\n168953097\n287768576\nA120509\n11270000\n\n\n2019-11-23 19:00:44\n168953097\n287768576\nA120509\n11270000\n\n\n2019-11-23 19:00:40\n168953097\n287768576\nA120509\n11270000\n\n\n2019-11-23 19:00:40\n168953097\n287768576\nA120509\n11270000\n\n\n\n\n处理过程:1、定位故障段落，通过网管的SPC倒换日志，定位1号节点与5号节点之间存在问题；\n2、5号节点频繁上报DBL_FAIL,说明5号节点的收监测到重路由条件的事件；\n3、查询1号节点至5号节点中间的EOSC告警，无异常告警上报-RLOS/RLOF/OSC-SD/OSC_AIS/IOP_LOW\n4、登录5号节点的EOSC，print_his_ascu_data 0//查询WEST端口的事件，存在影响ASCU的事件发生，和倒换日志的时间点可以对上\n\n5、查询EOSC底层AIS告警\n->print_his_ais_data 0\r\n0th :: 2019.11.23.19.23.10.1125 :: data = 1\n1th :: 2019.11.23.19.23.11.1325 :: data = 0\n2th :: 2019.11.23.10.35.45.0509 :: data = 1\n3th :: 2019.11.23.10.35.45.0510 :: data = 0\n4th :: 2019.11.23.10.35.45.0532 :: data = 1\n5th :: 2019.11.23.10.35.46.0732 :: data = 0\n6th :: 2019.11.23.11.30.04.0437 :: data = 1\n7th :: 2019.11.23.11.30.04.0438 :: data = 0\n8th :: 2019.11.23.12.55.22.3947 :: data = 1\n9th :: 2019.11.23.12.55.22.3948 :: data = 0\n10th :: 2019.11.23.15.52.08.0686 :: data = 1\n11th :: 2019.11.23.15.52.08.0687 :: data = 0\n12th :: 2019.11.23.18.07.11.1356 :: data = 1\n13th :: 2019.11.23.18.07.11.1357 :: data = 0\n14th :: 2019.11.23.18.45.53.1485 :: data = 1\n15th :: 2019.11.23.18.45.53.1486 :: data = 0\n16th :: 2019.11.23.19.01.23.3526 :: data = 1\n17th :: 2019.11.23.19.01.24.3726 :: data = 0\n18th :: 2019.11.23.19.21.37.2454 :: data = 1\n19th :: 2019.11.23.19.21.37.2455 :: data = 0\n告警时间点和倒换日志的时间可以对上\n6、5号节点对1号节点的EOSC有过OSC_AIS的记录，需要沿着收的方向往上游排查是否存在RLOS/LOF等事件发生，最终在OA2站点的WEST（该west对接OA1的EAST端口）端口上查询到LOF事件\n->print_his_lof_data 0\r\n0th :: 2019.11.23.10.31.03.3789 :: data = 0\n1th :: 2019.11.23.10.35.46.0268 :: data = 1\n2th :: 2019.11.23.10.35.46.0269 :: data = 0\n3th :: 2019.11.23.11.30.05.0198 :: data = 1\n4th :: 2019.11.23.11.30.05.0199 :: data = 0\n5th :: 2019.11.23.12.55.23.3708 :: data = 1\n6th :: 2019.11.23.12.55.23.3709 :: data = 0\n7th :: 2019.11.23.15.52.08.0449 :: data = 1\n8th :: 2019.11.23.15.52.09.0450 :: data = 0\n9th :: 2019.11.23.18.07.12.1120 :: data = 1\n10th :: 2019.11.23.18.07.12.1121 :: data = 0\n11th :: 2019.11.23.18.45.52.1250 :: data = 1\n12th :: 2019.11.23.18.45.52.1251 :: data = 0\n13th :: 2019.11.23.19.21.36.2220 :: data = 1\n14th :: 2019.11.23.19.21.36.2221 :: data = 0\n15th :: 2019.11.23.02.02.21.3326 :: data = 1\n16th :: 2019.11.23.02.02.21.3327 :: data = 0\n17th :: 2019.11.23.02.07.04.3866 :: data = 1\n18th :: 2019.11.23.02.07.04.3867 :: data = 0\n7、排查OA1站点，无RLOS/LOF/OSC_SD/osc_ais/iop_low异常事件发生\n8、观察OA2站点的历史性能，IOPmin、IOPmax和IOP当前值，波动在0.5db以内，收光在正常范围内，同时性能监测到CV\\ES\\BBE\n\n9、观察OA2的EOSC-WEST闪报LOF的情况，单盘底层有记录，网管无记录，排查告警屏蔽，无屏蔽。观察DBL_FAIL告警，震荡次数较多，均为1S告警。同时闪报无规律，24号也出现多次闪断。\n10、25号更换OA1和OA2的EOSC单盘，观察至今，DBL_FAIL记录，同时EOSC底层无异常事件记录；\n \n \n根因:OA1站点的EAST端口、OA2站点的WEST端口时钟劣化，导致OA2站点WEST闪报LOF告警，触发1-5号节点的SPC OCH发生重路由！\n \n解决方案:1、换盘解决，故障机盘返修检查；\n2、由于EOSC咨询研发，EOSC闪报1S LOF告警（需要返修检测），持续时间非常短，刚刚OA2站点，在此时也会发生DCCR路由切换，导致网管未监测到，给故障判断带来一定干扰；\n3、由于在开通期间，SPC OCH重路由恢复返回时间较短，刚排查业务是否中断，业务又在返回中。建议日常维护时，设置的恢复时间至少在1小时以上，避免业务来回切换，使得业务频繁闪断。当业务无中断时，可以有充分的时间，排查和定位异常重路由故障段落和原因；\n原因分类:无\n"}
{"instruction": "落地R8000替换R865经验总结。某联通落地层R8000替换R865，在替换完成第一台落地1R8000时，打开8000设备对接AR端口，检查发现所有BGP邻居都正常UP，但是查看4G业务路由show ip route vrf L3VPN-50发现EBGP路由只有一个下一条是ten-gigabitethernet 0/3/1/3.512,未能形成ECMP路由，导致上行流量只发给ten-gigabitethernet 0/3/1/3.512，此外还发现落地1对接AR的端口没有下行流量，与承载网确认下行流量都已经切到落地2R800去了；\n第二天无线反馈某区域70多个4G站点于凌晨2点多业务中断，管理正常，经查问题站点单挂汇聚2；\n", "input": "", "output": "案例主题:落地R8000替换R865经验总结\n案例编号:AL202004035219\n网络场景:联通ptn+ipran场景，接入层为ptn640+835E，汇聚层及以上为R865，接入层静态、汇聚层以上动态组网；核心、落地层进行R8000替换；\n现象描述:某联通落地层R8000替换R865，在替换完成第一台落地1R8000时，打开8000设备对接AR端口，检查发现所有BGP邻居都正常UP，但是查看4G业务路由show ip route vrf L3VPN-50发现EBGP路由只有一个下一条是ten-gigabitethernet 0/3/1/3.512,未能形成ECMP路由，导致上行流量只发给ten-gigabitethernet 0/3/1/3.512，此外还发现落地1对接AR的端口没有下行流量，与承载网确认下行流量都已经切到落地2R800去了；\n第二天无线反馈某区域70多个4G站点于凌晨2点多业务中断，管理正常，经查问题站点单挂汇聚2；\n\n处理过程:1、现场落地1替换R8000后，打开落地1R8000设备对接AR1的15个端口，检查发现bgp邻居除一个光路问题外都正常，但是查看4G业务路由show ip route vrf L3VPN-50发现EBGP路由只有一个下一条，是ten-gigabitethernet   0/3/1/3.512，未能形成ECMP路由，此外落地1R8000对接AR1的端口没有下行流量，上行流量只发给ten-gigabitethernet 0/3/1/3.512\n\n                                 落地1R8000的L3VPN-50 bgp邻居除了1个对接端口问题外，都已起来\n\n                                    落地1R8000对接ar的所有端口没有收流量，并且只有ten-gigabitethernet 0/3/1/3.512有发流量\n\n                                  落地1R8000查看路由表，发现从AR1学到路由下一条只有1个\n2、联系省公司确认AR1设备收路由情况，发现AR1能从落地1R8000学到BGP路由，但是关于基站的路由优选从AR2学到IBGP路由，因此AR的下行流量全部切换到落地2R800；\n\n                                   AR1能从对接落地1的EBGP学习到路由\n\n                                  AR1的全局路由表关于基站地址段优选IBGP，从AR2学到\n\n                               AR1收到落地1传递过来ebgp路由属性是incomplete\n3、联系总部研发介入；定位8000和800在对EBGP对接发送路由属性不一样的情况，8000设备发送给对端的路由属性为incomplete，800设备为igp，当R8000和R800成对组网时，导致AR优选igp属性路由，因此下行流量全部从落地2R800设备引入；\n4、落地1R8000设备增加出方向路由策略，将发给对端AR1的路由属性修改为igp，路由策略修改完毕后，AR1切换到落地2的下行流量恢复到落地1；\n\n                             前缀列表匹配出方向路由\n\n                            匹配前缀列表路由，设置origin属性为igp\n\n                            应用到ebgp的出方向\n\n                        AR1全局路由表关于基站地址段下一跳恢复到落地1R8000\n5、确认ECMP不生效原因是因为8000设备不仅全局开关要使能ecmp，每个IPV4 VRF还要单独使能max-paths ebgp 4（出方向最大支持4个ecmp，即使你有12个ebgp对接，但不影响流量下行，对端支持12个ecmp即可）\n\n                         Ipv4 vrf 使能max-paths ebgp 4\n\n                      全局路由表可以看到每个路由有4个下一条\n6、确认落地1R8000对接AR1的路由、上下行流量恢复正常；\n\n7、排查某区域4G业务中断问题，发现问题站点都在汇聚2下挂，且都是单挂站点；\n8、挑选问题站点排查，发现AR1落地学不到汇聚2单挂站点基站路由，从汇聚2带基站网关ping mme地址，发现一个包能通一个包不通，因此判断AR1边路由学习存在问题，AR2学习路由正常，又因为AR只收汇总路由，因此4G业务下行流量是负载均衡，发给落地1R8000的数据包因为找不到下一跳而丢弃，而发往落地2R800的数据包能够正常转发，从而出现1个包通1个包不通的现象；另外注意下4G管理在其他R800落地，本次割接不涉及,因此4G业务不正常，管理正常；\n\n                     落地 1R8000学不到汇聚2的基站网关路由\n\n                   汇聚2带网关源ping后台mme地址一个包能通一个包不通\n9、联系研发介入排查,确认是因为落地1R8000与第三方网管对接的公网BGP的黑洞路由导致：与第三方网管对接，需要发送我司汇聚层以上loopback地址段给对端，由于汇聚2的loopback在开通时配置不在规划地址段（配置成10.94.24.24，正常规划是10.24.94.0/24），后续开通多条业务后也不好修改，因此单独network 10.94.24.24/32 发布，8000配置network必须要关联黑洞路由，此黑洞路由默认优先级大于ISIS学到的路由，导致IGP优选此路由，当落地1R8000收到路由反射器反射的汇聚2的BGP路由，发现下一条是自己，认为非法而丢弃；\n\n                    落地1R8000公网bgp network发布全网loopback路由段\n\n                     落地1R8000的黑洞路由\n10、落地1R8000删除10.94.24.24/32黑洞路由后，汇聚2下的单挂站点4G业务恢复；\n \n \n根因:1）在配置比对中，忽略了网间多组EBGP对接需开启ECMP使能，造成了R8000业务上行只有一个出口，未能形成ECMP。\n2）配置比对时忽略了8000和800在对EBGP对接发送路由属性不一样的情况，8000设备发送给对端属性为incomplete，800设备为igp，导致AR下行流量全部从落地2R800设备入。\n3）汇聚2环回口IP设置的个例性，替换结束未确认该站网内路由，造成了汇聚2上单挂站点业务通道不通。\n \n \n解决方案:问题1、对现网场景的解读不够充分，且逐条比对，对8000和800配置功能差异未考虑全面，忽略了部分特殊对接场景和个例配置。\n1）在配置比对中，忽略了网间多组EBGP对接需开启ECMP使能，造成了R8000业务上行只有一个出口，未能形成ECMP。\n2）配置比对时忽略了8000和800在对EBGP对接发送路由属性不一样的情况，8000设备发送给对端属性为incomplete，800设备为igp，导致AR下行流量全部从落地2R800设备入。\n解决方案：前期准备对设备配置的条目逐一标注，知其然知其所以然。在原有的通篇逐条比对方法基础上，再根据网间各个对接模型以模块形式独立分析，完善特殊场景的配置。\n问题2、割接完成后业务确认的方法不够完善，执行不够严谨。\n1）汇聚2环回口IP设置的个例性，替换结束未确认该站网内路由，造成了汇聚2上单挂站点业务通道不通。\n解决方案：完善业务确认方法，不能已无线告警作为判断是否有业务未恢复的主要依据，传输侧可通过检查关键表项（如路由表）的条目数、端口转发流量、ping测等方式掌握业务情况。执行检查时划分任务，并明确责任人，对割接前后指标均需记录，完成后签字确认，对差异指标复核。\n问题3、割接过程需上下对接厂家专业人员配合，并在各流程节点反馈业务情况。\n在替换流程中各关键节点，需有对接厂家专业人员协助确认业务状态和性能指标，以免造成误判。\n问题4、未考虑割接内容以外发生的突发情况的应急预案。\n对割接范围内的突发情况有相应的应急预案，未考虑割接外部突发情况的应对措施，在跟无线了解到割接后业务均正常后，关注点临时转向排查处理另外汇聚站点交叉盘异常问题。造成了8000替换的事后确认工作混乱。\n解决方案：明确团队成员替换的工作内容和责任，补充割接外突发状况的应急预案和责任人。\n原因分类:无\n"}
{"instruction": "广东HG261GS在中兴OLT割接后业务不通故障分析。广东中山电信客户反馈，在实验室进行电信网关HG261GS在中兴C300 OLT到C600的割接实验，原本在C300上正常的业务，在割接C600之后业务中断，要求厂家分析业务中断的原因，给出说明。", "input": "", "output": "案例主题:广东HG261GS在中兴OLT割接后业务不通故障分析\n案例编号:AL202003105021\n网络场景:\n现象描述:广东中山电信客户反馈，在实验室进行电信网关HG261GS在中兴C300 OLT到C600的割接实验，原本在C300上正常的业务，在割接C600之后业务中断，要求厂家分析业务中断的原因，给出说明。\n处理过程:在割接后，报文差异为OLT新增了6条Extended VLAN tagging operation configuration data实体规则下发。其中的Received frame VLAN tagging operation table属性（报文标红部分）规则存在异议。具体报文如下：\r\n具体报文属性解析如下。\r\n第一条：\r\n02D5480A00ABFA010400F8000000F8000000C00F8000000F8000000000000000000000000000000000000028A31354F8\r\n报文属性（Received frame VLAN tagging operation table）解析：表示untag的丢弃规则。\r\n15, 4096, 0, 15, 4096, 0, 0,(3, 15, 4096, 0, 15, 4096, 0)\r\n第二条：\r\n02D6480A00ABFA010400F800000088000000C00F8000000F8000000000000000000000000000000000000028193D2EDC\r\n报文属性（Received frame VLAN tagging operation table）解析：表示携带任何优先级的报文丢弃规则。\r\n15, 4096, 0, 8, 4096, 0, 0,(3, 15, 4096, 0, 15, 4096, 0)\r\n第三条：\r\n02D7480A00ABFA010400F800000080190000000F8000000F80000000000000000000000000000000000000283859A434\r\n报文属性（Received frame VLAN tagging operation table）解析：表示vlan=50报文透传规则。\r\n15, 4096, 0, 8, 50, 0, 0,(0, 15, 4096, 0, 15, 4096, 0)\r\n第四条：\r\n02D8480A00ABFA010400F800000080170000000F8000000F80000000000000000000000000000000000000284FB9315D\r\n报文属性（Received frame VLAN tagging operation table）解析：表示vlan=46报文透传规则。\r\n15, 4096, 0, 8, 46, 0, 0,(0, 15, 4096, 0, 15, 4096, 0)\r\n第五条：\r\n02D9480A00ABFA010400F800000080168000000F8000000F80000000000000000000000000000000000000286CFBE360\r\n报文属性（Received frame VLAN tagging operation table）解析：表示vlan=45报文透传规则。\r\n15, 4096, 0, 8, 45, 0, 0,(0, 15, 4096, 0, 15, 4096, 0)\r\n第六条：\r\n02DA480A00ABFA010400F800000080148000000F8000000F8000000000000000000000000000000000000028B18338A7\r\n报文属性（Received frame VLAN tagging operation table）解析：表示vlan=41报文透传规则。\r\n15, 4096, 0, 8, 41, 0, 0,(0, 15, 4096, 0, 15, 4096, 0)\r\n第一条和第二条报文，属默认丢弃规则，非现场业务需求且非电信规范要求的默认规则，存在解析异议。OLT配置如下两条规则后，ONU的单层业务映射规则出现错误，导致业务不通。\r\n第三条到第六条报文，分别是VLAN=50、45、46、41规则的透传规则，属正常配置。\n \n根因:\nOLT割接前后，C300正常C600异常，因配置存在差异，导致ONU业务中断。\nONU对Extended VLAN tagging operation configuration data解析不存在问题，且不存在与vlanFilter实体的下发先后顺序需求。需OLT按现场业务需求下发配置。\n\n解决方案:\n本次故障是在OLT升级割接后引起，且前后配置存在差异，差异内容存在不规范，导致ONU业务不通。 建议采用OLT侧修改配置，恢复ONU业务。\n\n \n原因分类:无\n"}
{"instruction": "接入网管-集约化网管SUSE主机异常故障处理始末。    某处运营商PON网管采用我司UNM2000分布式网管方案，管理多个地市多个PON网络，并且为集约化方案，将网管应用服务（含数据库）、采集服务、接口服务等组件部署在三台服务器（三台服务器均为vm虚拟化服务器）中。某日出现网管服务器界面瘫痪无法登录，UNM2000界面无法打开问题。", "input": "", "output": "案例主题:接入网管-集约化网管SUSE主机异常故障处理始末\n案例编号:AL202004085373\n网络场景:    UNM2000宽带接入网，总体TOPO：\n\n \n \n    UNM2000分布式网管系统，基于Linux SUSE 操作系统和MySQL数据库（分三个地域，每个地域三套，合计共九套。每个地域三套为：采集接口服务器、网管应用服务器（含数据库）、北向接口服务器）：\n\n现象描述:    某处运营商PON网管采用我司UNM2000分布式网管方案，管理多个地市多个PON网络，并且为集约化方案，将网管应用服务（含数据库）、采集服务、接口服务等组件部署在三台服务器（三台服务器均为vm虚拟化服务器）中。某日出现网管服务器界面瘫痪无法登录，UNM2000界面无法打开问题。\n处理过程:\n故障出现时，云网管服务器中，应用服务器（数据库）、北向接口服务器均正常，检查UNM这两台分布式服务器的服务及ice各子服务均正常，但采集服务器不正常，ICEGRID管理器登录发现UNM2000-ManagerAnmServer-UnmRpcNode3这一个ice服务已关闭了。\r\n\t\n \n\n登录PING测三台分布式服务器，发现采集服务器（133.0.193.107）这台已无法PING通了，应用服务器（数据库）（133.0.193.8）、北向接口服务器（133.0.193.59）两台PING测正常，top命令查看系统运行概述均无大的cpu和内存占用率出现。由于采集服务器远程无法管理，故到云网管虚拟机VMware vSphere集成容器操作终端进行本地登录操作，本地打开采集服务器，发现机器并未完全死机，有SUSE的登录界面，输入用户名密码可以登录。登录桌面后，运行极为卡顿。打开本地终端控制台界面，通过top查看CPU和内存利用率，发现icebox已占用cpu超过10倍100%利用率，其它所有操作无效，服务无法启动，网络eth0口依旧无法ping通。\n\n\n只能通过客户的VMware vSphere集成容器进行重启该接口服务器，重启后，ping测正常，icegrid连接启动UNM2000-ManagerAnmServer-UnmRpcNode3服务后，云网管恢复正常，所有登录及北向接口均恢复正常。此时，登录客户的VMware vSphere集成容器监控发现，故障时间点，在一个时刻后恒定CPU利用率封顶。如下图所示：\n\n由于采集服务器只有一个manager服务，系统日志也未报相关进程挂死；且该服务器平时根本不会占用什么内存和CPU资源，故挂死原因值得深究。进一步分析采集服务器挂死原因，经过SUSE系统的supportconfig命令，收集系统的健康状况，生成了一个nts_主机名_日期.tbz 文件，且该文件在/var/log/nts_*.tbz目录处生成，同时会生成一个以该文件名加.md5后缀的文件。将tbz文件发回公司公共研发部分析，尚未找到因系统硬件健康原因导致的故障。\r\n\t\n再检查Linux SUSE企业版的软件系统。检查/var/log/messages日志后，发现重要端倪，即系统中存在如下日志，于10点29分左右，4710进程软锁死，如下图所示：如上图所示，定位4710是gnome进程，是用于linux的图形桌面的进程。该进程出现了soft lockup锁死，锁死后直至系统重启阶段，就没有其它任何系统和进程日志了。\r\n\t\n通过百度查找soft lockup锁死问题。发现lockup分为soft lockup和hard lockup，soft lockup是指内核中有BUG导致在内核模式下一直循环的时间超过10s（根据实现和配置有所不同），而其他进程得不到运行的机会。由此也应证了前面gnome服务锁死导致icebox进程无法运行，故显示进程CPU占用率封顶的现象。\n\n\n为解决此问题，需要暂时先关闭gnome桌面服务，因为服务器均为后台运行网管服务，并不需要X Window桌面。因为，我们跟客户建议，将所有服务器的gnome进程停止掉，其副作用就只是没有图形化桌面。经过客户同意后，我们开始实施彻底关闭gnmoe桌面进程的工作。关闭gnome桌面进程，操作分为两步：1>.关闭当前的gnome服务，直接运行init 3； 2>.修改/etc/inittab内的id:5:initdefault 参数，将id:5改为id:3，即多用户用纯命令行。 修改方法图解： \n\n\n根因:1、本次故障通过检查发现，故障原因是因为采集服务器挂死，经检查该服务器的/var/log/messages日志，发现存在如下日志，于10点29分，4710进程出现软锁死，此为直接根源。深入排查日志，显示pid 4710是gnome进程，是用于linux的图形桌面的，即Linux SUSE 11.5系统在运行过程中出现内核软锁死造成故障。Soft lockup名称解释：所谓soft lockup，是指有Bug没有让系统彻底死机，但是若干个进程（或者kernel thread）被锁死在了某个状态（一般在内核区域），很多情况下是由于内核锁的使用造成的问题。\n\n\n \n2.由于云网管服务器为后台服务运行，不需要图形界面服务，故解决该问题可以直接关闭Linux SUSE系统的图形界面。\n\n \n解决方案:关闭Linux SUSE系统的图形界面。完全关闭图形界面的方法如下：\n1>.关闭图形界面：\n以最高权限登录Linux系统，如root帐号；使用init 3 命令，关闭图形界面（XServer服务也会关闭）；\n2>.开机时，不进入X Window界面：\n修改/etc/inittab文件，将id:5:initdefault 参数5改为3，即多用户及纯命令行启动。\nvi /etc/inittab\nid:5:initdefault:\n改为：\nid:3:initdefault:\n\n原因分类:无\n"}
{"instruction": "异常报文拥塞造成IPTV高清业务卡屏问题解决始末。    某地区工程使用我司PON产品，出现随机时间段IPTV高清业务卡屏和拖影现象。主要出现在白天10时、12时左右、晚间19-22时左右，IPTV业务在地区数个烽火OLT下都有卡顿现象，影响用户正常观看。智能网关涉及烽火HG6821M、HG6201M、贝尔G140W-C等多款。\n    前方反馈主要集中在一个地区的数端OLT上，用户主要投诉IPTV画面卡顿、直播高清类频道画面卡顿，而点播类节目尚表现良好。", "input": "", "output": "案例主题:异常报文拥塞造成IPTV高清业务卡屏问题解决始末\n案例编号:AL202004085376\n网络场景:GPON接入网，GPON上联智能网关场景，IPTV为CDN平台；且由于运营商的原因，到用户侧数据VLAN 41中既有宽带数据业务也有IPTV业务，故该场景为数据家宽和IPTV没有通过VLAN进行业务区分的场景：\n\r\n \n现象描述:    某地区工程使用我司PON产品，出现随机时间段IPTV高清业务卡屏和拖影现象。主要出现在白天10时、12时左右、晚间19-22时左右，IPTV业务在地区数个烽火OLT下都有卡顿现象，影响用户正常观看。智能网关涉及烽火HG6821M、HG6201M、贝尔G140W-C等多款。\n    前方反馈主要集中在一个地区的数端OLT上，用户主要投诉IPTV画面卡顿、直播高清类频道画面卡顿，而点播类节目尚表现良好。\n处理过程:1、接到问题上报后，首先检查OLT配置，确认报障用户所在OLT的配置均为正确。\nONU带宽配置正常：\n\nVEIP配置正常：\n\nGemport分配正常：\n\nOLT配置QinQ域绑ONU配置正常：\n\nGPON业务卡流量正常，实时采样下行速率72.7Mbit/S，远低于GPON下行2.5Gbit/S总带宽：\n\n\n\n2、通过在OLT上联板处开端口测试，业务表现正常，无视频卡顿现象出现。\n上联口为5GE组成的LACP端口，低谷值每GE物理口平均100Mbit/S下行速率，高峰值每GE物理口最高达550Mbit/S左右，下行端口利用率最高在55%左右，低于告警阀值70%：\n\n\n3、赴不同报障用户侧测试，发现了三款设备表现一致，均为桥接模式正常播放高清界面，路由模式播放节目随机卡顿。\n  当终端路由模式时，出现了TCP媒体流重传的现象：\n\n    当终端选择桥接模式时，正常播放，无任何重传出现：\n\n\n4、抓包分析路由与桥接模式报文区别，暂时判断为IPTV平台绑定机顶盒MAC，推测分配不同公网地址走不同QOS保障资源。\n\n5、将机顶盒MAC地址替换到智能网关internet_mac，实施测试，现象依旧，测试结果使上述第4点推论被推翻。\n\n6、增加走访正常用户和异常用户，对比发现路由模式选择不同平台大区业务质量有区别，发现连接B大区用户用路由模式画面正常。\n两款终端都选路由模式时，左边老终端（博通方案）选A大区，右边新终端（MTK方案）选B大区，对比播放正常，完全一致。\n播放画面对比，共享网盘地址：https://pan.baidu.com/s/1FBy-W5yLl5SuIbAW--TQFQ\n网盘密码：j0er\n\n7、抓包路由模式连接襄阳大区的智能网关报文，结果未抓取到TCP流；由此得知TCP流进入智能网关硬件加速区，发现连接不同平台进入网关不同区域解码：硬件加速解码和CPU软件解码（软件解码时CPU同时处理互联网数据）。\n备注：554 端口，用于RTSP协议，提供一 种可扩展的框架，使能够提供可控制的，按需传输实时数据，比如音频和视频文件。rtsp对流媒体提供了诸如暂停，快进等控制，而它本身并不传输数据，rtsp作用相当于流媒体服务器的远程控制。故此端口没有走硬件加速。\n\n8、某些时间段，存在大量TCP杂包进入智能网关，冲击网关CPU，达到网管CPU设置门限后出现TCP乱序、重传现象。\n    通过大量抓包数据分析（报文参见下文附件网盘下载），发现大量杂包进入智能网关CPU问题。已根据大量报文找到来源：某区宽带 VLAN 1002、VLAN 1004，来源交换机物理地址：dc:d2:fc:26:23:f3（通过抓包中取证），攻击类型：单播未知包（根据CVLAN ID和用户目的MAC两个条件判断得出，CVLAN ID和目的MAC均不在该OLT下，源MAC从OLT上联口过来）。\n    大量杂包占比根据时段会超过70%（根据抓包图形得出，70%占比是指单播未知包进入智能网关CPU处理的报文数量）；某日通过OLT上联QOS规则，精确屏蔽掉一部分报文后（治标不治本，毕竟QOS条目有限），将占比减少到占比50%以下后，过19:00-22:00高峰时间段基本不卡顿。\n当冲入智能网关CPU报文较多后，达到网关CPU处理报文门限设置后，出现TCP序列丢弃，故乱序、重传出现，导致卡顿。\n\n9、通过对不同地市的IPTV业务媒体流运行指标进行分析对比，才确凿结论。\n    在B地市作对比测试IPTV业务（同样为烽火OLT、烽火HG6821m，机顶盒测试各个厂家），从未发现过任何卡顿现象。HG6201m、HG6821m、HG6823m分别为我司 III、II、I 型级别智能网关，同时对比A地市下智能网关WAN侧报文，发现最大区别，如下图所示：\n    A地市OLT下HGU用户报文输出I/O图表：\n\n    B地市OLT下HGU用户报文输出I/O图表：\n\n    以上两图中，绿色为WAN侧收到纯TCP媒体流（IPTV机顶盒需要解析的报文），红色为WAN侧收到的互联网和其它VLAN过来的杂包，两种报文都进入网关CPU处理，显然后者要优于前者。A地市杂包占比远高于TCP媒体流，B地市为平滑线，TCP媒体流占绝大多数。此点就解释了为什么同样的CDN平台、同样的OLT和终端、同样的机顶盒、同样的软硬件版本，有的地市正常，有的地市观影质量差的原因。\n\n10、解决方案，实际解决方案是有多种选择的。按照当时的现实情况，是采用当时最可行最快速最安全代价最小部署的解决方案思路进行（并非最优，但符合时宜，为后续终极解决方案争取时间），而后期优化又采取了其它解决方案。所有解决方案介绍如下：\n方案一（首选）：对于A地区OLT，发现进入OLT有大量的单播未知包（杂包），找到异常报文来源，目前发现集中在VLAN 1002、1004，为某地区家宽业务。找到 dc:d2:fc:26:23:f3 交换机来源，排查该交换机是否存在硬件或软件故障，交换机中FDB表记录了各MAC和物理端口的对应关系，而本处报文OLT收到大量非本OLT端口下用户目的地址的业务，说明该交换机FDB表崩溃，所有端口都在洪泛单播未知包。直接把A地市OLT该区宽带业务割接出来也可以解决。消除大占比杂包，即使IPTV媒体流进入网关CPU软解码，不达到CPU设置门限，也不会影响业务。另外，区域的交换机端口隔离、OLT直连Bras、OLT尽量不接交换机过来的专线，以及将全区域使用的VLAN改造，由全区域一个VLAN，改为每OLT或每交换机端口一个VLAN。\n方案二：协商华为大区平台修改TCP流554端口号，或者中间通过NAT转换成其它端口号。这样通过新端口号与智能网关终端交互的TCP数据流就会进入硬件加入，从而不会因为特殊端口丢入CPU进行软加速处理。此方案改动最小（初期华为CDN平台不接受，放弃）。\n方案三：HG6823m、HG6821m和HG6201m三款智能网关软件修改（还包括其它友商采用此MTK平台的产品），554端口过来的媒体流进入网关硬件加速。测试稳定后，再提供软件给直真ITMS平台，通过远程升级解决。远程升级通过小范围局部试点成功后，逐步实施（方案涉及终端改动范围动作大，不适宜，放弃）。\n方案四：A地市的CDN平台指向改造，由华为平台接到其它友商或我司CDN平台，完善其它大区CDN节目数量，达到同等于华为大区节目数量，并且其它CDN平台需评估新增接入用户数量与风险，如评估可行后，再建议A地市IPTV高清资费包用户从华为平台切换到其它大区的平台（方案涉及平台迁移，改动动更大，更不适宜，放弃）。\n\n【报文附件】\n①.用户现场HGU的PON侧抓包（TCP媒体流和其它高占比杂包并存），Wireshark中的“会话”菜单显示，B->A方向375639个报文：\nhttps://pan.baidu.com/s/1Re4T1wTueluZp2vRqg7QRQ\n提取码：cobj\n②.用户现场HGU的PON侧抓包（TCP媒体流和其它高占比杂包并存），Wireshark中的“IO/Graph”菜单显示的杂包占比远高于TCP媒体流占比的报文：\nhttps://pan.baidu.com/s/1Bf38PKgV-sKYp-5qZTDsRw\n提取码：f9q0\n根因:根因一：\n    MTK方案智能网关终端（烽火、ZTE、杭研、贝尔），从554端口进入CPU的流未进入硬件加速，同时CPU有门限设置，当所有数据业务达到门限设置后，丢弃超出门限的报文（例如：带宽比喻为8车道，而实际来10车道的数据流量，必丢弃2车道数据量，有拥塞会丢包），以至于TCP流出现连续重传（水池蓄水不足时，即超出机顶盒缓存画面），导致画面卡顿和拖影。\n    走硬件加速后，在终端中可以看到媒体流的交互端口：\n~ # hw_nat -g\nTotal Entry Count = 7\nIPv4_NAPT=4166 : 192.168.1.2:59750->111.48.19.45:80 => 111.47.101.46:59750->111.48.19.45:80\nIPv4_NAPT=13606 : 39.135.25.15:1554->111.47.101.46:33966 => 39.135.25.15:1554->192.168.1.2:33966\nIPv4_NAPT=13794 : 192.168.1.2:59751->111.48.19.45:80 => 111.47.101.46:59751->111.48.19.45:80\n\n根因二：\n    不同厂家CDN平台，对于TCP媒体流处理走不同的端口，故不同的L4端口也造成了不同平台下的业务差异（碰巧导致有的平台过来媒体流走了HGU硬件加速，而有的平台过来的媒体流不走硬件加速）：\n  1>.烽火CDN平台，TCP媒体流从平台端输出到客户端的端口为：\n     CDN平台L4端口55565 <-> 客户端L4端口554\n  2>.中兴CDN平台，TCP媒体流从平台端输出到客户端的端口为：\n     CDN平台L4端口1554 <-> 客户端L4端口554\n  3>.华为CDN平台，TCP媒体流从平台端输出到客户端的端口为：\n     CDN平台L4端口554 <-> 客户端L4端口554\n\n根因三：\n    杂包问题，占用大部分业务带宽。\n    对比其它地市IPTV业务抓包分析，发现其它地市正常IPTV业务（B地市），从未发现过任何卡顿的OLT站点进行比较（同样为华为CDN平台，HGU对媒体流也未进入硬加速，也是平台和客户端都为554端口），对比本地市（A地市）智能网关WAN侧报文，存在区别，通过Wireshark软件IO/Graph分析，发现大量杂包进入智能网关CPU，当达到网关CPU处理报文门限后，会出现TCP报文丢弃、乱序、重传，导致IPTV卡顿各种观影问题。\n\n注：上图为B地市（正常地市）HGU PON口收包采样。绿色线为WAN侧收到纯TCP媒体流（IPTV机顶盒需要解析的报文），红色为WAN侧收到的互联网和其它VLAN过来的杂包，多种报文都进入网关CPU处理，业务报文线性平滑线。\n\n注：上图为A地市（异常地市）HGU PON口收包采样。绿色为WAN侧收到纯TCP媒体流（IPTV机顶盒需要解析的报文），红色为WAN侧收到的互联网和其它VLAN过来的杂包，两种报文也都进入网关CPU处理，业务报文和其它非业务报文均剧烈抖动，出现抢占关系。\n\n根因四：\n    1>.上层设备二层交换机没有端口隔离（基于VLAN id的端口隔离，即有不同业务种类，有的VLAN业务如专线反而需要端口之间不隔离，而有的VLAN业务洪泛较大则需要端口隔离）；\n    2>.OLT没有直连Bras，导致VLAN没有在Bras直连端口场景上终结，故报文在二层交换机随意洪泛；\n    3>.根据抓包分析，发现有几个代理运营商的交换机业务出现地址漂移广播风暴，更加加剧了广播包、单播未知包在全网的反复振荡。证据如下：\n    HGU终端会在不同时段，会收到不同占比的大量垃圾报文，这些超量的垃圾报文，根据抓包图形分析出，70%以上占比是单播未知包进入了智能网关CPU。如下图Wireshark中的“会话”菜单显示，B->A方向375639个报文，A->B方向为0个报文，查实这些B点过来的报文来自同一台交换机地址，而A的目的地址为不同终端和设备，且这些地址在该台OLT的UNI侧并未查到，由此说明就是单播未知包超量洪泛、广播发送到VLAN内所有主机、报文振荡：\n\n    通过OLT上联口绑定QOS策略，例如丢弃部分VLAN源MAC为精确匹配的报文，屏蔽掉一部分报文后（治标不治本，毕竟QOS条目有限），将占比减少到占比50%以下后（HGU的CPU压力减小），在晚高峰时段发现高清业务基本不会卡顿。\n\n绿色线：进入ONU网关要达到IPTV机顶盒的TCP视频流。\n红色线：进入ONU网关的杂包一，单播未知包，杂包来源：该区域家宽VLAN 1002、1004。\n蓝色线：进入ONU网关的杂包二，除去绿色线和红色线报文后剩余的所有杂项报文（如网络中主机宣告的ARP广播、ipv6 icmp报文……）。\n    其它垃圾报文占比也比较多，据抓包统计也占用了约1/4比例，其中由于OLT学习到大量地址导致Hash冲突产生的垃圾报文占比也非常高，剩余垃圾报文来自各个外网及专线。\n    详解：当OLT上联口峰值收到数万mac地址后，造成主控盘FDB地址转发表hash冲突，随机产生的冲突条目的单播报文变成单播未知包，从而将1:1的报文转发量变为1:N的报文转发量。OLT透传的VLAN资源中，语音IMS Vlan为2401、2499，智能网关管理Vlan 2939，且全网Vlan ID一致，导致OLT从上联口学习到非常多的mac地址广播， OLT根据vlan+mac地址hash算法计算得到存储地址，如果学习到该vlan下的mac地址过多（超过主控板处理能力的1.2万个，后期主控板升级双hash效验后会提升至1.6万个），就会随机产生少量hash冲突，导致部分报文洪泛。Bras下沉(OLT直连Bras)主要就是大幅减少OLT上联口学习到的MAC地址数量，从而不会触发该问题。\n解决方案:解决方案：后期客户将该地区业务改造，并行做了如下措施后，IPTV观影质量得到大幅改善，客户中止投诉：\n    1>.该地区交换机硬件升级，且做交换机端口隔离（需交换机板卡支持，部分VLAN业务需要基于Vlan id作端口隔离，部分VLAN业务不需要基于Vlan id作端口隔离）。\n    2>.部分符合条件的，将OLT直连Bras，尽量不从交互机接专线业务，由此带来的好处是很多用户VLAN在Bras侧终结，OLT上联口仅学习到业务VLAN的Bras MAC地址。\n    3>.将前期单播未知包全网广播洪泛的VLAN进行改造，由全区域一个VLAN，改为每OLT或每交换机端口一个VLAN。\n    4>.后期将华为CDN平台端对客户端的TCP媒体流，由554端口改为其它端口（处理RTSP的554端口不变），相当于遇到此类芯片方案的HGU可以直接走硬件加速，不会再甩给CPU软件处理，也等于是当即使出现流量拥塞后的第二道保险（双保险）。终端不用大批量改软件改端口。\n原因分类:无\n"}
{"instruction": "IPRAN-关于配置或下载静态tunnel时出现tunnel-id冲突报错处理的技术案例。在OTNM2000网管配置下载tunnel、pw、vpn业务时，出现报错提示tunnel-id冲突，无法下载。类似报错较多，例如：\n", "input": "", "output": "案例主题:IPRAN-关于配置或下载静态tunnel时出现tunnel-id冲突报错处理的技术案例\n案例编号:AL202004095397\n网络场景:场景主要包括：\n1、联通IPRAN网络使用的R865设备开通的静态tunnel；\n2、移动PTN网络使用的PTN680设备开通的静态tunnel；\n现象描述:在OTNM2000网管配置下载tunnel、pw、vpn业务时，出现报错提示tunnel-id冲突，无法下载。类似报错较多，例如：\n\n处理过程:1、首先在协议栈新建一个log日志。\r\n登陆协议栈， 输入conf t ，进入配置模式，输入log file XXX.log，新建log日志，可以自主命名。\r\n2、再次下载Tunnel，等待报错。\r\n3、用WinSCP软件打开报错的站点，在/home/scu文件夹下找到刚才新建的XXX.log文件，用UE打开。\r\n4、搜索格式为Tunnel-id XXX has been used for primary的配置，找到这句话基本就可以定位哪个Tunnel-id冲突了。LSP1:1保护的话，一般会报两个Tunnel-id冲突的，两个都要删除。\n \n如果抓取不到的话，可以辅助打开中间层日志开关命令：\r\nRouter#con t\r\nRouter#debug nmagent on\r\nRouter#debug nmagentmsgrecv send\r\nRouter#log file name.log\n抓取log后必须关闭，关闭中间层日志开关命令：\r\nRouter#con t\r\nRouter#debug nmagent off\n根因:设备底层配置内存在残留数据，占用了一些tunnel关键字信息，在网管新建tunnel时分配到了相同的id时，下发报错，需要将底层残留的无效数据删除。\n解决方案:1、打开本站的ZEBOS文件，搜索Tunnel-id XXX，找到mpls ftn-table tunnel-id XXX---这句话，复制。注意最后面的y1731 XXX不要，只要egress +IP地址之前的。\r\n2、登陆协议栈， conf t ，进入配置模式，no (粘贴刚才复制的话），回车即输入执行了。\r\n3、若没有返回错误，就表示删除成功。此时应该可以从网管上重新下载需要新建的Tunnel了。\n \n如果第3步执行后在网管下发tunnel依旧报错，此时在协议栈查看冲突的tunnel依旧为删除，可以尝试采用下述方法：\n4、查询获取到冲突tunnel对应的ftn-id，有两种方法，推荐采用第一张方法。\r\n第一种方法：\r\nrouter#sh mpls forwarding-table\r\nCodes: > - selected FTN, p - stale FTN, B - BGP FTN, K - CLI FTN,\r\n       L - LDP FTN, R - RSVP-TE FTN, S - SNMP FTN, I - IGP-Shortcut,\r\n       U - unknown FTN\r\n \r\nCode    FEC                 Tunnel-id   FTN-ID    Pri  Nexthop          Out-Label    Out-Intf     LSP-Type    Addr      Up-Time\r\nK>      21.144.121.144/32   2608        2640      Yes  173.0.0.26       59240        GE0/23/3     LSP_DEFAULT  526e8c28     01d03h43m\r\nK>      21.144.121.144/32   2609        2641      Yes  173.29.145.10    59242        XGE0/7/1     LSP_DEFAULT  526e8d70     01d03h43m\r\n \r\n或者第二种：\r\nrouter#show mpls ftn-table\r\nPrimary FTN entry with FEC: 21.144.121.144/32, id: 2641, row status: Active\r\n  Owner: CLI, Action-type: Redirect to LSP, Exp-bits: 0x0, Incoming DSCP: be\r\n  Tunnel id: 2609,   Protected LSP id: 2, Description: 195-3.183-29.a31.1e1037f4.1\r\n, Bfd id:0, MPLS-TP OAM Y1731 Initiative id:4873  Cross connect ix: 5514, in intf: - in label: 0 out-segment ix: 5514, ref: 1\r\n    Owner: CLI, Persistent: No, Admin Status: Up, Oper Status: Up\r\n   nhlfe:526069e8, Out-segment with ix: 5514, owner: CLI, out intf: XGE0/7/1, out label: 59242\r\n    Nexthop addr: 173.29.145.10    cross connect ix: 5514, op code: Push\r\n    Active\r\n    Ref count: 1\r\n     Up Time: 01d03h43m\r\n Addr: 526e8d70, pn:6b91a1a0\n\r\n5、删除命令：\r\n登陆协议栈， conf t ，进入配置模式，输入no mpls ftn-entry 21.144.121.144/32 2641\n6、再次下载需要新建的tunnel。\n原因分类:无\n"}
{"instruction": "IP-FRR倒换后备用落地到汇聚网关的路由迭代错误导致单挂汇聚基站业务故障。1、某日省干OTN一网元掉电导致我司新大楼R865主用至MCE1链路中断。局方反馈本地网承载的4G部分基站受到影响，出现断链告警，统计到343个4G基站管理中断（部分正常）。\n2、IPRAN网管在故障时间出现对接端口DOWN及IPFRR倒换、恢复整个过程相关告警。从网管看主用中断后触发了IPFRR保护。但从时间上分析，当主用断后，这343个基站出现了断链，至主用通道恢复正常后逐步恢复正常。", "input": "", "output": "案例主题:IP-FRR倒换后备用落地到汇聚网关的路由迭代错误导致单挂汇聚基站业务故障\n案例编号:AL202004085348\n网络场景:1、静态网络\n2、主备R865作为落地设备，网间保护方式为IPFRR保护。主备R865分别LAG口直连MCE设备，中间通道为省干OTN。主备落地各配置LAG3，子接口LAG3.100为管理VPN出口。LAG3.200为业务VPN出接口。\n\n\n\n\n设备名称\n\n\n端口名称\n\n\nIP\n\n\n设备名称\n\n\n端口名称\n\n\nIP\n\n\n\n\n新大楼865\n\n\nLAG3.100\n\n\n10.109.0.2/30\n\n\nMCE1\n\n\n \n\n\n10.109.0.1/30\n\n\n\n\nLAG3.200\n\n\n10.109.0.6/30\n\n\n \n\n\n10.109.0.5/30\n\n\n\n\nLAG3.3008\n\n\n10.55.0.66/30\n\n\n \n\n\n10.55.0.65/30\n\n\n\n\n国信865\n\n\nLAG3.100\n\n\n10.109.0.10/30\n\n\nMEC2\n\n\n \n\n\n10.109.0.9/30\n\n\n\n\nLAG3.200\n\n\n10.109.0.14/30\n\n\n \n\n\n10.109.0.13/30\n\n\n\n\nLAG3.3008\n\n\n10.55.0.70/30\n\n\n \n\n\n10.55.0.69/30\n\n\n\n\n3、业务模式为L2/L3。\n现象描述:1、某日省干OTN一网元掉电导致我司新大楼R865主用至MCE1链路中断。局方反馈本地网承载的4G部分基站受到影响，出现断链告警，统计到343个4G基站管理中断（部分正常）。\n2、IPRAN网管在故障时间出现对接端口DOWN及IPFRR倒换、恢复整个过程相关告警。从网管看主用中断后触发了IPFRR保护。但从时间上分析，当主用断后，这343个基站出现了断链，至主用通道恢复正常后逐步恢复正常。\n处理过程:1、当日分析网管告警判断IPFRR保护正常触发，此时间段未发生其它光缆和设备故障。\n2、第二日凌晨进行IPFRR倒换，复现了故障现象：\n汇聚设备带受影响基站网关为源长ping 4G服务器地址，当主用激光器关闭后ping测中断；\n汇聚设备带未受影响基站网关为源长ping 4G服务器地址，当主用激光器关闭后ping测正常；\n汇聚设备带受影响基站网关为源长ping 备用落地互联口地址，当主用激光器关闭后ping测中断；\n备用落地以出接口为源ping汇聚网元loopback0不通。\n3、倒换后备用落地设备查询汇聚网元loopback0地址转发\nroute#SHOW IP route vrf L3VPN-17 10.19.1.1\r\nRouting entry for 10.19.0.0/18\r\n  known via \"bgp\",distanse 20,metric 0,best\r\n  Last update 11w0d19h ago\r\n *  10.19.0.9 via lag3.100\n私网BGP学习到了MCE发布的路由10.19.0.0/18，出接口为UNI口lag3.100。学习到的BGP私网路由与现网的loopback0地址冲突；IP-FRR倒换后，备用落地到汇聚网关的路由迭代错误，正常情况应该发往NNI口至汇聚，但从这里看落地给汇聚的报文发送到了CE。单挂站无路由保护，优先匹配了私网路由，落地到网关的下一跳路由是从对端bgp私网学习到的，对于配置了ECMP/VPN-FRR路由保护时，优先选择公网路由，不会出现成环现象，业务转发正常。所以本次中断了部分基站的管理，一部分正常。\n4、在备用落地上添加入方向过滤后，刷新BGP路由正常。\n \naddress-family ipv4 vrf L3VPN-17\r\n network 10.109.126.0/24\r\n network 10.109.127.0/24\r\n network 10.109.128.0/24\r\n network 10.109.129.0/24\r\n network 10.109.130.0/24\r\n network 10.109.131.0/24\r\n network 10.109.132.0/24\r\n network 10.109.133.0/24\r\n network 10.109.134.0/24\r\n network 10.109.135.0/24\r\n network 10.109.136.0/24\r\n network 10.109.137.0/24\r\n network 10.109.138.0/24\r\n network 10.109.139.0/24\r\n network 10.109.140.0/24\r\n network 10.109.141.0/24\r\n network 10.109.142.0/24\r\n network 10.109.143.0/24\r\n neighbor 10.109.0.1 remote-as 64901\r\n neighbor 10.109.0.1 update-source 10.109.0.2\r\n neighbor 10.109.0.1 advertisement-interval 5\r\n neighbor 10.109.0.1 timers connect 120\r\n neighbor 10.109.0.1 activate\r\n neighbor 10.109.0.1 route-map rp_loopback_in in     （增加入口策略）\r\n neighbor 10.109.0.1 route-map LTE-OAM-VPN out\r\n exit-address-family\r\n !\nroute-map rp_loopback_in permit 100\nmatch ip address prefix-list pl_loopback_in\nip prefix-list pl_loopback_in: 2 entries\nseq 5 deny 10.19.0.0/16 le 32\nseq 10 permit any\n \n5、主控主备切换，tne route更新出口为NNI口。\n6、再次倒换测试正常。\n \n根因:现网loopback0地址与学习到的BGP私网地址冲突，IP-FRR倒换后，备用落地到汇聚网关的路由迭代错误导致落地给汇聚的报文发送到了 CE。\n解决方案:在备用落地添加入方向过滤，禁止接收与现网loopback0同网段的路由。\n \n原因分类:无\n"}
{"instruction": "ONU上行超量广播包攻击导致线卡下家宽拨号业务故障。    某地区工程使用我司PON产品，终端为GPON异厂家HGU。同时开通了家宽、语音、RMS等业务，某日发现部分ONU业务异常，OLT的主控FDB地址学习表中，只学习到了语音、TR069的MAC，部分宽带数据MAC+VLAN并没有在线卡侧学习到。", "input": "", "output": "案例主题:ONU上行超量广播包攻击导致线卡下家宽拨号业务故障\n案例编号:AL202004085364\n网络场景:普通家宽GPON业务场景：\n\n现象描述:    某地区工程使用我司PON产品，终端为GPON异厂家HGU。同时开通了家宽、语音、RMS等业务，某日发现部分ONU业务异常，OLT的主控FDB地址学习表中，只学习到了语音、TR069的MAC，部分宽带数据MAC+VLAN并没有在线卡侧学习到。\n处理过程:\n检查OLT软件、硬件版本，未发现问题。其中，故障集中在一块GPON业务卡，软件为V4.2版本，硬件为Maple GCOB。\r\n\t\n \n\n进一步排查线卡，发现部分ONU在PON MAC侧只学习到语音、TR069的MAC，宽带MAC都没上到线卡交换。对线卡进行show task、show cpu检查，发现show cpu中显示lineid_hal进程CPU利用率占用率高。了解详细情况后，我们发现该线卡lineid_hal进程是控制pppoe+报文处理的，对比这个OLT和其它OLT，唯独这个OLT的lineid_hal资源占用率远高于其它其它正常OLT。如下图5所示：上图：Maple GCOB线卡show cpu情况\r\n\t\n \n\n由于该运营商所有业务都是开通了PPPoE+业务的，家宽用户通过PPPoE拨号中携带ONUID、ONU位置等信息，这些信息作为附加的线路标识完成，通过线卡lineid模块完成。而此刻，故障均是存在于该线卡，由此分析确实与之前lineid_hal资源占用率高有关系，故需要通过线卡进一步排查lineid相关模块。\r\n\t\n \n\n通过登录Maple GPON线卡，进入debug目录中，set default_print_to_me打开打印重定向开关，再转入lineid目录，输入show statistics，记录lineid打印信息。我们立刻发现lineid模块中，有大量pppoe报文待处理，具体如下图所示：上图：表示上行pppoe报文处理计数。        在后面的打印中，我们看到了该线卡下某个用户VLAN中收到的PADI计数非常大，达到500多万，对比其它用户VLAN计数，相差了十多万倍。如下图所示：上图：表示lineid模块收到PADI广播包计数\r\n\t\n \n\n进一步，逐步定位上行广播包所在PON口，通过stat目录中，show stats_pon pon ponno flag <0|1> 命令统计rx_gem_packets计数（表示PON口上行所有gemport中报文计数）。通过反复清零观察（即flag后参数选1），第8 PON口在清零后的计数最多的，是其它PON口的10倍以上，逐将问题点定位在8 PON口。上图：统计到异常PON口rx收上行包计数。  上图：统计到正常PON口rx收上行包计数。\r\n\t\n \n\n再进一步通过交换端口统计，完全确认了8 PON口上行收到大量广播包。通过show stats_switch portno flag <0|1> 命令（flag后参数选1），统计Rx BroadcastPkts 上行广播包计数，确凿了问题就出在8 PON口某个ONU上。通过以上两图，即不停对比每个PON口的清零统计（flag 1），确认到 8 PON口仍不断收到大量上行广播包，故锁定到PON 8异常。\r\n\t\n \n\n通过查看ONU所有属性命令，得到ONU相关gemport、告警、光功和收发包计数信息。具体在stat目录，show onu all_properties ponno onuid flag <0|1> 命令查看（这里根据前面排查结果，pon_id参数为8，flag后参数选1，然后onu_id从1-64逐个查看）。最后，我们在8PON第30号ONU发现问题，如下图所示：上图，通过对每台ONU逐个清零统计，发现上行超量广播包从8PON第30号ONU过来。\r\n\t\n \n\n最后，验证我们前面的判断，将此ONU阻塞。首先登录到ONU目录，使用 set onu state ponno 8 onuno 30 disable 命令执行，再转到stat目录，再次清零刷新查看8 PON口上行广播包计数，show stats_switch portno 8 flag 1，结果如下：上图，阻塞8PON第30号ONU。     上图，阻塞后的上行广播包为0。   上图，线卡lineid_hal进程恢复正常。   我们再通过debug中show cpu，看到lineid_hal进程资源消耗变为零，询问大面积报障的客户，客户们反馈均成功拨号，已经可以正常使用宽带业务了，故障解决。\r\n\t\n \n\nMaple GC8B盘查询记录：链接：https://pan.baidu.com/s/1_Z0LvKgkUhYy0C_URLJEeA\r\n\t提取码：hsip\r\n\t \n\n根因:1、线卡级故障，故障范围首先确认在线卡，受影响仅为PPPoE拨号家宽用户。同时，因为语音、TR069业务不带PPPOE或IPOE验证，由PON系统直接透传，故更将故障范围锁定在线卡处理PPPoE+添加线路标识这部分。通过对比其它正常线卡和OLT，在该线卡debug中用show cpu确认了lineid_hal进程占用资源较高。下图所示，线卡lineid_hal进程异常：\n\n\n2、通过PON口统计rx_gem_packets计数、交换端口Rx BroadcastPkts统计，完全锁定了在该线卡8 PON口，在该PON口上行方向收到大量广播包，确凿了问题就出在8 PON口某个ONU上（此问题理解类似于流氓ONU问题，但并非流氓ONU，为ONU侧用户异常报文冲击PON口到线卡交换芯片）。下两图所示，线卡交换侧观察，ONU大量上行广播报文冲击线卡交换：\n\n \n \n解决方案:    通过阻塞ONU，消除了上行广播包冲击。通过线卡ONU目录中，set onu state ponno onuno disable 命令执行。该用户报障后，在该用户侧解决异常报文冲击，再通过set onu state ponno onuno enable 命令反阻塞。解决故障源冲击后，在线卡debug目录中show cpu确认lineid_hal任务恢复正常。下图，对异常ONU阻塞，解决用户ONU侧的广播包冲击问题后再去阻塞ONU恢复，之后线卡lineid_hal进程恢复正常，业务也恢复正常：\n \n原因分类:无\n"}
{"instruction": "我司OLT下华为ONU语音业务单通问题。马来西亚电信我司OLT与华为ONU对接时，待OLT上学习到的语音 MAC地址老化后华为ONU作为被叫时无法呼入成功，但是作为主叫时呼出正常的现象。", "input": "", "output": "案例主题:我司OLT下华为ONU语音业务单通问题\n案例编号:AL202004095409\n网络场景:\n现象描述:马来西亚电信我司OLT与华为ONU对接时，待OLT上学习到的语音 MAC地址老化后华为ONU作为被叫时无法呼入成功，但是作为主叫时呼出正常的现象。\n处理过程:\n针对华为报告所描述，语音业务流转发时存在gemportid变化的问题，我司积极进行排查，具体分析如下。\n\n华为报告描述如下图：\n \n根据现网抓取OMCI报文和业务流报文，确认此点不是问题，具体描述如下：\n1）gemportid 1和gemportid 3的数据转发是正常转发，符合标准。其中gemportid 1为广播通道，gemportid 3为单播通道。在OMCI配置下发时，会指定哪个gemportid为广播通道gemport，采用GPON DOCTOR仪表连接OLT和ONU，设置为协议抓包模式抓取OMCI报文。\nGEM port network CTP，即meid 268，配置中指定gemportid和转发报文方向，如下图：\n\nGEM interworking termination point，即meid 266，指定此gemportid的属性为广播包，如下图：\n\n当mac地址没有老化的时候，上下行走单播通道，即华为报告中的gemportid 3。当mac地址老化之后，被叫时走下行广播通道，即华为报告中的gemportid 1，是按照标准正常转发，而不是异常的gemportid变化。\n2）对比我司OLT下挂各厂家ONU的下行广播报文转发方式\n采用GPON DOCTOR仪表连接OLT和ONU，设置为业务流抓包模式，抓取gemportid 1的数据流，仪表设置如下：\n \nA、下挂华为ONU\n确认华为ONU的语音mac地址老化之后，拨打此ONU的电话，抓包如下：\n \n确认下行的语音报文已经从OLT的gemport 1转发给ONU，而此时语音呼叫不通，说明华为未处理此报文，或者丢弃此报文，此点和华为报告描述一致，证明华为ONU处理语音广播报文存在问题。\nB、下挂阿朗ONU\n由于阿郎ONU每个30秒会发送一次上行ARP报文，而OLT的老化时间大于此时间，故正常情况下，语音的mac地址一直不会老化，下行不会走广播通道。为抓取下行流从广播通道转发的情况，我司采用删除语音mac地址的方式模拟mac地址老化，然后马上拨打电话，抓取报文如下：\n \n确认此时语音被叫业务正常，可以正常通话，说明同样的条件下，阿朗ONU对广播报文处理没有问题。\n \n\n针对华为描述，我司广播通道和数据通道共桥，导致语音无法接收到此广播报文的问题，我司说明如下。\r\n\t\n我司下发广播通道和数据通道共桥原因说明。\n\n\n\n在G.988协议II.1.3中定义了如下配置模型：\n \n从模型图中可以看出，单播、组播和广播为共桥，且UNI侧关联的PPTP，即LAN口业务，故我司软件中将广播通道和数据通道设置为共桥，此点符合G.988协议。\n\n数据流转发说明。\n\n对于OMCI配置模型，是用于配置下发的，即ONU可以通过模型中的关联方式找到配置所需的关键参数，例如allocid、gemportid、vlanid等，从而让这些参数在ONU的底层生效。而对于业务流的走向，应该是基于allocid、gemportid和vlanid，遵循以太网原理和PON原理，而不应该按照OMCI模型来理解业务流的走向。\n特别是对于广播包，这是一个特殊报文，与其他单播报文的处理是有所区别的。收到广播包的设备，应该将此包广播至同vlanid的所有端口，而不应该和OMCI的桥强关联，此点不符合基本以太网原理。\n如果按照华为的解释，广播通道和桥是强关联的，那么，所有业务就必须走同一个桥，否则，广播通道和任何一种业务共桥，另一种业务就会收到影响了，但是，G.988标准中对OMCI模型的定义是存在多桥的情况的，例如：1:p，1:mp，1:m，这种情况就无法支持了，所以此解释不符合G.988协\n\n我司在现网测试情况如下。\r\n\t\n只配置语音POTS端口业务，不配置端口数据业务和端口组播业务，均未发现ONU语音业务异常现象。\n\n\n\n此时，广播通道和语音配置依然不是共桥的，但是华为ONU对下行的广播报文处理却没有问题，说明广播通道并不是一定要和语音配置共桥。\n\n在步骤1）的基础上，增加端口数据业务配置，此时ONU语音业务开始出现异常，当OLT上学习到ONU上来的语音MAC老化后，ONU作为被叫开始出现无法呼入的现象，而ONU作为主叫则一切正常。\n\n此点说明，华为ONU不是要求广播通道和语音共桥，而是要求广播通道不要和其他业务共桥，这点和标准不符。\n根因:华为ONU对下行广播报文的处理存在问题，故导致语音被叫业务异常\n解决方案:\n对下行广播报文取消和桥的关联，按照以太网报文转发规则，广播到同vlanid的所有端口。\n下行ARP包的时间间隔改短至低于300秒，或者WEB页面增加ARP包时间间隔参数配置，可根据业务具体需求配置ARP包间隔。\n\n      推荐使用第一种方案，可以彻底解决广播报文的处理问题，第二种方案仅为规避方案。\n原因分类:无\n"}
{"instruction": "CiTRANS 680添加静态ARP失败问题解决案例。【现象描述】\n某新大楼680-2为主用L2/3，,某邮政楼680-2为备用L2/3设备，某邮政楼680-2在添加L2VE0/0/10接口下所有子接口的静态ARP时候报错添加静态路由失败，操作返回1025，某新大楼680-2添加静态ARP正常。\n", "input": "", "output": "案例主题:CiTRANS 680添加静态ARP失败问题解决案例\n案例编号:AL202004075317\n网络场景:移动PTN工程680设备V2.0SP3版本\n\n现象描述:【现象描述】\n某新大楼680-2为主用L2/3，,某邮政楼680-2为备用L2/3设备，某邮政楼680-2在添加L2VE0/0/10接口下所有子接口的静态ARP时候报错添加静态路由失败，操作返回1025，某新大楼680-2添加静态ARP正常。\n\n处理过程:【处理分析】 \n1、选取其中一条静态路由添加测试，首先进行保存到数据库操作，返回成功，排除网管问题，登录协议栈通过命令行添加该条静态路由，添加失败，确定为设备问题。\nrouter(config)#arp 100.77.176.118 fcc8.97dd.06f4 vrf L3VPN-8 vid 66 interface L2VE0/0/10.66  \narp 100.77.176.118 fcc8.97dd.06f4 vrf L3VPN-8 vid 66 interface L2VE0/0/10.66router(config)#\nrouter(config)#\n \n2、登录协议栈SHOW ARP，查看ARP条目，无L2VE0/0/10接口下所有子接口的静态ARP条目，排除协议栈数据残留。\n3、在协议栈检查相关的L3VE主接口子接口、L2VE主接口子接口配置正确，检查L3VPN上下话端口配置正常，排除配置问题。\nrouter#show run interf L2VE0/0/10.119\n!\ninterface L2VE0/0/10.119\n no shutdown\n switchport\n uni stream-type 1\n uni stream-id 1 ovlan 119\n mpls-l2-circuit 83-4.200-2.1ed ethernet\n commit\n!\nrouter#show run interf L3VE0/0/10.66\n!\ninterface L3VE0/0/10.66\n dot1q termination vid 66 to 128 vlan-group 1\n ip proxy-arp\n ip vrf forwarding L3VPN-8\n ip address 100.77.176.65/26\n no shutdown\n vlan type svlan \n commit\n!\nrouter#show ip vrf L3VPN-8\nVRF L3VPN-8,vrf-id:1 , FIB ID 1\nRouter ID: 100.77.178.193 (automatic)\nInterfaces:\n  L3VE0/0/1.2\n  L3VE0/0/2.66\n  L3VE0/0/3.130\n  L3VE0/0/4.194\n  L3VE0/0/5.130\n  L3VE0/0/6.66\n  L3VE0/0/7.130\n  L3VE0/0/8.194\n  L3VE0/0/9.2\n  L3VE0/0/10.66\n \n \n \nVRF L3VPN-8; default RD 100:8\nInterfaces:\n  L3VE0/0/1.2\n  L3VE0/0/2.66\n  L3VE0/0/3.130\n  L3VE0/0/4.194\n  L3VE0/0/5.130\n  L3VE0/0/6.66\n  L3VE0/0/7.130\n  L3VE0/0/8.194\n  L3VE0/0/9.2\n  L3VE0/0/10.66\nExport VPN route-target communities\n  RT:100:8\nImport VPN route-target communities\n  RT:100:8\nNo import route-map\n4、抓包分析故障原因。\n \nrouter(config)#debug nsm log all\nrouter(config)#\nrouter(config)#\nrouter(config)#\nrouter(config)#log file l3ve.txt\nrouter(config)#arp 100.77.176.118 fcc8.97dd.06f4 vrf L3VPN-8 vid 119 interface L2VE0/0/10.119 \narp 100.77.176.118 fcc8.97dd.06f4 vrf L3VPN-8 vid 119 interface L2VE0/0/10.119 router(config)#\nrouter(config)#no debug nsm log all\n日志返回:\n \n10/15 20:13:27.928 0x676ff480 info: NSM: \n0000  02 06 00 c9 00 00 00 64 - 00 00 d4 c6 00 00 00 00   .......d........\n0010  00 00 00 04 64 4d b0 76 - 00 01 00 06 fc c8 97 dd   ....dM.v........\n0020  06 f4 00 02 00 14 4c 33 - 56 50 4e 2d 38 00 00 00   ......L3VPN-8...\n0030  00 00 00 00 00 00 00 00 - 00 00 00 03 00 02 00 77   ...............w\n0040  00 04 00 20 4c 32 56 45 - 30 2f 30 2f 31 30 2e 31   ... L2VE0/0/10.1\n0050  31 39 00 00 00 00 00 00 - 00 00 00 00 00 00 00 00   19..............\n0060  00 00 00 00             -                           ....            \n \n10/15 20:13:27.929 0x676ff480 error: NSM: add arp fail, error value is -1! nsm_handle_static_arp_add_nmconfig 364\n \n10/15 20:13:27.929 0x676ff480 info: NSM: Nsm send msg to nmagent: s_module_num is NSM, d_module_num is NMAGENT\nadd config, data_type: static arp config, data_len: 16, msg_id: 54470, error_code: 1025.\n5、登录主控盘底层查看ARP学习。\n[root@RCU-1 ~]telnet 127.0.0.1 3000\nTrying 127.0.0.1...\nConnected to localhost (127.0.0.1).\nEscape character is '^]'.\nCopyright (c) Interpeak AB 2000-2010. All rights reserved.\n \nWelcome to IPCOM SHELL. Type help for a list of commands.\n \n127.0.0.1#0> arp -a   \n  100.77.176.118 at 00:00:00:00:00:00 on L3VE0/0/10.66       INCOMPLETE 0:0:0\n  100.77.176.111 at 00:00:00:00:00:00 on L3VE0/0/10.66       INCOMPLETE 0:0:0\n     14.82.66.89 at ac:c8:02:05:01:00 permanent published on QXGE0/5/1        REACHABLE\n   100.77.176.65 at ac:c8:02:04:02:0a permanent published on L3VE0/0/10.66        REACHABLE\n   100.77.176.78 at 00:00:00:00:00:00 on L3VE0/0/10.66       INCOMPLETE 0:0:0\n     14.81.66.89 at ac:c8:02:0d:02:00 permanent published on XGE0/13/2        REACHABLE\n   100.77.176.73 at 00:00:00:00:00:00 on L3VE0/0/10.66       INCOMPLETE 0:0:0\n   100.77.176.81 at 00:00:00:00:00:00 on L3VE0/0/10.66       INCOMPLETE 0:0:0\n  100.77.176.120 at 00:00:00:00:00:00 on L3VE0/0/10.66       INCOMPLETE 0:0:0\n   100.77.176.84 at 00:00:00:00:00:00 on L3VE0/0/10.66       INCOMPLETE 0:0:0\n     14.82.68.89 at ac:c8:02:0c:01:00 permanent published on QXGE0/12/1        REACHABLE\n     14.81.68.62 at ac:c8:02:0a:01:00 permanent published on QXGE0/10/1        REACHABLE\n发现通过L3VE0/0/10.66接口学习上来了该网关的ARP，ARP地址没有在L3VPN-8内。\n6、查看主控盘底层接口配置。\n127.0.0.1#0> ifconfig -V 1 -a\nL3VE0/0/1.2     Link type:Layer 2 virtual LAN  HWaddr ac:c8:01:04:02:01  Queue:none\n        vlan: 2 vlan priority: 7 parent: L3VE0/0/1 \n        vlan: IPNET_IFF2_VLAN_TERM \n        inet 100.77.177.1  mask 255.255.255.192  broadcast 100.77.177.63\n        UP RUNNING SIMPLEX BROADCAST MULTICAST \n        MTU:1500  metric:0  VR:1  ifindex:536875010\n        RX packets:543840 mcast:0 errors:0 dropped:0\n        TX packets:284575 mcast:0 errors:0\n        collisions:0 unsupported proto:0\n        RX bytes:30M  TX bytes:17M\n \nL3VE0/0/2.66    Link type:Layer 2 virtual LAN  HWaddr ac:c8:01:04:02:02  Queue:none\n        vlan: 66 vlan priority: 7 parent: L3VE0/0/2 \n        vlan: IPNET_IFF2_VLAN_TERM \n        inet 100.77.177.65  mask 255.255.255.192  broadcast 100.77.177.127\n        UP RUNNING SIMPLEX BROADCAST MULTICAST \n        MTU:1500  metric:0  VR:1  ifindex:536879170\n        RX packets:168292 mcast:0 errors:0 dropped:0\n        TX packets:74265 mcast:0 errors:0\n        collisions:0 unsupported proto:0\n        RX bytes:9424k  TX bytes:4457k\n \nL3VE0/0/3.130   Link type:Layer 2 virtual LAN  HWaddr ac:c8:01:04:02:03  Queue:none\n        vlan: 130 vlan priority: 7 parent: L3VE0/0/3 \n        vlan: IPNET_IFF2_VLAN_TERM \n        inet 100.77.177.129  mask 255.255.255.192  broadcast 100.77.177.191\n        UP RUNNING SIMPLEX BROADCAST MULTICAST \n        MTU:1500  metric:0  VR:1  ifindex:536883330\n        RX packets:2454 mcast:0 errors:0 dropped:0\n        TX packets:488 mcast:0 errors:0\n        collisions:0 unsupported proto:0\n        RX bytes:138k  TX bytes:30k\n \nL3VE0/0/4.194   Link type:Layer 2 virtual LAN  HWaddr ac:c8:01:04:02:04  Queue:none\n        vlan: 194 vlan priority: 7 parent: L3VE0/0/4 \n        vlan: IPNET_IFF2_VLAN_TERM \n        inet 100.77.177.193  mask 255.255.255.192  broadcast 100.77.177.255\n        UP RUNNING SIMPLEX BROADCAST MULTICAST \n        MTU:1500  metric:0  VR:1  ifindex:536887490\n        RX packets:17778923 mcast:0 errors:0 dropped:0\n        TX packets:4501381 mcast:0 errors:0\n        collisions:0 unsupported proto:0\n        RX bytes:995M  TX bytes:270M\n \nL3VE0/0/5.130   Link type:Layer 2 virtual LAN  HWaddr ac:c8:01:04:02:05  Queue:none\n        vlan: 130 vlan priority: 7 parent: L3VE0/0/5 \n        vlan: IPNET_IFF2_VLAN_TERM \n        inet 100.77.176.129  mask 255.255.255.192  broadcast 100.77.176.191\n        UP RUNNING SIMPLEX BROADCAST MULTICAST \n        MTU:1500  metric:0  VR:1  ifindex:536891522\n        RX packets:17652326 mcast:0 errors:0 dropped:0\n        TX packets:6519382 mcast:0 errors:0\n        collisions:0 unsupported proto:0\n        RX bytes:1088M  TX bytes:561M\n \nL3VE0/0/6.66    Link type:Layer 2 virtual LAN  HWaddr ac:c8:01:04:02:06  Queue:none\n        vlan: 66 vlan priority: 7 parent: L3VE0/0/6 \n        vlan: IPNET_IFF2_VLAN_TERM \n        inet 100.77.178.65  mask 255.255.255.192  broadcast 100.77.178.127\n        UP RUNNING SIMPLEX BROADCAST MULTICAST \n        MTU:1500  metric:0  VR:1  ifindex:536895554\n        RX packets:11814293 mcast:0 errors:0 dropped:0\n        TX packets:2610320 mcast:0 errors:0\n        collisions:0 unsupported proto:0\n        RX bytes:661M  TX bytes:156M\n \nL3VE0/0/7.130   Link type:Layer 2 virtual LAN  HWaddr ac:c8:02:04:02:07  Queue:none\n        vlan: 130 vlan priority: 7 parent: L3VE0/0/7 \n        vlan: IPNET_IFF2_VLAN_TERM \n        inet 100.77.178.129  mask 255.255.255.192  broadcast 100.77.178.191\n        UP RUNNING SIMPLEX BROADCAST MULTICAST \n        MTU:1500  metric:0  VR:1  ifindex:536899714\n        RX packets:970 mcast:0 errors:0 dropped:0\n        TX packets:408 mcast:0 errors:0\n        collisions:0 unsupported proto:0\n        RX bytes:57k  TX bytes:27k\n \nL3VE0/0/8.194   Link type:Layer 2 virtual LAN  HWaddr ac:c8:02:04:02:08  Queue:none\n        vlan: 194 vlan priority: 7 parent: L3VE0/0/8 \n        vlan: IPNET_IFF2_VLAN_TERM \n        inet 100.77.178.193  mask 255.255.255.192  broadcast 100.77.178.255\n        UP RUNNING SIMPLEX BROADCAST MULTICAST \n        MTU:1500  metric:0  VR:1  ifindex:536903874\n        RX packets:18377303 mcast:0 errors:0 dropped:0\n        TX packets:6575209 mcast:0 errors:0\n        collisions:0 unsupported proto:0\n        RX bytes:1029M  TX bytes:394M\n \nL3VE0/0/9.2     Link type:Layer 2 virtual LAN  HWaddr ac:c8:02:04:02:09  Queue:none\n        vlan: 2 vlan priority: 7 parent: L3VE0/0/9 \n        vlan: IPNET_IFF2_VLAN_TERM \n        inet 100.77.176.1  mask 255.255.255.192  broadcast 100.77.176.63\n        UP RUNNING SIMPLEX BROADCAST MULTICAST \n        MTU:1500  metric:0  VR:1  ifindex:536907778\n        RX packets:437 mcast:0 errors:0 dropped:0\n        TX packets:141 mcast:0 errors:0\n        collisions:0 unsupported proto:0\n        RX bytes:24k  TX bytes:8460\n \ninloopback1     Link type:Local loopback  Queue:none\n        inet 127.0.0.1  mask 255.255.255.255\n        UP RUNNING LOOPBACK MULTICAST NOARP \n        MTU:16384  metric:1  VR:1  ifindex:1879048199\n        RX packets:34 mcast:0 errors:0 dropped:0\n        TX packets:34 mcast:0 errors:0\n        collisions:0 unsupported proto:0\n        RX bytes:2376  TX bytes:2376\n \nVRF1    Link type:Local loopback  Queue:none\n        UP RUNNING LOOPBACK MULTICAST NOARP \n        MTU:16384  metric:1  VR:1  ifindex:1879048200\n        RX packets:887 mcast:0 errors:0 dropped:0\n        TX packets:1238 mcast:0 errors:0\n        collisions:0 unsupported proto:0\n        RX bytes:68k  TX bytes:119k\n返回发现接口配置内没有L3VE0/0/10.66的配置数据，而协议栈内查看有L3VE0/0/10.66接口的配置数据，确定为协议栈配置和主控盘配置不同步问题。\n解决方法：\n1、登录协议栈将L3VE0/0/10.66接口从L3VPN-8内剔除再添加进去\nrouter#con t\nrouter(config)#inter L3VE0/0/10.66\nrouter(config-if)#no ip vrf forwarding L3VPN-8\nrouter(config-if)#ip vrf forwarding L3VPN-8   \nrouter(config-if)#\nrouter(config-if)#ip address 100.77.176.65/26\nrouter(config-if)#quit\n2、主控盘底层查看接口配置和ARP学习。\n127.0.0.1#0> ifconfig  -V 1 -a\nL3VE0/0/10.66   Link type:Layer 2 virtual LAN  HWaddr ac:c8:02:04:02:0a  Queue:none\n        vlan: 66 vlan priority: 7 parent: L3VE0/0/10 \n        vlan: IPNET_IFF2_VLAN_TERM \n        inet 100.77.176.65  mask 255.255.255.192  broadcast 100.77.176.127\n        UP RUNNING SIMPLEX BROADCAST MULTICAST \n        MTU:1500  metric:0  VR:1  ifindex:536911938\n        RX packets:340 mcast:0 errors:0 dropped:0\n        TX packets:3240 mcast:0 errors:0\n        collisions:0 unsupported proto:0\n        RX bytes:21k  TX bytes:429k\n127.0.0.1#0> arp -a\n     14.82.66.89 at ac:c8:02:05:01:00 permanent published on QXGE0/5/1        REACHABLE\n     14.81.66.89 at ac:c8:02:0d:02:00 permanent published on XGE0/13/2        REACHABLE\n     14.82.68.89 at ac:c8:02:0c:01:00 permanent published on QXGE0/12/1        REACHABLE\n     14.81.68.62 at ac:c8:02:0a:01:00 permanent published on QXGE0/10/1        REACHABLE\n     14.82.66.90 at ac:bd:08:0b:01:00 permanent on QXGE0/5/1        REACHABLE\n     14.81.68.61 at ac:c8:01:0a:01:00 permanent on QXGE0/10/1        REACHABLE\n     14.82.68.90 at ac:be:0e:0b:01:00 permanent on QXGE0/12/1        REACHABLE\n 135.135.135.135 at ac:c8:02:00:00:00 permanent published on mngt0        REACHABLE\n     14.81.66.90 at ac:05:02:0b:02:00 permanent on XGE0/13/2        REACHABLE\n 255.255.255.255 at ff:ff:ff:ff:ff:ff on L2VE0/0/3.170        REACHABLE 0:59:47\n \n3、协议栈添加静态ARP正常。\n \nrouter(config)#arp 100.77.176.118 fcc8.97dd.06f4 vrf L3VPN-8 vid 119 interface L2VE0/0/10.119\nrouter(config)#end\nrouter#        \n根因:返回发现接口配置内没有L3VE0/0/10.66的配置数据，而协议栈内查看有L3VE0/0/10.66接口的配置数据，确定为协议栈配置和主控盘配置不同步问题。\n解决方案:解决方法：\n1、登录协议栈将L3VE0/0/10.66接口从L3VPN-8内剔除再添加进去\n原因分类:无\n"}
{"instruction": "电信联通互联互通IPRAN网络修改发布明细路由为汇总路由导致业务中断的故障案例。某联通运营商进行与电信互联互通测试，本次操作需要在现有4G业务L3VPN进行相关操作，需要重新发布路由和部署路由策略，安排时间为凌晨。网管操作完成后，全网4G基站业务中断。", "input": "", "output": "案例主题:电信联通互联互通IPRAN网络修改发布明细路由为汇总路由导致业务中断的故障案例\n案例编号:AL202004095385\n网络场景:联通IPRAN 与电信IPRAN 核心落地设备互联互通，联通IPRAN配置IPFRR保护，电信IRPAN配置ECMP保护。\n\n\n\n\n运营商\n\n\n设备名称\n\n\n端口名称\n\n\nIP\n\n\n设备名称\n\n\n端口名称\n\n\nIP\n\n\n\n\n联通对接联调MCE\n\n\n新大楼865\n\n\nLAG3.100\n\n\n10.109.0.2/30\n\n\nMCE1\n\n\n \n\n\n10.109.0.1/30\n\n\n\n\nLAG3.200\n\n\n10.109.0.6/30\n\n\n \n\n\n10.109.0.5/30\n\n\n\n\nLAG3.3008\n\n\n10.55.0.66/30\n\n\n \n\n\n10.55.0.65/30\n\n\n\n\n国信865\n\n\nLAG3.100\n\n\n10.109.0.10/30\n\n\nMEC2\n\n\n \n\n\n10.109.0.9/30\n\n\n\n\nLAG3.200\n\n\n10.109.0.14/30\n\n\n \n\n\n10.109.0.13/30\n\n\n\n\nLAG3.3008\n\n\n10.55.0.70/30\n\n\n \n\n\n10.55.0.69/30\n\n\n\n\n联通对接电信\n\n\n新大楼865\n\n\nLAG4.13\n\n\n10.115.0.130/30\n\n\n电信八分局\n\n\n \n\n\n10.115.0.129/30\n\n\n\n\nLAG4.14\n\n\n10.115.0.134/30\n\n\n \n\n\n10.115.0.133/30\n\n\n\n\nLAG4.15\n\n\n10.116.255.2/30\n\n\n \n\n\n10.116.255.1/30\n\n\n\n\n国信865\n\n\nLAG4.13\n\n\n10.115.0.134/30\n\n\n电信六分局\n\n\n \n\n\n10.115.0.133/30\n\n\n\n\nLAG4.14\n\n\n10.115.0.138/30\n\n\n \n\n\n10.115.0.137/30\n\n\n\n\nLAG4.15\n\n\n10.116.255.6/30\n\n\n \n\n\n10.116.255.5/30\n\n\n\n\n \n现象描述:某联通运营商进行与电信互联互通测试，本次操作需要在现有4G业务L3VPN进行相关操作，需要重新发布路由和部署路由策略，安排时间为凌晨。网管操作完成后，全网4G基站业务中断。\n处理过程:1、在汇聚设备带基站业务地址网关为源ping测联通核心网MME相关地址发现均不通，核心往基站侧ping正常；在汇聚设备带基站业务地址网关为源ping测电信核心网MME相关地址正常。\n2、检查电信和联通核心网路由学习情况，电信反馈接收到本地IPRAN发布的业务路由，联通核心网反馈未收到地市IPRAN网络发布的业务路由。\n3、在部署过程中的做了一个BGP明细路由发布改汇总路由的操作。\n3.1 完成bgp和route_map的配置，联通现网4G业务地址按照24位地址进行发布。\naddress-family ipv4 vrf L3VPN-18\n network 10.54.208.0/20\n network 10.109.2.0/24\n network 10.109.3.0/24\n network 10.109.4.0/24\n network 10.109.5.0/24\n network 10.109.6.0/24\n network 10.109.7.0/24\n network 10.109.8.0/24\n network 10.109.9.0/24\n network 10.109.10.0/24\n network 10.109.11.0/24\n network 10.109.12.0/24\n network 10.109.13.0/24\n network 10.109.14.0/24\n network 10.109.15.0/24\n network 10.109.16.0/24\n network 10.109.17.0/24\n network 10.109.18.0/24\n network 10.109.19.0/24\nnetwork 41.227.245.0/24                       ******在联通的LTE-VPN 下发布电信共享的最后1C 的地址路由\nnetwork 51.239.245.0/24\nnetwork 10.100.0.0/24                           ******在联通的LTE-VPN 下发布联通核心网地址路由\nnetwork 10.100.1.0/24\nnetwork 10.100.32.0/24\nnetwork 10.100.33.0/24\n3.2 在完成部署后，电信反馈无法收到联通现网的4G业务地址，电信需要联通发布全网4G业务的大段地址10.109.0.0/16才能匹配路由策略，现场在此情况下将L3VPN下的24位业务地址明细路由做了聚合，考虑到路由冗余问题，发布了一条10.109.0.0/16的汇总地址，删除了24位的明细地址。\naddress-family ipv4 vrf L3VPN-18\n network 10.54.208.0/20\n 10.109.0.0/16 （联通现网4G业务汇总路由）\nnetwork 41.227.245.0/24                       ******在联通的LTE-VPN 下发布电信共享的最后1C 的地址路由\nnetwork 51.239.245.0/24\nnetwork 10.100.0.0/24                           ******在联通的LTE-VPN 下发布联通核心网地址路由\nnetwork 10.100.1.0/24\nnetwork 10.100.32.0/24\nnetwork 10.100.33.0/24\n \n \n4、联通核心网核对相关接口入方向策略均为明细的24位路由，当上一步骤删除明细路由做了汇总路由后，本地网发给联通核心网的路由匹配不上，这就导致了核心网收不到业务地址而发生中断。\n5、重新在业务L3VPN里面加上之前的明细路由后刷新BGP业务恢复正常。\naddress-family ipv4 vrf L3VPN-18\nnetwork 10.54.208.0/20      *****增加发布之前的24位明细路由   \n network 10.109.2.0/24\n network 10.109.3.0/24\n network 10.109.4.0/24\n network 10.109.5.0/24\n network 10.109.6.0/24\n network 10.109.7.0/24\n network 10.109.8.0/24\n network 10.109.9.0/24\n network 10.109.10.0/24\n network 10.109.11.0/24\n network 10.109.12.0/24\n network 10.109.13.0/24\n network 10.109.14.0/24\n network 10.109.15.0/24\n network 10.109.16.0/24\n network 10.109.17.0/24\n network 10.109.18.0/24\n network 10.109.19.0/24\nnetwork 10.109.0.0/16   *****同时发布16位汇总路由              \nnetwork 41.227.245.0/24                      \nnetwork 51.239.245.0/24\nnetwork 10.100.0.0/24                           \nnetwork 10.100.1.0/24\nnetwork 10.100.32.0/24\nnetwork 10.100.33.0/24\n \n \n \n根因:删除L3VPN 发布的明细路由汇总发布后未能和联通核心网的入口路由策略匹配导致业务中断\n解决方案:在涉及到互联互通的场景之下，不同运营商可能配置的路由策略不一致，此情况下我们的L3VPN需要同时发布明细路由和汇总路由，需要各方审核路由策略，避免此类问题发生。\n原因分类:无\n"}
{"instruction": "某省际干线主备电流差值大的案例分析。某省际干线核心机房在扩容加电时（105框扩OTU4S），发现我司设备对应列头柜的原有主备电流差值大，主用80A，备用27A（见图一，图二）。电源人员用表对电源线进行测量时，确实主备有电流差值，在对每个机框进行测量时，发现主备机盘电流差值在5-7A之间。核心局机架全部在一列，相关机架情况见图。\n\n图一（主用）\n\n图二（备用）\n\n核心局机架图", "input": "", "output": "案例主题:某省际干线主备电流差值大的案例分析\n案例编号:AL202003315131\n网络场景:某省际新建干线，全部采用COTP-2机框（105机框）组成，业务盘全部采用OTU4S，波道全部为点对点。\n现象描述:某省际干线核心机房在扩容加电时（105框扩OTU4S），发现我司设备对应列头柜的原有主备电流差值大，主用80A，备用27A（见图一，图二）。电源人员用表对电源线进行测量时，确实主备有电流差值，在对每个机框进行测量时，发现主备机盘电流差值在5-7A之间。核心局机架全部在一列，相关机架情况见图。\n\n图一（主用）\n\n图二（备用）\n\n核心局机架图\n处理过程:1、现场测试主备电源电流，其中主用分担80A，备用分担27A；\n2、现场测试列头柜主备电源电压，其中主用电压为52.41V，备用电压52.24V均在正常电压范围（见图三、图四）；\n  \n                  图三（列头主用）              图四（列头备用）\n3、再次测量PDP单元主备电压，主用电压为52.32V，备用电压为52.21V，均在正常范围之内（见图五、图六）；\n \n                           图五（PDP主用）                                     图六（PDP备用）\n4、主备两路电压均在正常范围，而且均有电压。说明主备两路供电都是正常；\n5、偏流原因是，主备两路电源盘是采用的热主备，也就是说主备两路同时供电；当主备电阻都非常小，主备两路有微小压差时，就会产生明显偏流（根据相关公式进行计算），如果主备有压差，电流就会有差值，具体详细分析见下面。\n \n \n根因:在分析前先说明下电源盘的工作原理：\n\n不考虑供电线路阻抗：\n\n\n图1 设备单盘两路-48V供电框图（不考虑供电线路阻抗）\n     设备内部每块单盘两路-48V供电基本原理如上图1所示，两路-48V电源通过二极管后给设备单盘供电， D1和D2二极管的作用之一就是保证两路-48V电源之间不会有环流。\n     当-48V1电源的电压比-48V2电源电压高出约1.4V（即高出约两颗二极管压降）时，D1二极管导通，D2二极管截止，设备完全由-48V1电源供电，此时-48V2电源不供电（处于热备份状态，一旦-48V1电源出现异常，电压低于-48V2电源电压或掉电时，-48V2电源即自动给设备供电），电流流向如下图2所示。反之，当-48V2电源的电压比-48V1电源电压高出约1.4V（即高出约两颗二极管压降）时，是-48V2电源给设备供电，电流流向如图3所示。\n     当-48V1电源的电压和-48V2电源电压比较接近（两者差值小于两颗二极管压降）时，D1和 D2二极管都导通，设备由-48V1电源和-48V2电源联合供电（任一路电源出现异常，电压偏低或掉电时，另一路电源即自动承担设备全部电流），电压稍微高一些的源供电电流也会对应稍微大一些，电流流向如下图4所示。\n\n                    图2                                           图3                                           图4\n\n  考虑供电线路阻抗：\n\n\n图5 设备单盘两路-48V供电框图（考虑供电线路阻抗）\n     两路-48V电源供电电流除了与两路电源电压值相关外，还与供电线路阻抗相关，如上图5所示，R1和R2分别是-48V1电源和-48V2电源的供电线路阻抗，（该阻抗是导线自身电阻、各连接端子之间的压接阻抗、所串联的空开熔丝等自身阻抗之和）。\n     如果-48V1电源和-48V2电源的电压值完全一样（或两者来自同一个源），那么两路电源就联合给设备供电，供电电流之比就是供电线路阻抗的反比。\n     实际运行中，两路-48V电源电压有一定的偏差，供电链路的阻抗也会有一定偏差，从而会综合导致实际运行中两路-48V电源的供电电流有一定偏差。\n主备两路-48V电流差值分析：\n列头柜侧测量主、备电压分别为52.41V和52.24V，电压差为52.41-52.24=0.17V。\n1、我们的3个机柜与列头柜相邻依次排布，列头柜至PDP输入端布线距离取5m。则供电回路导线长度（-48V、0V线等长）为5m*2=10m，使用的25mm2电源线。导线电阻Ra=ρ*L/S=0.0175*10/25=7mΩ。\nPDP至电源盘输入端电源线长2m，供电回路导线长度2m*2=4m，线径6mm2。导线电阻Rb=ρ*L/S=0.0175*4/6=11.6mΩ。\n7mΩ+11.6mΩ再综合考虑各接线端子接触阻抗及其它因素，从列头柜至设备负载端整个供电回路阻抗约为：20mΩ。\n由于主、备供电线路平行布放，假定主、备线路阻抗相同。则0.17V的电压差，将导致供电电流差值为0.17V/20mΩ=8.5A。\n2、如果列头柜至PDP输入端布线距离取10m。则导线电阻Ra=ρ*L/S=0.0175*20/25=14mΩ。PDP至电源盘输入端阻抗Rb仍为11.6mΩ，再综合考虑各接线端子接触阻抗及其它因素，从列头柜至设备负载端整个供电回路阻抗约为：27mΩ。则0.17V的电压差，将导致供电电流差值为0.17V/27mΩ=6.3A。\n通过上述计算，与现场实测的设备主、备电流差值6-8A的情况基本吻合\n解决方案:【总结】两路-48V是互为主备关系，彼此是对方的热备份，两路-48V电源承担的电流大小，是随电源电压的偏差以及供电回路阻抗的偏差而自然分配的结果，不影响设备供电的安全。\n原因分类:无\n"}
{"instruction": "对现网EFCU/CCU单盘进行环IP修改案例。由于此网元原先规划掩码29位，后期新增WDM子框数量多，导致IP不够用，需将掩码改为28位", "input": "", "output": "案例主题:对现网EFCU/CCU单盘进行环IP修改案例\n案例编号:AL202008167901\n网络场景:某网络U设备下挂WDM子框，需对此网元各单盘的IP进行修改\n现象描述:由于此网元原先规划掩码29位，后期新增WDM子框数量多，导致IP不够用，需将掩码改为28位\n处理过程:某网元目前CCU的F口IP地址为172.25.64.2/29，掩码255.255.255.248，环回口IP地址为1.1.1.1/32 掩码 255.255.255.255；更改后F口IP地址为172.25.64.2/28，掩码255.255.255.240，环回口IP地址为 1.1.1.1/32，掩码为255.255.255.255，所有端口均划为 0 域。\nEFCU 的IP地址为172.25.64.4/29，掩码255.255.255.248，环回口IP地址为1.1.1.2/32 掩码 255.255.255.255; 更改后F口IP地址为172.25.64.4/28，掩码255.255.255.240，环回口IP地址为 1.1.1.2/32 掩码为255.255.255.255。\n一、修改EFCU单盘的IP\n1、使用大网管登录到 EFCU 单盘，对EFCU进行IP更改（因为存在多个EFCU，防止先更改CCU后无法上管），直接采用命令存储规划的F口的IP地址和掩码信息（172.25.64.4/28），telnet EFCU的IP使用命令格式agent set_eth_addr ip-address  mask <掩码>，具体命令如下：\nRouter#agent set_eth_addr ip-address 172.25.64.3 mask 255.255.255.240\nSet successful!\nRouter#\n2、用agent loopback_flag 2命令查看环回口标志位的值、以及F口的IP地址和掩码是否设置正确：\nRouter>enable\nRouter#agent mode\nRouter#agent loopback-flag 2\ng_loopback_flag is 1\n0 - no loopback function, 1 - do loopback function\ng_eth_ip_address is 172.25.64.4\ng_eth_ip_mask is 255.255.255.240\nRoute#\n3、使用服务器网管对该EFCU盘下单盘配置，单盘配置中原先设置IP为1.1.1.2，掩码设置255.255.255.255，需重新写一个别的IP，如1.1.1.8，下载单盘配置上管后，最后再改回1.1.1.2，EFCU单盘IP修改成功。\n二、更改CCU单盘IP\n1、使用大网管telnet 172.25.64.2登录到CCU 单盘，对CCU进行IP更改，直接采用命令存储规划的F口的IP地址和掩码信息（MONS站点为172.25.64.2/28），命令格式为agent set-eth-addr ip-address  mask <掩码>，具体命令如下：\nRouter#agent set-eth-addr ip-address 172.25.64.2 mask 255.255.255.240\nSet successful!\nRouter#\n2、用 agent loopback_flag 2 命令查看标志位的值、以及F口的IP地址和掩码是否设置正确：\nRouter>enable Router#agent mode\nRouter#agent loopback-flag 2\ng_loopback_flag is 1\n0 - no loopback function, 1 - do loopback function\ng_eth_ip_address is 172.25.64.2\ng_eth_ip_mask is 255.255.255.240\nRoute#\n3、现场操作 OTNM2000，再次给设备写 IP（环回口 IP 为 1.1.1.1/32），（注意SN码要对应），操作方法写 F 口 IP 一样，这时候下发的 IP 地址为环回口 IP 地址，要求掩码是 32 位，即 255.255.255.255。配置完成后CCU单盘会重启。（此步骤必须现场使用电脑直连U子框AIF盘F口重新写IP，注意在电脑网卡配置和该CCU子框同一个IP段，且用网线连接至F口，将MONS站点CCU子框的F口和COM口网线，已连接DCN交换机的F口网线全部拔掉）\n4、待CCU重启后用agent loopback_flag 2命令查看环回口标志位的值、以及F口的IP地址和掩码是否设置正确：\nRouter>enable\nRouter#agent mode\nRouter#agent loopback-flag 2\n5、完成修改后客户针对连接的DCN网交换机数据进行修改\n6、U设备上管\n三、操作注意事项\n1、修改IP后虽然掩码不一样，但是与其他IP仍然是同一个域，操作成功后，可以正常上管。\n2、站点修改IP时需要拔出其他多余的网线，只留下和PC连接的用来写IP 的网线和信令口网线。\n3、U30的上管IP是环回口IP，记得在网管上修改。\n4、注意通过agent set-eth-addr ip-address命令修改完F口IP之后，需要重新写一遍环回口IP，原F口IP才会被覆盖。\n5、操作对现网业务无影响，操作期间会造成网元托管。\n根因:使用服务器网管对该EFCU盘下单盘配置，单盘配置中原先设置IP为1.1.1.2，掩码设置255.255.255.255，需重新写一个别的IP，如1.1.1.8，下载单盘配置上管后，最后再改回1.1.1.2，EFCU单盘IP修改成功。\n解决方案:使用服务器网管对该EFCU盘下单盘配置，单盘配置中原先设置IP为1.1.1.2，掩码设置255.255.255.255，需重新写一个别的IP，如1.1.1.8，下载单盘配置上管后，最后再改回1.1.1.2，EFCU单盘IP修改成功。\n原因分类:无\n"}
{"instruction": "某电信IPRAN运营商要求运用vpls模型实现业务需求，且叶节点实现pw冗余保护。我司一个vpls实例下只能绑64条pw。如果不配置备用pw，可以实现用户需求。但是按照客户要求，这64个叶子节点要实现pw冗余保护，需要一个vpls下绑128条pw，常规方法无法实现备用pw保护。", "input": "", "output": "案例主题:某电信IPRAN运营商要求运用vpls模型实现业务需求，且叶节点实现pw冗余保护\n案例编号:AL202008047481\n网络场景:某电信IPRAN组网，运营商要求运用vpls模型实现64个叶子节点和根节点通信，根节点出1个uni口和汇聚华三交换机相连。每个叶子节点的PW要求全透传用户所有vlan报文，且必须实现pw冗余保护。\n\n现象描述:我司一个vpls实例下只能绑64条pw。如果不配置备用pw，可以实现用户需求。但是按照客户要求，这64个叶子节点要实现pw冗余保护，需要一个vpls下绑128条pw，常规方法无法实现备用pw保护。\n处理过程:其他节点为vpls业务常规配置，再次不赘述；\n根节点特殊配置：（需要配置2个vpls实例，3个uni口）\n（1）建vpls实例vpls100,绑定64个叶子节点的主用pw，pw间开启水平分割。\n（2）将vpls100同时绑定到uni口1和uni口2下面，uni口2开启端口水平分割。\n（3）建vpls实例vpls101,绑定64个叶子节点的备用pw，pw间开启水平分割。\n（4）将vpls101绑定在uni口3下面。\n（5）将uni口2和uni口3在设备上用一对光纤连接在一起。\n（6）uni口接用户汇聚华三交换机。\n根因:按照客户要求，这64个叶子节点要实现pw冗余保护，需要一个vpls下绑128条pw。我司一个vpls实例下只能绑64条pw。所以用端口两个端口连起来的非常规方法，在不改底层代码的基础上，实现用户需求。\n解决方案:根节点配置（其他节点配置为常规pw配置，再次省略）：\n（1）vpls100 pw配置\nmpls vpls vpls100 100 \r\n vpls-type ethernet\r\n vpls-mac-max 20000\r\n vpls-vc PW2082 ethernet \r\n  exp-to-phb-map ploy 1 exp2phb-id 1 vpls-vc PW2082\r\n  phb-to-exp-map ploy 1 phb2exp-id 1 vpls-vc PW2082\r\n  vlan-rx-tx-op rx-tag 0 tx-tag 0 vpls-vc PW2082\r\n  control-word 1 vpls-vc PW2082\r\n  mac-learning enable vpls-vc PW2082\r\n vpls-vc PW2310000400 ethernet \r\n  exp-to-phb-map ploy 1 exp2phb-id 1 vpls-vc PW2310000400\r\n  phb-to-exp-map ploy 1 phb2exp-id 1 vpls-vc PW2310000400\r\n  vlan-rx-tx-op rx-tag 0 tx-tag 0 vpls-vc PW2310000400\r\n  control-word 1 vpls-vc PW2310000400\r\n  mac-learning enable vpls-vc PW2310000400\n  ……\n（2）vpls101实例pw配置\nmpls vpls vpls101 101 \r\n vpls-type ethernet\r\n vpls-mac-max 20000\r\n vpls-vc PW2008 ethernet \r\n  exp-to-phb-map ploy 1 exp2phb-id 1 vpls-vc PW2008\r\n  phb-to-exp-map ploy 1 phb2exp-id 1 vpls-vc PW2008\r\n  vlan-rx-tx-op rx-tag 0 tx-tag 0 vpls-vc PW2008\r\n  control-word 1 vpls-vc PW2008\r\n  mac-learning enable vpls-vc PW2008\r\n vpls-vc PW2020 ethernet \r\n  exp-to-phb-map ploy 1 exp2phb-id 1 vpls-vc PW2020\r\n  phb-to-exp-map ploy 1 phb2exp-id 1 vpls-vc PW2020\r\n  vlan-rx-tx-op rx-tag 0 tx-tag 0 vpls-vc PW2020\r\n  control-word 1 vpls-vc PW2020\r\n  mac-learning enable vpls-vc PW2020\n ……\n（3）uni口1配置\n   interface GE0/3/1\r\n description ShiPinDiaoDu\r\n switchport\r\n no shutdown\r\n mpls-vpls vpls100\r\n commit\r\n!\n（4）uni口2配置\ninterface GE0/8/7\r\n description ShiPinDiaoDu2  \r\n switchport\r\n no shutdown\r\n uni h-div-switch 1\r\n mpls-vpls vpls100\r\n commit\r\n!\n（5）uni口3配置\ninterface GE0/8/8\r\n description GongAnNeiWang2\r\n switchport\r\n no shutdown\r\n mpls-vpls vpls101\r\n commit\r\n!\n原因分类:无\n"}
{"instruction": "某省联通IPRAN R865设备配置烽火省干波分网管至集团服务器路由。由于本工程为交钥匙工程，需要烽火OTN专业自己解决该问题，但无解决方案，无法打通至北京集团服务器的路由。仅得到规划表一份。\n \n\n\n\n省份\n汇聚出口局\n需通过的IP段\n掩码\nIP段描述\n \n\n\n新疆\n某市天津路\n10.6.42.0\n255.255.255.0\n北京服务器、路由器地址\nIPRAN 收到集团的路由\n\n\n10.6.43.0\n255.255.255.0\n郑州服务器、路由器地址\n\n\n172.196.196.0\n255.255.255.0\n北京服务器、路由器地址\n\n\n172.195.195.0\n255.255.255.0\n郑州服务器、路由器地址\n\n\n132.37.87.0\n255.255.255.0\n北京服务器、路由器地址\n\n\n132.37.88.0\n255.255.255.0\n郑州服务器、路由器地址\n\n\n10.6.23.0\n255.255.255.0\n省内对B网端口地址\n某省本地地址，IPRAN上行发送给B网路由\n\n\n132.37.90.20\n255.255.255.252\n省内客户端IP\n\n\n", "input": "", "output": "案例主题:某省联通IPRAN R865设备配置烽火省干波分网管至集团服务器路由\n案例编号:AL202008117701\n网络场景:1、联通IPRAN 核心汇聚 R865 ，接入层R800小设备、 640和630 混合接入设备。\n2、组网为标准核心汇聚ISIS协议，RSVP tunnel，接入为静态协议。全网RR路由反射器 为一对核心R865设备。\n3、组网拓扑为 日字形组网\n本案例场景如图：\n\n现象描述:由于本工程为交钥匙工程，需要烽火OTN专业自己解决该问题，但无解决方案，无法打通至北京集团服务器的路由。仅得到规划表一份。\n \n\n\n\n省份\n汇聚出口局\n需通过的IP段\n掩码\nIP段描述\n \n\n\n新疆\n某市天津路\n10.6.42.0\n255.255.255.0\n北京服务器、路由器地址\nIPRAN 收到集团的路由\n\n\n10.6.43.0\n255.255.255.0\n郑州服务器、路由器地址\n\n\n172.196.196.0\n255.255.255.0\n北京服务器、路由器地址\n\n\n172.195.195.0\n255.255.255.0\n郑州服务器、路由器地址\n\n\n132.37.87.0\n255.255.255.0\n北京服务器、路由器地址\n\n\n132.37.88.0\n255.255.255.0\n郑州服务器、路由器地址\n\n\n10.6.23.0\n255.255.255.0\n省内对B网端口地址\n某省本地地址，IPRAN上行发送给B网路由\n\n\n132.37.90.20\n255.255.255.252\n省内客户端IP\n\n\n\n处理过程:1、根据以上地址规划，与集团烽火负责人沟通，需要实现本地市一台服务器通过交换机对接至IPRAN。然后通过IPB（承载B网）将路由发送至集团。\n      路由打通后，烽火集团负责人在本地服务器和集团服务器之间配置GRE tunnel，单独承载网元的路由。IPRAN只需提供该通道。\n2、根据该场景绘制网络场景拓扑图（见网络场景图），与承载B网对接沟通。采取对各自收方向做路由策略，同时B网需要收本地回程路由的汇总路由。\n3、IPRAN配置：以备用平面落地配置为例，主落地配置同理。\n      3.1 新建L3VPN  配置前缀列表和 路由映射，同时规划RT和RD值，RD值全网唯一。落地 入 RT a RT b出 RT b；汇聚 入 RT b，出 RT a\n\n\n\nip prefix-list lt-otn-fh-in: 7 entries\n\n\n     seq 5 permit 10.6.42.0/24\n\n\n     seq 10 permit 10.6.43.0/24\n\n\n     seq 15 permit 172.195.195.0/24\n\n\n     seq 20 permit 172.196.196.0/24\n\n\n     seq 25 permit 132.37.87.0/24\n\n\n     seq 30 permit 132.37.88.0/24\n\n\n     seq 200 deny any\n\n\n \n\n\n \n\n\nroute-map LT-otn-fh-in, permit, sequence 25\n\n\n  Match clauses:\n\n\n  ip address prefix-list lt-otn-fh-in\n\n\n  Set clauses:\n\n\n\n      3.2 配置BGP 对等体，并绑定路由策略。  \n      \n\n\n\naddress-family ipv4 vrf L3VPN-69\n\n\n network 10.6.23.0/24\n\n\n network 132.37.90.20/30\n\n\n redistribute connected\n\n\n neighbor 10.6.23.17 remote-as 38351\n\n\n neighbor 10.6.23.17 update-source 10.6.23.18\n\n\n neighbor 10.6.23.17 advertisement-interval 1\n\n\n neighbor 10.6.23.17 timers connect 120\n\n\n neighbor 10.6.23.17 fall-over bfd\n\n\n neighbor 10.6.23.17 activate\n\n\n neighbor 10.6.23.17 soft-reconfiguration inbound\n\n\n neighbor 10.6.23.17 route-map LT-otn-fh-in in\n\n\n exit-address-family\n\n\n\n \n4、汇聚配置 BGP邻居和回程静态路由\n      4.1 配置BGP 邻居，重分发直连和静态\n            \n\n\n\naddress-family ipv4 vrf L3VPN-69\n\n\n redistribute connected\n\n\n redistribute static\n\n\n exit-address-family\n\n\n\n \n4.2 配置回程路由\n       \n\n\n\nip route vrf L3VPN-69 132.37.90.20/30 10.6.23.9 GE0/23/5 20\n\n\n\n \n5. 检查落地设备是否正常路由：show  ip route vrf  L3VPN-69 da\n132.37.90.20/30 [200/0] via 10.200.215.47, 01w4d01h 这条为 汇聚重分发的静态学习到的。\n  *   via 10.6.23.17, XGE0/7/4.857  含有该字符串的为BGP学习到的 IPB（B网）路由即集团的路由。\n\n \n \n根因:1、未明确 承载B网和烽火IPRAN 网络对接逻辑拓扑\n2、同时对收发地址段不明确，即对网络规划不明确，方案无法实施。\n解决方案:对接方案已L3VPN的方式打通波分汇聚交换机与 B网路由/集团服务器路由\n1、新建L3VPN 配置前缀列表和 路由映射，同时规划RT和RD值，RD值全网唯一。\n2、主备落地设备 配置BGP 对等体，并绑定路由策略（前缀列表和route-map）\n3、汇聚R865（直接对接汇聚交换机） 配置BGP 邻居和L3VPN实例 重分发直连和静态\n      配置回程静态路由\n \n原因分类:无\n"}
{"instruction": "物理机磁盘IO读写速率分析。磁盘写入速率较低但是使用率较高，16k随机写入测试，速率为8.1M。速率远低于硬盘的标称速率。", "input": "", "output": "案例主题:物理机磁盘IO读写速率分析\n案例编号:AL2020110210161\n网络场景:某应用在服务器上存储媒体流转存录音文件，大小为16k，录音文件每天产生大约1.5TB，需要保留14天，需要至少21TB容量。\n现象描述:磁盘写入速率较低但是使用率较高，16k随机写入测试，速率为8.1M。速率远低于硬盘的标称速率。\n处理过程:一、物理机磁盘性能参数\n硬盘的性能参数有容量、转速、平均访问时间、传输速率等，影响IO较大的参数是转速和平均访问时间。\n转速(Rotationl Speed 或Spindle speed)，是硬盘内电机主轴的旋转速度，也就是硬盘盘片在一分钟内所能完成的最大转数。硬盘转速单位表示为RPM，RPM是Revolutions Per minute的缩写，是转/每分钟。\n平均访问时间(Average Access Time)是指磁头从起始位置到达目标磁道位置，并且从目标磁道上找到要读写的数据扇区所需的时间。平均访问时间，包括了硬盘的寻道时间和等待时间，即：平均访问时间=平均寻道时间+平均等待时间。平均寻道时间(Average Seek Time)是指硬盘的磁头移动到盘面指定磁道所需的时间。硬盘的等待时间，又叫潜伏期(Latency)，是指磁头已处于要访问的磁道，等待所要访问的扇区旋转至磁头下方的时间。\nIOPS (Input/Output Per Second)即每秒的输入输出量(或读写次数)，IOPS是指单位时间内系统能处理的I/O请求数量，一般以每秒处理的I/O请求数量为单位，I/O请求通常为读或写数据操作请求。\n二、IOPS计算方式\n对于磁盘来说一个完整的IO操作是这样进行的：当控制器对磁盘发出一个IO操作命令的时候，磁盘的驱动臂(Actuator Arm)带读写磁头(Head)离开着陆区(Landing Zone，位于内圈没有数据的区域)，移动到要操作的初始数据块所在的磁道(Track)的正上方，这个过程被称为寻址(Seeking)，对应消耗的时间被称为寻址时间(Seek Time);但是找到对应磁道还不能马上读取数据，这时候磁头要等到磁盘盘片(Platter)旋转到初始数据块所在的扇区(Sector)落在读写磁头正上方的之后才能开始读取数据，在这个等待盘片旋转到可操作扇区的过程中消耗的时间称为旋转延时(Rotational Delay);接下来就随着盘片的旋转，磁头不断的读/写相应的数据块，直到完成这次IO所需要操作的全部数据，这个过程称为数据传送(Data Transfer)，对应的时间称为传送时间(Transfer Time)。完成这三个步骤之后一次IO操作也就完成了。\n第一个寻址时间，考虑到被读写的数据可能在磁盘的任意一个磁道，既有可能在磁盘的最内圈(寻址时间最短)，也可能在磁盘的最外圈(寻址时间最长)，所以在计算中一般使用平均寻址时间，也就是磁盘参数中标明的那个平均寻址时间，这里就采用当前最多的10krmp硬盘的5ms。\n\n\n\n\n常见机械硬盘平均物理寻址时间\n\n\n\n\n7200 rpm的STAT硬盘平均物理寻址时间是9ms\n\n\n\n\n10000 rpm的STAT硬盘平均物理寻址时间是6ms\n\n\n\n\n15000 rpm转/分的SAS硬盘平均物理寻道时间是4ms\n\n\n\n\n第二个旋转延时，和寻址一样，当磁头定位到磁道之后有可能正好在要读写扇区之上，这时候是不需要额外额延时就可以立刻读写到数据，但是最坏的情况确实要磁盘旋转整整一圈之后磁头才能读取到数据，所以这里我们也考虑的是平均旋转延时，对于10krpm的磁盘就是(60s/10k)*(1/2) = 2ms。\n\n\n\n\n常见机械硬盘的旋转延迟时间\n\n\n\n\n7200 rpm的磁盘平均旋转延迟大约为60/7200/2 = 4.17ms\n\n\n\n\n10000 rpm的磁盘平均旋转延迟大约为60/10000/2 = 3ms\n\n\n\n\n15000 rpm的磁盘其平均旋转延迟约为60/15000/2 = 2ms\n\n\n\n\n第三个传送时间，磁盘参数提供我们的最大的传输速度，当然要达到这种速度是很有难度的，但是这个速度却是磁盘纯读写磁盘的速度，因此只要给定了单次 IO的大小，我们就知道磁盘需要花费多少时间在数据传送上，这个时间就是IO Chunk Size / Max Transfer Rate。\n根据以上的数据可以得出计算单次IO时间的公式。\nIO Time = Seek Time + 60 sec/Rotational Speed/2 + IO Chunk Size/Transfer Rate\n于是我们可以计算出IOPS。\nIOPS = 1/IO Time = 1/(Seek Time + 60 sec/Rotational Speed/2 + IO Chunk Size/Transfer Rate)\n\n\n\n\n常见机械硬盘的IOPS(忽略数据传输时间)\n\n\n\n\n7200 rpm的磁盘IOPS = 1000 / (9 + 4.17) =76 IOPS\n\n\n\n\n10000 rpm的磁盘IOPS = 1000 / (6+ 3) = 111 IOPS\n\n\n\n\n15000 rpm的磁盘IOPS = 1000 / (4 + 2) = 166 IOPS\n\n\n\n\n \n三、IOPS 与吞吐量的关系\n每秒I/O 吞吐量＝ IOPS*平均I/O SIZE。从公式可以看出：I/O SIZE 越大，IOPS越高，那么每秒 I/O 的吞吐量就越高。因此，我们会认为 IOPS 和吞吐量的数值越高越好。实际上，对于一个磁盘来讲，这两个参数均有其最大值，而且这两个参数也存在着一定的关系。\n对于同一个磁盘，随着每次I/O 读写数据的大小不同，IOPS 的数值也不是固定不变的。例如，每次 I/O 写入或者读出的都是连续的大数据块，此时 IOPS 相对会低一些；在不频繁换道的情况下，每次写入或者读出的数据块小，相对来讲 IOPS 就会高一些。也就是说，IOPS 也取决与I/O块的大小，采用不同I/O块的大小测出的IOPS值是不同的。\nIOPS可细分为如下几个指标：\n   1、Toatal IOPS，混合读写和顺序随机I/O负载情况下的磁盘IOPS，这个与实际I/O情况最为相符，大多数应用关注此指标。\n   2、Random Read IOPS，100%随机读负载情况下的IOPS。\n   3、Random Write IOPS，100%随机写负载情况下的IOPS。\n   4、Sequential Read IOPS，100%顺序读负载情况下的IOPS。\n   5、Sequential Write IOPS，100%顺序写负载情况下的IOPS。\n\n\n\n\n指标\n\n\n描述\n\n\n数据访问方式\n\n\n\n\n总IOPS\n\n\n每秒执行的I/O操作总次数\n\n\n对硬盘存储位置的不连续访问和连续访问\n\n\n\n\n随机读IOPS\n\n\n每秒执行的随机读I/O操作的平均次数\n\n\n对硬盘存储位置的不连续访问\n\n\n\n\n随机写IOPS\n\n\n每秒执行的随机写I/O操作的平均次数\n\n\n\n\n顺序读IOPS\n\n\n每秒执行的顺序读I/O操作的平均次数\n\n\n对硬盘存储位置的连续访问\n\n\n\n\n顺序写IOPS\n\n\n每秒执行的顺序写I/O操作的平均次数\n\n\n\n\n固态硬盘是用固态电子存储芯片阵列制成的硬盘。可以理解为电子硬盘，意思就是里面没有马达，固态硬盘也称作电子硬盘或者固态电子盘，是由控制单元和固态存储单元组成的硬盘。固态硬盘的接口规范和定义、功能及使用方法上与普通硬盘的相同，在产品外形和尺寸上也与普通硬盘一致。由于固态硬盘没有普通硬盘的旋转介质，所以IOPS比机械硬盘高吞吐量比机械硬盘大。\n\n\n\n\n固态硬盘和机械硬盘区别对比\n\n\n\n\n项 目\n\n\n固态硬盘（SSD)\n\n\n机械硬盘（HDD)\n\n\n\n\n容 量\n\n\n较小\n\n\n大\n\n\n\n\n价 格\n\n\n贵\n\n\n便宜\n\n\n\n\n随机存取\n\n\n极快\n\n\n一般\n\n\n\n\n写入次数\n\n\nSLC:10万次/MLC:1万次\n\n\n无限制\n\n\n\n\n工作噪音\n\n\n无\n\n\n有\n\n\n\n\n工作温度\n\n\n极低\n\n\n较为明显\n\n\n\n\n防震能力\n\n\n很好\n\n\n较差\n\n\n\n\n数据恢复\n\n\n难\n\n\n容易\n\n\n\n\n四、现网运行服务器测试情况\n1、烽火服务器16k随机写入测试\nfio -filename=/dev/sdb -direct=1 -iodepth 1 -thread -rw=randwrite -ioengine=psync -bs=16k -size=100G -numjobs=19 -runtime=60 -group_reporting -name=mytest\n\n2、烽火服务器1M随机写入测试\nfio -filename=/dev/sdb -direct=1 -iodepth 1 -thread -rw=randwrite -ioengine=psync -bs=1m -size=100G -numjobs=19 -runtime=60 -group_reporting -name=mytest\n\n3、友商同类型服务器16k随机写入测试\n\n4、友商同类型服务器1M随机写入测试\n\n以上测试可以看出由于机械硬盘的IOPS比较低，所以用16k这样的小数据随机写入测试的时候速率比较低，用1M这样的大数据随机写入测试的时候速率比较高，符合业界的一般情况。\n5、烽火服务器本地硬盘制作RAID5后16k随机写入测试\n\n本地磁盘制作RAID后小数据随机写的性能有所提升。\n根因:此业务服务器上存储的是媒体流转存录音文件，大小为16k，此类型的小文件频繁的随机写入消耗的IO比较多，所以会出现磁盘写入速率较低但是使用率较高的情况。\n解决方案:1、把服务器内的部分机械硬盘更换为SSD，这样可以大幅提升读写性能。\n2、更换业务服务器的数据盘组织，例如外接存储。直接提升IO性能，彻底解决问题。这种情况需要额外规划存储和通道。\n3、修改业务服务器磁盘RAID,将磁盘的直通修改为RAID5。目前修改一台后，测试16k随机写的IO速率由8M提升至28M。提升效果不显著，不确定能否匹配业务峰值数据情况，存在问题解决不彻底的风险。\n原因分类:无\n"}
{"instruction": "IPMITool采集硬盘状态。用户需要在BMC和IPMITool中监控硬盘信息。", "input": "", "output": "案例主题:IPMITool采集硬盘状态\n案例编号:AL202010109621\n网络场景:服务器采用LSI 3108或LSI 3008卡\n现象描述:用户需要在BMC和IPMITool中监控硬盘信息。\n处理过程:1、将BMC升级到1.64（20191121）以后的版本。注意升级时的三个选项，都不要勾选。\n\n \n升级该版本后，可以采集CPU、内存、功耗等信息。\n要采集硬盘信息，还要执行后面的步骤。如果是LSI 3008，还要在操作系统中安装TAS才能采集到硬盘信息。\n \n2、使用RAW命令定义RAID卡及硬盘数量。\n \n配置规则如下: \nipmitool -H $IP -U ADMIN -P ADMIN raw 0x30 0x70 0xFB 0x57 0x52 0x49 0x54 0x45 0x63 0x6F 0x6E 0x66 0x32 0x2C 0x31 0x32 0x3B \n前面是固定的,后面加粗部分定义卡的数量和硬盘个数。命令格式如下：\n卡1背板1硬盘数量,卡1背板2硬盘数量;卡2背板1硬盘数量,卡2背板2硬盘数量;\n命令是ASCII格式，上面的命令翻译为文本就是： 2,12;\n一个分号，代表只有一张RAID卡。中间逗号隔开，表示两个背板分别连接了2块和12块硬盘。如果只有一块背板，就不用加逗号了。\n \nRAID卡的顺序：\n不同的卡，看开机信息，哪个先显示就是哪个；\n相同的卡，进RAID界面看哪个排在前面。\n硬盘背板的顺序：\n在BMC界面，看Storage Monitoring，哪些硬盘排在前面，其对应的背板就写在前面。\n（比如0-23里面有4块硬盘，24-47里面有10块硬盘，ASCII命令就是4,10; ）\n \n如果有两张RAID卡 , 第一张接后背板2块硬盘，第二张接前背板8块硬盘，命令就是： \nipmitool -H $IP -U ADMIN -P ADMIN raw 0x30 0x70 0xFB 0x57 0x52 0x49 0x54 0x45 0x63 0x6F 0x6E 0x66 0x32 0x3B 0x38 0x3B \n \n取消配置方法：\nipmitool -H $IP -U ADMIN -P ADMIN raw 0x30 0x70 0xFB 0x57 0x52 0x49 0x54 0x45 0x63 0x6F 0x6E 0x66 0x00 \n \n注意：\n（1）命令执行成功没有任何提示。不成功会有报错。\n（2）所有配置/取消命令需要重启BMC才能生效。用ipmitool命令执行更方便：\nipmitool -H $IP -U ADMIN -P ADMIN mc reset cold\n \n3、配置完成并重启BMC之后，BMC的Sensor Readings里面也可以看到硬盘的状态（看不到单个硬盘的温度信息了）。也可以用ipmitool采集硬盘信息。\n命令：\nipmitool -H $IP -U ADMIN -P ADMIN  sdr type \"drive slot / bay\"\n或者\nipmitool -H $IP -U ADMIN -P ADMIN  sdr type 0x0d\n（ipmitool -H $IP -U ADMIN -P ADMIN  sdr type可以看到命令和对应的16进制代码，命令如果有空格要加引号）\n \nBMC传感器信息显示如下：\n\nipmitool采集结果如下：\n\n \n4、如果RAID卡为LSI 3008，因为LSI 3008不支持带外管理，还需要在操作系统中安装和启用TAS软件。\n系统所需软件：\n• Windows \n1. .Net framework 3.5\n2. smartmontools 6.5-1\n3. NVMe vendor specific driver (only required for using nvme function)\n4. Windows patch “KB3033929”(only required for Windows Server 2k8 R2 SP1)\n5. Intel RST CLI tool 13.2.0.1016 and 13.2.x.xxxx RSTe driver (specify tool version for specify RSTe driver version)\n6. sas3ircu 17.00.00.00\n• Linux\n1. ethtool package 2.6.33\n2. openIpmi driver\n3. smartmontools 6.5\n4. glibc 2.12\n5. storcli 1.20.15 (for Linux LSI 3108)\n6. mdadm 4.0 (for RAID)\n7. nmcli 0.8.1\n8. net-tools 1.60-110.el6-2\n9. lsscsi 0.23-2.el6\n10. lsblk 2.17.2\n11. sas3ircu 17.00.00.00\n \n安装：\n• Windows\n1. 使用管理员账户登录，\n2. 运行 ThinAgentServiceSetup.msi。\n3. 运行 setup.bat。\n4. 安装 smartmontools。\n5. 如果需要使用NVMe功能, 需要安装 NVMe 厂商提供的驱动。\n6. Windows 2008, 需安装 patch KB-3033929。\n7. 安装Intel RSTe tool and驱动来支持Intel RSTe, 更改raid设置路径为实际的安装文件夹/tas.ini 来使能 Intel RSTe。\n8. 如果安装了旧版本TAS先卸载然后重启系统再安装新版本TAS， 因为Windows系统可能出现不能完全卸载TAS的情况。\n• Linux\n1. 使用root账户登录。\n2. 确保安装的可执行权限：tas，install.sh 和 IPMITAS。\n3. 运行 install.sh 来安装 Thin-Agent 服务。\n4. 安装 smartmontools。\n \n开启TAS：\nTAS在安装后会自动运行，如果你在关闭服务后想手动启用，需要执行下面操作。\n• Windows\n1. 在Windows服务中找到“ThinAgentService” 。\n2. 右键单击 “ThinAgentSerice” 选择开启服务。\n• Linux \n1、 /etc/init.d/tas start 或 service tas start\n \n \n根因:BMC版本不支持，需要升级版本。\n如果RAID卡为LSI 3008，因为LSI 3008不支持带外管理，还需要在操作系统中安装TAS软件。\n解决方案:1、升级BMC至指定版本。\n2、配置并重启BMC。\n3、安装TAS软件（可选）。\n原因分类:无\n"}
{"instruction": "S7800升级V210R230T02_20190904后loopback地址丢包。S7800交换机的软件版本升级，目标版本V210R230T02_build20190904，升级后发现从上联BRAS去ping交换机的loopback管理地址，bras会收到大量的响应包，例如ping 20个请求包，BRAS会收到交换机的loopback地址的响应包有几百个，bras会提示有地址冲突。", "input": "", "output": "案例主题:S7800升级V210R230T02_20190904后loopback地址丢包\n案例编号:AL202009249481\n网络场景:某运营商使用S7800交换机作为城域网大二层汇聚交换机，上联BRAS、SR，下联OLT、接入交换机等，其中S7800交换机使用loopback地址作为管理地址。\n现象描述:S7800交换机的软件版本升级，目标版本V210R230T02_build20190904，升级后发现从上联BRAS去ping交换机的loopback管理地址，bras会收到大量的响应包，例如ping 20个请求包，BRAS会收到交换机的loopback地址的响应包有几百个，bras会提示有地址冲突。\n处理过程:1、通过debug命令来查看上联口的icmp包的收发情况\ndebug cpupkt interface xgigaetherne 6/0/1  icmp all\nSDWH-755-FHS7812-SW1#debug cpupkt interface xgigaetherne 6/0/1  icmp all\r\nSDWH-755-FHS7812-SW1#2019/11/29 03:12:36\r\n *********  2019/11/29 03:12:36: [tNetTask] Send pkt , unit 17794,vid 101,len 78  **********2019/11/29 03:12:36\r\n Dst Mac 54:89:98:3c:87:17,Src Mac 00:04:67:cb:2f:e6,etherType 0x0800 2019/11/29 03:12:36\r\n IpProType 0x01,Src Ip address 221.2.128.123,Dest Ip address 112.224.69.144 2019/11/29 03:12:36\r\n ICMP Type 0,Code 0 2019/11/29 03:12:36\r\n *****************************************  End  ***************************************\r\n2019/11/29 03:12:36\r\n *********  2019/11/29 03:12:36: [tNetTask] Send pkt , unit 17794,vid 101,len 78  **********2019/11/29 03:12:36\r\n Dst Mac 54:89:98:3c:87:17,Src Mac 00:04:67:cb:2f:e6,etherType 0x0800 2019/11/29 03:12:36\r\n IpProType 0x01,Src Ip address 221.2.128.123,Dest Ip address 112.224.69.144 2019/11/29 03:12:36\r\n ICMP Type 0,Code 0 2019/11/29 03:12:36\r\n *****************************************  End  ***************************************\r\n2019/11/29 03:12:36\r\n *********  2019/11/29 03:12:36: [tNetTask] Send pkt , unit 17794,vid 101,len 78  **********2019/11/29 03:12:36\r\n Dst Mac 54:89:98:3c:87:17,Src Mac 00:04:67:cb:2f:e6,etherType 0x0800 2019/11/29 03:12:36\r\n IpProType 0x01,Src Ip address 221.2.128.123,Dest Ip address 112.224.69.144 2019/11/29 03:12:36\r\n ICMP Type 0,Code 0 2019/11/29 03:12:36\r\n *****************************************  End  ***************************************\r\n2019/11/29 03:12:36\r\n *********  2019/11/29 03:12:36: [tNetTask] Send pkt , unit 17794,vid 101,len 78  **********2019/11/29 03:12:36\r\n Dst Mac 54:89:98:3c:87:17,Src Mac 00:04:67:cb:2f:e6,etherType 0x0800 2019/11/29 03:12:36\r\n IpProType 0x01,Src Ip address 221.2.128.123,Dest Ip address 112.224.69.144 2019/11/29 03:12:36\r\n ICMP Type 0,Code 0 2019/11/29 03:12:36\r\n *****************************************  End  ***************************************\n从debug统计的情况来看，交换机收到的包远超过BRAS发送的包。\n \n \n2、将交换机的loopback地址删除，则无法ping通，说明不存在IP地址冲突；\n \n3、将loopback地址更改掩码后配置到vlan接口，则恢复正常；\n根因:一、loopback地址丢包原因分析\r\n1、S7800接口收到对端SW1设备发送过来的目的ip为环回地址的icmp（ttl为256）request报文，送到cpu处理（回应icmp reply报文）后未丢弃，匹配缺省路由后将报文返回给对端设备，并将ttl减1；\r\n2、对端收到源ip为自己接口地址，目的ip为S7800环回地址的icmp（ttl为255）request报文报文后，又查找路由转发给S7800并将ttl减1；\r\n3、第一个ping包发送的icmp request报文重复1和2流程，在对端和S7800之间转发，一直到ttl为1才终止；\r\n4、因1、2、3流程不断的重复会占用相关icmp 的CPU资源，导致一定数量的ICMP包丢弃；\r\n二、丢包的根本原因\r\nS7800收到目的ip为环回地址的icmp报文送cpu后未终结转发：\r\n1、在S7800存在默认路由的情况下，目的地址为环回地址的包会匹配上默认路由后然后转发出去，然后对端又转回来，这样在两台设备间来回转发直到ttl值为1才终止;\r\n2、在S7800没有默认路由情况下，目的地址为环回地址的包，没有路由匹配就会在S7800上终结掉；\r\n三、ping测试丢包的影响\r\n多余ICMP报文处理会占用一定cpu资源，对使用ping来进行网络故障的判断造成干扰，但不会对实际的业务流量造成影响。\n解决方案:临时解决方案\r\n在S7800上与其他设备互连的接口（eth-trunk或物理）上或在全局配置filter-list将目的ip为本机环回地址的ip包丢弃\r\nfilter-list 1001\r\nfilter 1 ip any 10.72.1.1/32                             //10.72.1.1为S7800的loopback地址\r\nfilter 1 action deny\ninterface gigaethernet 1/0/1             //接口调用\r\nfilter-list in 1001\n或filter-list global in 1001   //全局调用\n最终解决方案\n20190904之后的软件版本已经解决此问题，针对20190904的软件版本已经发布补丁，注意loopback补丁加载后，重新配置loopback地址才可以生效。\n原因分类:无\n"}
{"instruction": "某地市广电医保专线随机无法刷卡问题。某地市广电医保专线改造项目，在将原光转线路整改为烽火GPON网络后，随机出现故障，故障时医保终端与医保专线服务器网关ARP交互异常导致业务中断。", "input": "", "output": "案例主题:某地市广电医保专线随机无法刷卡问题\n案例编号:AL2020110510291\n网络场景:\n现象描述:某地市广电医保专线改造项目，在将原光转线路整改为烽火GPON网络后，随机出现故障，故障时医保终端与医保专线服务器网关ARP交互异常导致业务中断。\n处理过程:根据与客户沟通了解以及现场抓包分析，了解到目前医保专网网络规划以及网络特点如上图拓扑。\n一、现阶段医保专网网络拓扑结构以及其网络特点\n通过IP地址规划以及抓包分析，医保专网为二层结构网络。为了实现对不同医保客户的区分，为不同类型的医保客户端分配不VLAN，所有的客户端使用同一个IP地址作为医保网关。通过以上信息可以判断，医保网关使用VLAN聚合技术。\n按照目前这样的组网方式，医保网关在处理ARP报文交互时会发送大量不同VLAN ARP内容相同的报文。\n网关ARP老化时发送的单播ARP request报文请求\n\n（图一）\n网关ARP老化时发送的广播ARP request报文请求\n\n（图二）\n二、药房医保场景问题排查过程\n    根据客户反馈连锁药房出现问题的几率较大。通过走访不同类型多家药房，查看药房医保PC终端的业务应用以及PC端的网卡设置。发现出问题连锁药房PC终端配置双网卡，PC终端需要上网业务和医保业务并存，在此情况下PC终端网卡没有配置医保网关信息。\n在药房通过在MDU设备上配置镜像功能抓包发现没有捕获到业务VLAN301对应ARP报文。\n在局端机房主控上联端口配置镜像功能抓包能够捕获到业务VLAN301对应ARP报文，随后将槽位镜像配置镜像功能，没有捕获到业务VLAN301的对应ARP报文。\n通过抓包判断主控丢弃部分ARP报文，修改OLT上联端口未知单播报文包抑制数值，ARP报文交互正常。\n药房终端MDU没有收到对应的vlan的ARP报文\n\n（图三）\n \n三、医院医保场景问题排查过程\n查看医院防火墙配置，防火墙对单播ARP报文有检验不回复此ARP报文。\n将医院业务切回光转线路抓包，查看防火墙设备与医保网关ARP交互过程。\n在职业病机房MDU设备上配置镜像功能，没有捕获到到业务VLAN201对应的ARP报文。\n通过抓包判断主控丢弃部分ARP报文，修改OLT上联端口广播报文包抑制数值，ARP报文交互正常。\n医院MDU没有收到到对应vlan的ARP报文\n\n（图四）\n故障原因分析以及结论\n一、药房医报场景问题分析\n根据药房与医保服务器ARP交互报文分析如下：\n药房电脑PC没有设置网关，导致PC上ARP老化后没有发送ARP请求网关（172.100.0.254）的mac地址。在医保网关超过1200秒后ARP老化，老化时发送请求药房PC端的单播ARP request报文。此时交换的mac地址学习表已经老化，交换芯片认为此报文为未知单播报文。由于上联端口有未知单播报文包抑制默认配置，导致部分此类报文在交换芯片上被随机丢弃。PC端无法接收到医保网关发送的ARP request报文，导致医保网关ARP表老化后业务中断。\n二、医院医保场景问题分析\n根据医院防火墙与医保服务器ARP交互报文分析如下：\n职业病医保网关设备为防火墙，防火墙中有默认设置判定单播ARP为攻击包，防火墙不处理网关的ARP单播请求。由于上联端口有广播报文包抑制默认配置，导致部分广播ARP报文在交换芯片上被随机丢弃。医保防火墙无法接收医保网关发送的广播ARP报文，导致医保网关ARP表老化后业务中断。\n三、OLT包抑制功能以及医保专网中ARP交互异常分析\n在电信、移动等运营商的使用场景中OLT设备默认配置包抑制功能。在上联口配置了下行配包抑制，减少非法报文对终端设备的冲击，上述运营商业务通常是终端用户发送广播ARP请求上层网关设备通过单播应答。因医保专线业务的特殊性（如下图分析），OLT设备将过多的下行ARP报文主动丢弃导致交互异常，设备转发能力不存在问题，需修改上联口下行广播包抑制保证医保专线业务ARP交互正常。\n\n现网OLT设备上联口镜像，因报文数量太大，报文捕获只能持续1分钟左右，从统计上看上联口收到的ARP报文每秒大约在2000左右，在加上突发情况ARP报文数量较大。\n根因:四、故障结论\n由于医保网络的特殊性，其上端网关会向下发送大量的单播和广播ARP，而OLT默认是按照传统运营商应用规划布置网络（上联口对广播包和未知包进行抑制，减少非法报文对终端设备的冲击），导致在医保专网环境中在OLT上出现ARP随机丢包，从而导致医保业务中断情况。\n解决方案:解决方案\n一、针对医保专网的特殊网络环境提供如下解决方案：\n\n修改OLT老化时间为1500s，减少未知单播包冲击医保MDU；\n修改MDU老化时间为1200s，防止MDU MAC地址老化导致下行单播ARP被抑制丢弃。\n医保专网槽位之外的槽位做槽位上联口未知包、广播包抑制配置，医保槽位放开包抑制限制。\n\n二、针对目前医保专网的特殊网络环境对后续业务开通建议：\n\n医保专线业务建议使用AN5506-07/09/10设备开通，AN5506-04C设备是针对家庭宽带业务设计不建议后续在专线业务上使用。现网已开通的AN5506-04C设备需基于网络规模观察，目前运行正常。\n建议修改防火墙安全等级配置，使单播ARP报文交互正常，这样可以有效的减少网络中广播ARP报文的数量并避免广播ARP突发报文；\n\n原因分类:无\n"}
{"instruction": "某运营上的敏感客户反馈点位随机掉线，偶发性随机丢包。。由于客户对会议质量要求比较敏感，所以对于服务器端会议终端的在线情况要求二十四小时不允许掉线。客户从会议终端的网管历史记录里，发现每天随机时间，都有随机的点位掉线一分钟后，自行恢复。通过用户服务器上的会议终端厂家的专业网管的超级ping功能，检测到每次点位掉线时，从服务器ping测掉线的会议终端在一分钟内有5%的丢包，导致会议终端和用户网管的心跳报文丢失，导致会议网管上点位监控掉线。客户判断是我司IPRAN网络质量问题导致的业务丢包，要求我司排查。", "input": "", "output": "案例主题:某运营上的敏感客户反馈点位随机掉线，偶发性随机丢包。\n案例编号:AL2020110610351\n网络场景:某敏感用户的视频调度系统通过我司IPRAN网络承载。我司通过vpws方式进行开通60个点到点的专线业务。60个点位中汇聚点为我司A2设备，连用户的汇聚交换机和总服务器。下面60个点位为我司和友商的不同A1设备承载，A1设备出去接用户的会议终端。服务器端上可以通过客户的网管监控到终端点位的状态。\n\n现象描述:由于客户对会议质量要求比较敏感，所以对于服务器端会议终端的在线情况要求二十四小时不允许掉线。客户从会议终端的网管历史记录里，发现每天随机时间，都有随机的点位掉线一分钟后，自行恢复。通过用户服务器上的会议终端厂家的专业网管的超级ping功能，检测到每次点位掉线时，从服务器ping测掉线的会议终端在一分钟内有5%的丢包，导致会议终端和用户网管的心跳报文丢失，导致会议网管上点位监控掉线。客户判断是我司IPRAN网络质量问题导致的业务丢包，要求我司排查。\n处理过程:（1）我司从带宽占用，光功率性能，CRC、温度、电压等外界因素上排查了业务所经过的所有设备，均正常。\n（2）我司从设备内存利用率，CPU利用率，磁盘占用率，单盘告警，硬件故障等内部因素上排查了业务所经过的所有设备，均正常。\n（3）初步排查非我司IPRAN网内设备问题导致丢包，为了证明我司通道性能正常，选取部分出现过掉线的会议终端点位。我司在IPRAN网络上新开测试的点到点业务，不接用户的交换机和服务器，两侧都接笔记本电脑。证明思路是只要在终端掉线的时间点，我司的测试通的ping测试正常的，就能向客户证明我司IPRAN点到点性能正常。\n（4）笔记本电脑两头ping测需要实现两个功能：一是将二十四小时ping测得结果自动保存为txt文件到电脑的磁盘中，便于取证。二是需要将每次ping测的返回中记录北京时间，精确到几点几分几秒，以便于和客户会议终端网管上的掉线时间做对比。\n（5）制作将ping测结果带时间戳的方式自动保存txt文件到电脑的vbs脚本，详见附件ping.vbs\nDim args, flag, unsuccOut  \r\nargs=\"\"  \r\notherout=\"\"  \r\nflag=0  \n\r\nIf WScript.Arguments.count = 0 Then  \r\nWScript.Echo \"Usage: cscript tping.vbs [-t] [-a] [-n count] [-l size] [-f] [-i TTL] [-v TOS]\"  \r\nWScript.Echo \"                         [-s count] [[-j host-list] | [-k host-list]]\"  \r\nWScript.Echo \"                         [-r count] [-w timeout] destination-list\"  \r\nwscript.quit  \r\nEnd if  \n\r\nFor i=0 to WScript.Arguments.count - 1  \r\nargs=args & \" \" & WScript.Arguments(i)  \r\nNext  \n\r\nSet shell = WScript.CreateObject(\"WScript.Shell\")  \r\nSet re=New RegExp  \r\nre.Pattern=\"^Reply|^Request|^来自|^请求\"  \n\r\nSet myping=shell.Exec(\"ping\" & args)  \n\r\nwhile Not myping.StdOut.AtEndOfStream  \r\n   strLine=myping.StdOut.ReadLine()  \r\n'WScript.Echo  \"原数据\" & chr(9) & strLine  \r\n   r=re.Test(strLine)  \r\n   If r Then  \r\nWScript.Echo date & \" \"& time & chr(9) & strLine  \r\nflag=1  \r\n   Else  \r\nunsuccOut=unsuccOut & strLine  \r\n   End if  \r\nWend  \n\r\nif flag = 0 then  \r\nWScript.Echo unsuccOut  \r\nend if\n根因:通过ping测的txt文件取证，证明发现专业网管掉线时，我司通的ping测正常，未丢包。\n用户研发继续自己协调服务器厂家排查，发现是会议终端网管与服务器的兼容问题导致。非我司原因导致。\n解决方案:（1）制作将ping测结果带时间戳的方式自动保存txt文件到电脑的vbs脚本，详见附件ping.vbs\n（2）电脑运行CMD，调用制作好的vbs脚本命令，指定每次ping测一千字节长ping：cscript ping.vbs IP -t -l 1000 -w 5000>ping.txt\n（3）通过ping测的txt文件取证，证明发现专业网管掉线时，我司通的ping测正常，未丢包。\n\n原因分类:无\n"}
{"instruction": "某地市使用R820做vpls承载IGMP Snooping配置问题。某地市客户希望使用R820，承载接入汇聚功能，并启用IGMP Snooping功能，下挂OLT做IPTV业务。配置完成，单波业务正常，组播业务受阻。并且无法像交换机样，绑定上联端口", "input": "", "output": "案例主题:某地市使用R820做vpls承载IGMP Snooping配置问题\n案例编号:AL2021012012571\n网络场景:\n现象描述:某地市客户希望使用R820，承载接入汇聚功能，并启用IGMP Snooping功能，下挂OLT做IPTV业务。配置完成，单波业务正常，组播业务受阻。并且无法像交换机样，绑定上联端口\n处理过程:1、由于首次使用IGMP Snooping功能，所有优先是进行了命令的确认，确认动态IGMP Snooping命令为\nrouter#mpls vpls vlan_0110 5\r\nrouter(config-vpls)#ip igmp snooping\n2、但是告知客户后，客户尝试仍然业务不通。尝试抓包，但是fos enable登录操作系统，root账号有误。\n3、需要上站网线直连，或者是尝试重启设备\n4、客户选择重启。之后IGMP Snooping和登录操作系统均正常\n \nHRB-D5-KTT#sh igmp-snooping fowarding-table detail\r\nvpls id: 5 group: 239.1.3.93\r\nuni: lag4.110\r\nsource (exlude):\n \nHRB-D5-KTT#sh vpls igmp snooping statistics vpls 5\r\nVPLS_IGMP Snooping statistics for VPLS5\r\nInterface: VPLS5\r\nGroup: 239.1.3.93\r\nUptime: 00:24:10\r\nGroup mode: Exclude ()\r\nLast reporter: 0.0.0.0\r\nSource list is empty\n \nHRB-D5-KTT#show vpls igmp interface\nnterface VPLS5UNIlag1.110 (Index 268439662) (VPLS 5)\r\nVPLS_IGMP Enabled, Active, Non-Querier, Version 2 (default)\r\nVPLS_IGMP interface has 0 group-record states\r\nVPLS_IGMP activity: 0 joins, 0 leaves\r\nVPLS_IGMP query: 37 querys\r\nVPLS_IGMP querying router is 10.88.46.17\r\nVPLS_IGMP querier timeout is 255 seconds,config is 255 seconds\r\nVPLS_IGMP query interval is 125 seconds,config is 125 seconds\r\nVPLS_IGMP robustness variable is 2,config is 2 seconds\r\nVPLS_IGMP max query response time is 10 seconds\r\nVPLS_IGMP Group Membership timeout is 260 seconds\r\nVPLS_IGMP Last member query response interval is 1000 milliseconds\r\nVPLS_IGMP Snooping is globally enabled\r\nVPLS_IGMP Snooping is enabled on this interface\r\nVPLS_IGMP Snooping fast-leave is not enabled\r\nVPLS_IGMP Snooping querier is not enabled\r\nVPLS_IGMP Snooping report suppression is enabled\r\nVPLS_IGMP Snooping rx_tag is 0\r\nVPLS_IGMP Snooping tx_tag is 0\r\nVPLS_IGMP Snooping tx_vlan_id is 2\n根因:1、命令问题：vpls上配置IGMP Snooping，采用router(config-vpls)#ip igmp snooping这一条命令。并且需要检查配置已经写入设备\n2、同客户沟通，该设备近期配置多次更改，可能存在残留问题。但是由于无法给我们远程，这一点只能猜测。通过重启恢复。\n解决方案:1、确认配置动态vpls的命令为router(config-vpls)#ip igmp snooping\n2、提供功能正常的验证命令，详细见处理过程：\nsh igmp-snooping fowarding-table detail\nsh vpls igmp snooping statistics vpls 5\nshow vpls igmp interface\n原因分类:无\n"}
{"instruction": "通道时延过长造成业务无法承载。某网络使用烽火OTN设备加载从东北至西部的一条10G电路，对接烽火OTN设备的两端为路由器设备。\n在业务加载过程中，路由器维护人员反馈该电路时延过大，无法承载相应的业务。通过环回测试反馈的时延平均值为75ms，认为烽火设备存在缺陷。", "input": "", "output": "案例主题:通道时延过长造成业务无法承载\n案例编号:AL2020122911391\n网络场景:对时延有要求的业务\n现象描述:某网络使用烽火OTN设备加载从东北至西部的一条10G电路，对接烽火OTN设备的两端为路由器设备。\n在业务加载过程中，路由器维护人员反馈该电路时延过大，无法承载相应的业务。通过环回测试反馈的时延平均值为75ms，认为烽火设备存在缺陷。\n处理过程:1、总部针对现网烽火设备单机时延给出的测试数据结果如下：STM64业务时延测试为204.9us；\n可以看出，单机时延都是微秒级，与现网毫秒级的时延相差很远，所以现网的时延主要是由光缆传输距离决定的。\n\n \n2、现场利用仪表通过环回，实际进行时延测试 ：在A端站点挂表，分别在经过的每个复用段站点进行烽火设备上波分侧的环回进行时延测试。测试结果如下：\n\n\n\n\n起始站点\n\n\n环回站点\n\n\n时延（ms）\n\n\n备注\n\n\n\n\n西宁枢纽楼A\n\nA\n\n10.4\n\n\n \n\n\n\n\n \n\n\nB\n\n\n32.7\n\n\n\n\n \n\n\nC\n\n\n33\n\n\n\n\n \n\n\nD\n\n\n40.2\n\n\n\n\n \n\n\nE\n\n\n48.5\n\n\n\n\n \n\n\nF\n\n\n54.4\n\n\n\n\n \n\n\nG\n\n\n59.5\n\n\n\n\n \n\n\nH\n\n\n63.9\n\n\n\n\n \n\n\nI\n\n\n68.5\n\n\n\n\n \n\n\nJ\n\n\n69.2\n\n\n\n\n \n\n\nK\n\n\n72.7\n\n\n\n\n \n\n\nL\n\n\n78.2\n\n\n\n\n \n\n\nM\n\n\n82.3\n\n\n\n\n \n\n\nN\n\n\n86.2\n\n\n\n\n     从现场人员使用仪表测试的结果与路由器厂家提供的ping测试结果比较，结果基本一致。\n根因:由实验室测试和现网测试结果可以看出，单机设备时延都是微秒级，与现网毫秒级的时延相差很大，现网的时延主要是由光缆传输距离决定的。\n考虑网络光缆分布以及设备的复用段配置情况，根据各个区间段的光缆跨距以及OTU配置，计算出相应站点的时延分布情况如下：\n\n\n\n\n站名\n\n\n跨距(KM)\n\n\n累计跨距\n\n\n理论时延（ms）\n\n\n实测时延(ms)\n\n\n\n\nA\n\n\n \n\n\n \n\n\n \n\n\n \n\n\n\n\nB\n\n\n875\n\n\n875\n\n\n8.75+0.8=9.55\n\n\n10.4\n\n\n\n\nC\n\n\n1951\n\n\n2826\n\n\n28.26+4=32.26\n\n\n32.7\n\n\n\n\nD\n\n\n20\n\n\n2846\n\n\n28.46+4.4=32.86\n\n\n33\n\n\n\n\nE\n\n\n631\n\n\n3477\n\n\n34.77+4.8=39.57\n\n\n40.2\n\n\n\n\nF\n\n\n721\n\n\n4198\n\n\n41.98+5.2=47.18\n\n\n48.5\n\n\n\n\nG\n\n\n505\n\n\n4703\n\n\n47.03+5.6=52.63\n\n\n54.4\n\n\n\n\nH\n\n\n423\n\n\n5126\n\n\n51.26+6=57.26\n\n\n59.5\n\n\n\n\nI\n\n\n367\n\n\n5493\n\n\n54.93+6.4=61.33\n\n\n63.9\n\n\n\n\nJ\n\n\n411\n\n\n5904\n\n\n59.04+6.8=65.84\n\n\n68.5\n\n\n\n\nK\n\n\n58\n\n\n5962\n\n\n59.62+7.2=66.82\n\n\n69.2\n\n\n\n\nL\n\n\n284\n\n\n6246\n\n\n62.46+7.6=70.06\n\n\n72.7\n\n\n\n\nM\n\n\n466\n\n\n6712\n\n\n67.12+8=75.12\n\n\n78.2\n\n\n\n\nN\n\n\n342\n\n\n7054\n\n\n70.54+8.4=78.94\n\n\n82.3\n\n\n\n\nO\n\n\n336\n\n\n7390\n\n\n73.9+8.8=82.7\n\n\n86.2\n\n\n\n\n \n说明：\n1、跨距是指各个复用段站点之间的光缆距离\n2、累计跨距是指各个站点至西宁的光缆累积距离\n3、理论时延是指在A端挂表，从各个站点环回时的理论计算值，计算时考虑光缆的双向来回距离和所经过站点的OTU系统个数\n4、实测时延是指在西宁挂表，相应各个站点环回测试的数值\n5、环回的时延计算方法：时延值=单向跨距*2*5微秒/km+OTU个数*0.2毫秒*2\n  \n   单向时延简单计算方法：时延值=单向跨距*5微秒/km+OTU个数*0.2毫秒\n \n     通过以上分析比较，理论计算值与实际测试值大致相当，工程中的业务通道线路长度：7390KM--------线路时延：73.9ms；设备OTU为：烽火38个-----设备时延：8.8ms；上述2项合计：82.7ms。说明工程中的业务通道时延在正常的范围内，不存在过大的问题。对于业务通道的加载业务，需要明确路由器的时延设置标准。\n对于该工程的设计资料中，并没有系统时延的设计规范资料，因此需要与运营商进行协商。\n解决方案:通过上述理论和实际分析，对于在加载业务时出现电路时延值较大的问题，烽火结论如下：\n\n烽火OTN设备的传输时延控制在合理范围，全程通过的设备总计时延在9ms左右。\n相应的光缆路由有7390km，为业务通道传输的主要时延部分，双向时延约为74ms。\n鉴于用户需要开通相关业务，建议从工程中找出最短路由提供给用户使用。\n由于工程招标中，没有明确的时延要求，建议重新规划路由，协商合理的时延要求。\n\n原因分类:无\n"}
{"instruction": "新建tunnel业务下载失败，报某一网元配置存在残存业务。在新建tunnel业务部署，在下载时失败。报报某一网元配置存在残存业务", "input": "", "output": "案例主题:新建tunnel业务下载失败，报某一网元配置存在残存业务\n案例编号:AL2023020211002\n网络场景:在新建tunnel业务部署下载\n现象描述:在新建tunnel业务部署，在下载时失败。报报某一网元配置存在残存业务\n处理过程:1）从报错网元ID：13177541,使用SQLyog工具查看57904网元所在的网元实例，，命令：SELECT * FROM `integratecfgdb`.`t_nedevice` WHERE cobjectid= 13177541 ；查到此网元在第二个neserver实例,如下图：       再使用IceGridGUI 工具查看第二个neserver实例， Process id:16152，如下图：   2）在D:\\unm2000\\server\\log下搜索16152，会在msmp_neentity目录下打开unm_logger_neentity_[16152]文件，再次搜索业务ID:1535059530，查到冲突业务ID:1534966571;（若此文件中搜索不到业务ID，估计是备用通道业务ID存在冲突，需要去msmpwriteserver日志查备用业务ID，再去neentity日志搜索）如图：  3）在网管多业务界面，全局查询，以对象ID:1534966571搜索，此业务ID是不存在；使用SQLyog工具，命令select * from integratecfgdb.`t_nedevice` where cobjectid in (SELECT cneid FROM tnbusinessdb.`t_emsbizinfo` WHERE cbusinessid =1534966571)；查出此TUNNEL业务涉及下述三个网元（40401,60203,60206），如图：4）分别打开40401,60203,60206网元管理器，在“业务管理”tunnel中搜索1534966571可以看到，三个网元在节点类型“Transit\"（表示为”中间点），不是落地点（Egress），说明这三网元tunnel为：1534966571确实是残留，与多业务管理界面无法搜索到，进一步证实；如下图：5）1-4步找到下载失败的原因，及具体哪些残留数据影响，下面就是对三个网元残留进行删除。     在打开40401,60203,60206网元管理器中，搜索tunnel ID，发现“删除”菜单为灰色，无法进一步删除操作，需要在D:\\unm2000\\server\\etc\\platform-options.ini中添加一项consistencyMode=0;把ForceDeleteBySingle 改成true;如下图：       在网管界面上，打开网元管理器，热键“ctrl+shift+f12+f12”调出“unm console\"窗口，选择”other setting\"勾选“single station service configuration enable\"，如下图：   6）关闭网元管理器，重新打开，在”业务管理“tunnel中搜索1534966571，若是激活状态，先去激活，再点删除，就ok,依次删除三个网元TUNNEL残留。（打开”删除“还是灰色，重新热键“ctrl+shift+f12+f12”，再打开网元器）；再在多业务界面重新对新建业务ID:1535059530下载激活就可以了。\n根因:业务割接时，TUNNEL重新调整，出现如下二种情况造成TUNNEL残留：1）去激活，删除时，网管卡顿，或者服务异常，导致多业务界面业务ID不存在，在网元管理中残留业务处于未激活状态；   在数据库表体现为，t_emsbizinfo、t_emsbizcfg、 t_emsnedeledbizinfo(网元层)三个张表，没有冲突业务ID（如：1534966571），而在变更信息缓存表（通常称为残留表）为：t_snc_disusednedata(业务层)、 t_emsnedeledbizinfo(网元层)、t_emsresidualdnecfg(端口层)2.      激活业务时，网管会根据t_emsbizcfg表下对设备发配置，针对t_snc_disusednedata(业务层)、t_emsnedeledbizinfo(网元层)、t_emsresidualdnecfg(端口层)三个表，对网元数据进行新增或删减；\n解决方案:1、通过unm_logger_neentity日志查出冲突的业务ID，在通过此业务ID，在多业务查中查冲突ID确定不存在，然后在数据表表t_emsbizinfo、t_emsbizcfg、 t_emsnedeledbizinfo(网元层)三个张表（是一致的），查出涉及网元名称2、在网管D:\\unm2000\\server\\etc\\platform-options.ini中开启二个参数，再ctrl+shift+f12+f12”调出“unm console\"窗口，选择”other setting\"勾选“single station service configuration enable\"开启单站调式模式；3、网元管理器中打开涉及的网元，搜索冲突的TUNNEL ID,类型都为“Transit”，说明都是中间站点，直接删除，解决问题\n原因分类:无\n"}
{"instruction": "某地市电信校园网采用将汇聚路由器放置在PON口下组网开通问题。某地市电信承接了校园网业务，涵盖有3种业务类型：视频监控业务、白板业务和宽带上网业务。\n视频监控业务：采用互联网摄像头，存储服务器在云端；白板业务：类似于网络点播或者直播方式的在线教育；宽带上网业务：教学、教务访问互联网。\n总结：\n\n3种业务类型都需要访问互联网，通过网络实现各自的功能。\n3种业务类型都是通过DHCP方式从汇聚路由器自动获取到各自网段的IP，并通过汇聚路由器的互联网出口访问网络。\n汇聚路由器通过不同的LAN口、划分不通的vlan和分配不同的地址池，来区分3种业务类型。\n\n在首次开通视频监控业务时，发现摄像头获取不到地址，只能通过手动配置固定ip。\n另，承载该校园网的OLT是与家客用户共用的。同时，按照电信的要求是需要开启pppoe+和option82功能。\n ", "input": "", "output": "案例主题:某地市电信校园网采用将汇聚路由器放置在PON口下组网开通问题\n案例编号:AL2021010812032\n网络场景:\n现象描述:某地市电信承接了校园网业务，涵盖有3种业务类型：视频监控业务、白板业务和宽带上网业务。\n视频监控业务：采用互联网摄像头，存储服务器在云端；白板业务：类似于网络点播或者直播方式的在线教育；宽带上网业务：教学、教务访问互联网。\n总结：\n\n3种业务类型都需要访问互联网，通过网络实现各自的功能。\n3种业务类型都是通过DHCP方式从汇聚路由器自动获取到各自网段的IP，并通过汇聚路由器的互联网出口访问网络。\n汇聚路由器通过不同的LAN口、划分不通的vlan和分配不同的地址池，来区分3种业务类型。\n\n在首次开通视频监控业务时，发现摄像头获取不到地址，只能通过手动配置固定ip。\n另，承载该校园网的OLT是与家客用户共用的。同时，按照电信的要求是需要开启pppoe+和option82功能。\n \n处理过程:1、由于汇聚路由器放置在了PON口下，且所有站点的ONU分布在与汇聚路由器相同的PON口或者板卡下，故照常规的方式是：打开pon内互通和pon口间互通。\n2、汇聚路由器在2-5pon口，其他站点分布在2-1至2-5pon口，pon内和pon间互通打开指令如下：\n#将2槽位PON口间隔离去使能（默认为隔离使能）\r\nAdmin\\card#set separate slot 2 status disable\n#将2槽位1-5PON口打开PON内隔离\r\nAdmin\\card#set pon_interrior_interflow slot 2 pon 1 seperate disable\r\nAdmin\\card#set pon_interrior_interflow slot 2 pon 2 seperate disable\r\nAdmin\\card#set pon_interrior_interflow slot 2 pon 3 seperate disable\r\nAdmin\\card#set pon_interrior_interflow slot 2 pon 4 seperate disable\nAdmin\\card#set pon_interrior_interflow slot 2 pon 5 seperate disable\n3、互通打开后，测试发现如下情况：\n同PON口同VLAN，自动获取IP不成功；\r\n同PON口同VLAN，配置固定IP和DNS，可以ping同其网关且能上网；\r\n同PON口同VLAN，两端HGU相同VLAN端口配置相同网段IP，互ping通，证明PON内互通是可以的。\nPON口间自动获取IP不成功。\n结论：同PON口和PON口间自动获取不成功，配置固定IP可行。\n3、研发同事查看olt配置开启了ppoe+和option82，判定与option82有关系，导致dhcp自动获取地址失败。\n线卡开启了Option82线路标识，ONU上行的DHCPv4 Request报文先匹配规则上CPU，然后三层协议添加线路标识，指定端口发往槽位口。\n不开启Option82的时候，是匹配规则直接发送到槽位口。\n即，不管开不开启Option82线路标识，这个报文都要发到槽位口，无法转发到其他PON口或者同PON口下挂接的路由器上，所以动态IP分配失败。\n4、由于后续业务都是通过DHCP方式获取IP，故必须解决自动获取IP失败的问题。\n5、根据该校园网特征，采用如下业务配置方式解决问题：\n#将2槽位PON口间隔离使能（默认为隔离使能）\r\nAdmin\\card#set separate slot 2 status ensable\n#将2槽位1-5PON口打开PON内隔离\r\nAdmin\\card#set pon_interrior_interflow slot 2 pon 1 seperate disable\r\nAdmin\\card#set pon_interrior_interflow slot 2 pon 2 seperate disable\r\nAdmin\\card#set pon_interrior_interflow slot 2 pon 3 seperate disable\r\nAdmin\\card#set pon_interrior_interflow slot 2 pon 4 seperate disable\r\nAdmin\\card#set pon_interrior_interflow slot 2 pon 5 seperate disable\n#配置路由器所在的2槽位5PON口，业务100-102以及PON内互通\r\nAdmin\\ard# set in_olt_interflow slot 2 index 1 pon 5 vlan 100 interflow_mode in_card\r\nAdmin\\ard# set in_olt_interflow slot 2 index 2 pon 5 vlan 101 interflow_mode in_card\r\nAdmin\\ard# set in_olt_interflow slot 2 index 3 pon 5 vlan 102 interflow_mode in_card\n#在2槽线卡上应用路由器配置\r\nAdmin\\card#apply in_olt_interflow slot 2\n#在主控上应用路由器配置\r\nAdmin\\card# apply in_olt_interflow core_card\n#option82关闭\r\ngcob\\lineid#set option82 disable\n \n \n根因:1、路由器在PON内且实现PON内和PON间互通，需要采用特殊的配置方式。\n2、通过DHCP方式在PON内和PON间实现自动获取IP地址，需要关闭option82线路标识功能。\n \n解决方案:#将2槽位PON口间隔离使能（默认为隔离使能）\r\nAdmin\\card#set separate slot 2 status ensable\n#将2槽位1-5PON口打开PON内隔离\r\nAdmin\\card#set pon_interrior_interflow slot 2 pon 1 seperate disable\r\nAdmin\\card#set pon_interrior_interflow slot 2 pon 2 seperate disable\r\nAdmin\\card#set pon_interrior_interflow slot 2 pon 3 seperate disable\r\nAdmin\\card#set pon_interrior_interflow slot 2 pon 4 seperate disable\r\nAdmin\\card#set pon_interrior_interflow slot 2 pon 5 seperate disable\n#配置路由器所在的2槽位5PON口，业务100-102以及PON内互通\r\nAdmin\\ard# set in_olt_interflow slot 2 index 1 pon 5 vlan 100 interflow_mode in_card\r\nAdmin\\ard# set in_olt_interflow slot 2 index 2 pon 5 vlan 101 interflow_mode in_card\r\nAdmin\\ard# set in_olt_interflow slot 2 index 3 pon 5 vlan 102 interflow_mode in_card\n#在2槽线卡上应用路由器配置\r\nAdmin\\card#apply in_olt_interflow slot 2\n#在主控上应用路由器配置\r\nAdmin\\card# apply in_olt_interflow core_card\n#option82关闭\r\ngcob\\lineid#set option82 disable\n注：后续线卡版本支持基于VLAN或者PON口方式关闭option82线路标识功能。\n原因分类:无\n"}
{"instruction": "1.72.53版本bmc使用curl工具（redfish）进行raid配置。使用带外命令行的方式完成raid配置，方便批量配置raid", "input": "", "output": "案例主题:1.72.53版本bmc使用curl工具（redfish）进行raid配置\n案例编号:AL20211014531\n网络场景:服务器bmc版本1.72.53，配置了3108raid卡（理论上也支持一些其他类型的raid卡，只要bmc内能看到存储监控中菜单，能够在bmc中进行raid配置，就可以用此方法进行raid配置）\n现象描述:使用带外命令行的方式完成raid配置，方便批量配置raid\n处理过程:无\n根因:1、配置时请自行根据实际情况和需求对用户，密码，bmc ip等等配置参数进行修改\n2、需要注意，使用curl配置raid的方式实际上是借助redfish进行raid配置，与在bmc内配置raid的原理基本相同，因此此操作需要在服务器完全开机的情况下进行（即要保证bmc内能看到存储监控中这个菜单并能够看到raid卡下的硬盘，不可停在bios或者raid卡配置菜单等地方）\n3、采用此命令1次只能配置1个raid组，如需要配置多个raid组时，修改相关参数后多次下发即可，但是多条命令下发是建议留出足够的间隙，因为raid组配置命令的相比其他配置命令生效耗时较长，如果短时间内连续下发命令，存在配置失败的可能。\n4、此文档所写的命令均为linux操作系统下curl工具的命令（一般centos7.x操作系统会自带curl工具），windows系统也有curl工具（一般win10系统自带curl工具，网上也可以下载），如需使用windows版curl工具下发相应命令，需要对命令中-d后面的内容进行修改（大括号{}外面的两个单引号'改为双引号\"，大括号里面的双引号\"前面全部加上\\）\n5、配置成功后会有sucess提示，配置完成后建议去bmc存储监控中检查raid的配置情况。\n解决方案:       redfish对3108配置raid的方法如下：\n        curl -X POST -H 'Content-Type':'application/json' -d '{\"ControllerId\":0, \"Raid\": \"RAID10\", \"Span\": 2, \"PhysicalDrives\":[\"HA-RAID.0.Disk.3\", \"HA-RAID.0.Disk.5\", \"HA-RAID.0.Disk.7\", \"HA-RAID.0.Disk.11\"], \"UsePercentage\":100, \"LogicalDriveCount\":1, \"StripSizePerDDF\":\"256K\", \"LdReadPolicy\":\"AlwaysReadAhead\", \"LdWritePolicy\":\"WriteBack\", \"LdIOPolicy\":\"DirectIO\", \"AccessPolicy\":\"ReadWrite\", \"DiskCachePolicy\":\"Unchanged\", \"InitState\":\"QuickInit\"}'   -u ADMIN:ADMIN https://10.82.20.237/redfish/v1/Systems/1/Storages/HA-RAID/Actions/Oem/Storage.CreateVolume -k\n \n        其中各参数定义如下：\n        ControllerId：控制器编号，默认为0\n        RAID：可配置RAID0，RAID1，RAID5，RAID6，RAID10，RAID50，RAID60\n        SPAN：即PD per span参数，配raid0,1,5,6时配置为1，配raid10改为2或者4，配raid50,60改为3或者4,\n        PhysicalDrives：类似\"HA-RAID.0.Disk.3\"格式，多块硬盘用逗号隔开，根据现场实际情况进行调整（disk.3对应bmc存储监控菜单内看到的PD号）\n        LdReadPolicy：可选AlwaysReadAhead，NoReadAhead（按需选择）\n        LdWritePolicy：可选WriteBack，WriteThrough，WriteBackWithBBU （按需选择，需注意：如参数选择WriteBackWithBBU，实际上配进去是AlwaysWriteBack）\n        LdIOPolicy：可选DirectIO，CachedIO（按需选择）\n        AccessPolicy：可选ReadWrite，ReadOnly，Blocked（注意：此参数不建议修改，默认使用ReadWrite）\n        DiskCachePolicy：可选Unchanged，Enable，Disable（按需选择）\n        InitState：可选NoInIT，QuickInit，FullInit（按需选择）\n \n        修改3108RAID卡JBOD功能是否开启的方法如下：\n        curl -X PATCH -H 'Content-Type':'application/json' -d '{\"ControllerId\":0,\"BIOSBootMode\":\"PauseOnError\",\"JBODMode\":\"Enable\"}'   -u ADMIN:ADMIN https://10.82.20.237/redfish/v1/Systems/1/Storages/HA-RAID/Actions/Oem/HARAIDController.Save -k\n \n        其中各参数定义如下：\n        BIOSBootMode：可选PauseOnError，StopOnError，IgnoreError和SafeModeOnError，如无需修改可以删除此参数\n        JBODMode：是否开启JBOD功能，可选Enable和Disable\n原因分类:无\n"}
{"instruction": "某行业网AN6001-G16因VLANIF残留导致ARP代理功能不可用。某地市行业网使用我司AN6001-G16型号OLT和AN5121-4G型号ONU组建内部的办公网络，使用单层VLAN2003开通ONU业务，ONU下挂的PC通过配置固定IP和DNS实现办公的目的。出于公共办公的需求，需要所有的办公PC都可以访问和使用打印机。但是，在OLT上开启ARP代理功能实现ONU之间的互通功能后，发现PC之间网络不通，PC与OLT ARP代理IP之间网络通。", "input": "", "output": "案例主题:某行业网AN6001-G16因VLANIF残留导致ARP代理功能不可用\n案例编号:AL2021031713331\n网络场景:\n现象描述:某地市行业网使用我司AN6001-G16型号OLT和AN5121-4G型号ONU组建内部的办公网络，使用单层VLAN2003开通ONU业务，ONU下挂的PC通过配置固定IP和DNS实现办公的目的。出于公共办公的需求，需要所有的办公PC都可以访问和使用打印机。但是，在OLT上开启ARP代理功能实现ONU之间的互通功能后，发现PC之间网络不通，PC与OLT ARP代理IP之间网络通。\n处理过程:1、检查OLT的ARP代理配置：无问题\n\n\n2、检查ONU的VLAN配置：无问题。\n\n3、ARP代理IP PING测打印机（143.126.243.82）和PC（143.126.243.11）：正常。\n\n \n\n4、PC关闭防火墙，PING侧打印机IP（143.126.243.82）不通，PING其他主机也不通。\n\n\n5、PC PING OLT ARP代理IP通。\n\n6、通过以上的对比分析，初步得出结论：\nPC与ARP代理IP之间网络正常，PC间网络不通，怀疑为AN6001-G16的ARP代理功能存在问题。\n7、上联口镜像槽位抓包，发现PC之间互PING时发起的ARP请求未得到响应，即OLTARP代理功能未生效。\n\n8、使用命令show interface vlanif all，发现作为subvlan2003的竟然也有对应的vlanif存在，这是不合理的。\n\n9、通过将2003对应的vlanif删除后，pc之间的网络可以互访。\n\n根因:1、ARP代理supervlan对应的subvlan2003存在vlanif配置，但是olt并未有使用该vlanif，故应属于vlanif配置残留。\n2、使用命令show vlanif running-config只能查看到当前运行的vlanif配置，但不显示所有配置的vlanif信息，尤其是存在残留的vlanif。\n3、使用命令show interface vlanif all可以查看全局的vlanif配置信息。\n解决方案:1、telnet127.0.0.1 3000 进ipnet 协议栈，查看vlanif2003的接口配置信息\nAdmin(config)# telnet 127.0.0.1 3000\n127.0.0.1#0> ifconfig vlanif2003 task init priority 99 set on task ipcomx_sc_607874a0_1\nvlanif2003      Link type:Ethernet  HWaddr 48:f9:7c:ea:06:7d  Queue:none\r\n        inet6 unicast fe80::4af9:7cff:feea:67d%vlanif2003  prefixlen 64  automatic\r\n        UP RUNNING SIMPLEX BROADCAST MULTICAST\r\n        INNERARPPROXYSTATE:0\r\n        INTERARPPROXYSTATE:0\r\n        physical if arp proxy:1\r\n        arp_switch:1\r\n        MTU:1500  metric:1  VR:0  ifindex:41\r\n        RX packets:34 mcast:0 errors:0 dropped:0\r\n        TX packets:23 mcast:5 errors:0\r\n        collisions:0 unsupported proto:0\r\n        RX bytes:2176  TX bytes:1526\r\n127.0.0.1#0> exit\r\nConnection closed by foreign host.\r\nAdmin(config)#\n2、telnet127.0.0.1 2650 进nbase 协议栈，shutdowm vlanif2003。\nAdmin(config)# telnet 127.0.0.1 2650\nFH-CR8000#show interface vlanif 2003\ninterface vlanif2003\r\n  index 41  mtu 1500\r\n  current state       Up\r\n  Line protocol state Down\r\n  route_type NONE\r\n  inet ipv6 addr fe80::4af9:7cff:feea:67d/64\r\n  vlan_id  2003\r\n  vlan_if_type  normal\r\n  vlanif arp_proxy_enable  disable\r\n  vlanif arp_proxy_inter_sub_enable  disable\r\n  vlanif arp_proxy_inner_sub_enable  disable\r\n  mtu  1500\r\n  HWaddr: 0000.0000.0000\r\nFH-CR8000#config t\nFH-CR8000(config)#interface vlanif 2003\r\nFH-CR8000(if-vlanif2003)#shutdown\r\nFH-CR8000(if-vlanif2003)#exit\nFH-CR8000(config)#\n3、telnet127.0.0.1 2650 进nbase 协议栈，no掉vlanif2003。\nFH-CR8000(config)#no interface vlanif 2003\nFH-CR8000(config)#exit\r\nFH-CR8000#exit\nConnection closed by foreign host.\r\nAdmin(config)#\nAdmin(config)#save\n4、再次telnet127.0.0.1 3000 进ipnet 协议栈，查看vlanif2003的接口配置信息\nAdmin(config)# telnet 127.0.0.1 3000\r\n127.0.0.1#0> ifconfig vlanif2003\nifconfig: interface vlanif2003 not found\r\n127.0.0.1#0> exit\r\nConnection closed by foreign host.\r\nAdmin(config)#\n5、show interface vlanif all 查看全局vlanif配置信息，确认无vlanif2003配置。\n6、至于为何会存在vlanif的配置残留，原因暂时无法找到，后期软件版本更新，在添加或者删除vlanif时校验更严格，尽可能避免残留发生。\n原因分类:无\n"}
{"instruction": "1.72.53版本bmc使用redfish进行常用开通配置。因1.72.52版本bmc进行了一些修改，部分bmc配置无法借助smcipmitool来进行，可以借助curl工具进行命令行方式配置，以达到批量配置的效果。", "input": "", "output": "案例主题:1.72.53版本bmc使用redfish进行常用开通配置\n案例编号:AL20211027711\n网络场景:bmc版本1.72.53\n现象描述:因1.72.52版本bmc进行了一些修改，部分bmc配置无法借助smcipmitool来进行，可以借助curl工具进行命令行方式配置，以达到批量配置的效果。\n处理过程:注意命令的返回结果，如返回success，则配置成功，如返回error或其他，则是配置失败，需要检查命令参数是否正确。\n命令成功返回：\n\n命令失败返回：\n\n根因:1、配置时请自行根据实际情况和需求对用户，密码，bmc ip等等配置参数进行修改\n2、此文档所写的命令均为linux操作系统下curl工具的命令（一般centos7.x操作系统会自带curl工具），windows系统也有curl工具（一般win10系统自带curl工具，网上也可以下载），如需使用windows版curl工具下发相应命令，需要对命令中-d后面的内容进行修改（大括号{}外面的两个单引号'改为双引号\"，大括号里面的所有双引号\"前面全部加上反斜杠\\）\n解决方案:        配置syslog\n        curl -X PATCH -H 'Content-Type':'application/json' -d '{\"ServiceEnabled\":true,\"ServerIdentitySource\":\"HostName\",\"TransmissionProtocol\":\"UDP\",\"SyslogServers\":[{\"Enabled\":true,\"Address\":\"192.168.123.128\",\"Port\":514,\"LogType\":[\"SecurityLog\",\"EventLog\"]},{\"Enabled\":true,\"Address\":\"192.168.123.129\",\"Port\":514,\"LogType\":[\"SecurityLog\",\"EventLog\"]}]}' -u ADMIN:ADMIN https://10.82.20.237/redfish/v1/Managers/1/SyslogService -k\r\n        其中各参数定义如下：\n        ServiceEnabled：开启syslog功能\n        ServerIdentitySource：身份识别方式，可选BoardSN，ProductAssetTag，HostName\n        TransmissionProtocol：传输协议，可选UDP，TCP，TLS\n        Address：syslog服务器地址\n        Port：syslog服务端口\n        LogType：可选\"SecurityLog\"，\"EventLog\"，或者两个都选\n  \n        上述示例命令为配置2条syslog，标黄部分为单条的配置，如需配置更多条目请在后方自行按相同格式添加条目。\n        上述配置完成后效果如下：\n\n        配置snmp\n        打开SNMP功能：\r\n        curl -X PATCH -H 'Content-Type':'application/json' -d '{\"SnmpV1Enabled\": true}' -u ADMIN:ADMIN https://10.82.20.237/redfish/v1/Managers/1/SnmpService -k\n        配置SNMPV2和SNMPV3之前必须先打开SNMP功能\n \n        配置SNMPV2：\r\n        curl -X PATCH -H 'Content-Type':'application/json' -d '{\"SnmpV2CEnabled\": true,\"ReadOnlyCommunity\": \"public\",\"ReadWriteCommunity\": \"private\"}' -u ADMIN:ADMIN https://10.82.20.237/redfish/v1/Managers/1/SnmpService -k\n        参数定义：\n        ReadOnlyCommunity：只读团体名，自行根据要求配置\n        ReadWriteCommunity：读写团体名，自行根据要求配置\n \n        配置SNMPV3：\n        curl -X PATCH -H 'Content-Type':'application/json' -d '{\"SnmpV3Enabled\": true,\"SnmpV3AuthUser\": {\"SnmpV3AuthProtocol\": \"MD5\",\"SnmpV3PrivProtocol\": \"DES\",\"AuthKey\": \"1234@Abcd\",\"PrivateKey\": \"1234@Abcd\"}}' -u ADMIN:ADMIN https://10.82.20.237/redfish/v1/Managers/1/SnmpService -k\n        参数定义：\n        SnmpV3AuthProtocol：SNMPv3认证协议，可选MD5，SHA1\n        SnmpV3PrivProtocol：SNMPv3私有协议，可选DES，AES\n        AuthKey：SNMPv3认证密钥，自行根据要求配置\n        PrivateKey：SNMPv3私有密钥，自行根据要求配置\n        SNMP配置完成后效果如下：\n\n        配置snmp trap（警报）\n        curl -X PATCH -H 'Content-Type':'application/json' -d '{\"SnmpTrapNotification\": {\"TrapServer\":[{\"Enabled\":false,\"AlarmSeverity\":null,\"TrapServerAddress\":\"0.0.0.0\",\"TrapServerPort\":162},{\"Enabled\":true,\"AlarmSeverity\":\"Warning\",\"TrapServerAddress\":\"10.82.20.235\",\"TrapServerPort\":162},{\"Enabled\":true,\"AlarmSeverity\":\"Warning\",\"TrapServerAddress\":\"10.82.20.236\",\"TrapServerPort\":162}]}}' -u ADMIN:ADMIN https://10.82.20.237/redfish/v1/Managers/1/SnmpService -k\r\n \n        其中各参数定义如下：\n        AlarmSeverity：警报级别，可选Critical，Warning，Information\n        TrapServerAddress：TRAP服务器IP地址\n        TrapServerPort：TRAP服务器端口号\n        上述示例命令为配置2条有效警报信息（实际命令中配了3条警报，是因为警报的第一条为临时警报，bmc重启后会失效，因此警报的第一条建议配置为不生效）标黄部分为单条的配置格式，如需配置更多条目请在后方自行按相同格式添加条目。\n        上述配置完成后效果如下：\n\n        配置LLDP\n        可以用如下命令开启BMC的LLDP功能：\n        curl -X PATCH -H 'Content-Type':'application/json' -d \"{\\\"LldpEnabled\\\": true}\" -u ADMIN:ADMIN https://10.82.20.237/redfish/v1/Managers/1/LldpService -k\n        LLDP目前只能借助redfish来配置，无法在bmc界面配置。\n原因分类:无\n"}
{"instruction": "电信网络ER开启ISIS多拓扑导致8000设备频繁上报syslog告警。某电信IPRAN网络，8000 B设备配置syslog后，综合网管收到了B设备info级别的syslog打印：横联ISIS BFD无法创建。\n综合网管收到的log信息一天有几百页的打印。\n \n\n\n\n\n\n产生时间\n设备\n等级\n消息\n \n \n \n \n \n \n \n \n \n \n \n \n \n \n\n\n2021/3/29 16:24\nkern\ninfo\n<6>16:24:54, 29 March 2021:FH-CR8000:FIBERHOME:isis:6:BFD_SESSION_ADD_SEND:The session_id of ISIS session_add message: session_id (Peer_address=[106.16.27.222], peer_address_length =[4],Source_addresss=[106.16.27.221], Source_address_length =[4],if_name=[ten-gigabitethernet0/5/1/11.100], vrf_id=[0]\n \n \n \n \n \n \n \n \n \n \n \n \n \n \n\n\n2021/3/29 16:24\nkern\ninfo\n<6>16:24:54, 29 March 2021:FH-CR8000:FIBERHOME:isis:6:CRT_BFD_SESION_FAIL::ISIS [100] failed to create the BFD session with peer [1060.1602.6121] level-[2] on the interface. (Interface=[ten-gigabitethernet0/5/1/11.100]\n \n \n \n \n \n \n \n \n \n \n \n \n \n \n\n\n2021/3/29 16:24\nkern\ninfo\n<6>16:24:46, 29 March 2021:FH-CR8000:FIBERHOME:isis:6:BFD_SESSION_ADD_SEND:The session_id of ISIS session_add message: session_id (Peer_address=[106.16.27.222], peer_address_length =[4],Source_addresss=[106.16.27.221], Source_address_length =[4],if_name=[ten-gigabitethernet0/5/1/11.100], vrf_id=[0]\n \n \n \n \n \n \n \n \n \n \n \n \n \n \n\n\n2021/3/29 16:24\nkern\ninfo\n<6>16:24:46, 29 March 2021:FH-CR8000:FIBERHOME:isis:6:CRT_BFD_SESION_FAIL::ISIS [100] failed to create the BFD session with peer [1060.1602.6121] level-[2] on the interface. (Interface=[ten-gigabitethernet0/5/1/11.100]\n \n \n \n \n \n \n \n \n \n \n \n \n \n \n\n\n2021/3/29 16:24\nkern\ninfo\n<6>16:24:41, 29 March 2021:FH-CR8000:FIBERHOME:isis:6:MT_NBR_TLV_NULL:MT neighbor TLV to be created was NULL. (IsisProcessId=[100])\n \n \n \n \n \n \n \n \n \n \n \n \n \n \n\n\n2021/3/29 16:24\nkern\ninfo\n<6>16:24:36, 29 March 2021:FH-CR8000:FIBERHOME:isis:6:BFD_SESSION_ADD_SEND:The session_id of ISIS session_add message: session_id (Peer_address=[106.16.27.222], peer_address_length =[4],Source_addresss=[106.16.27.221], Source_address_length =[4],if_name=[ten-gigabitethernet0/5/1/11.100], vrf_id=[0]\n \n \n \n \n \n \n \n \n \n \n \n \n \n \n\n\n2021/3/29 16:24\nkern\ninfo\n<6>16:24:36, 29 March 2021:FH-CR8000:FIBERHOME:isis:6:CRT_BFD_SESION_FAIL::ISIS [100] failed to create the BFD session with peer [1060.1602.6121] level-[2] on the interface. (Interface=[ten-gigabitethernet0/5/1/11.100]\n \n \n \n \n \n \n \n \n \n \n \n \n \n \n\n\n2021/3/29 16:24\nkern\ninfo\n<6>16:24:28, 29 March 2021:FH-CR8000:FIBERHOME:isis:6:BFD_SESSION_ADD_SEND:The session_id of ISIS session_add message: session_id (Peer_address=[106.16.27.222], peer_address_length =[4],Source_addresss=[106.16.27.221], Source_address_length =[4],if_name=[ten-gigabitethernet0/5/1/11.100], vrf_id=[0]\n \n \n \n \n\n\n", "input": "", "output": "案例主题:电信网络ER开启ISIS多拓扑导致8000设备频繁上报syslog告警\n案例编号:AL2021070514491\n网络场景:电信IPRAN标准组网，B与ER口字型组网。\n现象描述:某电信IPRAN网络，8000 B设备配置syslog后，综合网管收到了B设备info级别的syslog打印：横联ISIS BFD无法创建。\n综合网管收到的log信息一天有几百页的打印。\n \n\n\n\n\n\n产生时间\n设备\n等级\n消息\n \n \n \n \n \n \n \n \n \n \n \n \n \n \n\n\n2021/3/29 16:24\nkern\ninfo\n<6>16:24:54, 29 March 2021:FH-CR8000:FIBERHOME:isis:6:BFD_SESSION_ADD_SEND:The session_id of ISIS session_add message: session_id (Peer_address=[106.16.27.222], peer_address_length =[4],Source_addresss=[106.16.27.221], Source_address_length =[4],if_name=[ten-gigabitethernet0/5/1/11.100], vrf_id=[0]\n \n \n \n \n \n \n \n \n \n \n \n \n \n \n\n\n2021/3/29 16:24\nkern\ninfo\n<6>16:24:54, 29 March 2021:FH-CR8000:FIBERHOME:isis:6:CRT_BFD_SESION_FAIL::ISIS [100] failed to create the BFD session with peer [1060.1602.6121] level-[2] on the interface. (Interface=[ten-gigabitethernet0/5/1/11.100]\n \n \n \n \n \n \n \n \n \n \n \n \n \n \n\n\n2021/3/29 16:24\nkern\ninfo\n<6>16:24:46, 29 March 2021:FH-CR8000:FIBERHOME:isis:6:BFD_SESSION_ADD_SEND:The session_id of ISIS session_add message: session_id (Peer_address=[106.16.27.222], peer_address_length =[4],Source_addresss=[106.16.27.221], Source_address_length =[4],if_name=[ten-gigabitethernet0/5/1/11.100], vrf_id=[0]\n \n \n \n \n \n \n \n \n \n \n \n \n \n \n\n\n2021/3/29 16:24\nkern\ninfo\n<6>16:24:46, 29 March 2021:FH-CR8000:FIBERHOME:isis:6:CRT_BFD_SESION_FAIL::ISIS [100] failed to create the BFD session with peer [1060.1602.6121] level-[2] on the interface. (Interface=[ten-gigabitethernet0/5/1/11.100]\n \n \n \n \n \n \n \n \n \n \n \n \n \n \n\n\n2021/3/29 16:24\nkern\ninfo\n<6>16:24:41, 29 March 2021:FH-CR8000:FIBERHOME:isis:6:MT_NBR_TLV_NULL:MT neighbor TLV to be created was NULL. (IsisProcessId=[100])\n \n \n \n \n \n \n \n \n \n \n \n \n \n \n\n\n2021/3/29 16:24\nkern\ninfo\n<6>16:24:36, 29 March 2021:FH-CR8000:FIBERHOME:isis:6:BFD_SESSION_ADD_SEND:The session_id of ISIS session_add message: session_id (Peer_address=[106.16.27.222], peer_address_length =[4],Source_addresss=[106.16.27.221], Source_address_length =[4],if_name=[ten-gigabitethernet0/5/1/11.100], vrf_id=[0]\n \n \n \n \n \n \n \n \n \n \n \n \n \n \n\n\n2021/3/29 16:24\nkern\ninfo\n<6>16:24:36, 29 March 2021:FH-CR8000:FIBERHOME:isis:6:CRT_BFD_SESION_FAIL::ISIS [100] failed to create the BFD session with peer [1060.1602.6121] level-[2] on the interface. (Interface=[ten-gigabitethernet0/5/1/11.100]\n \n \n \n \n \n \n \n \n \n \n \n \n \n \n\n\n2021/3/29 16:24\nkern\ninfo\n<6>16:24:28, 29 March 2021:FH-CR8000:FIBERHOME:isis:6:BFD_SESSION_ADD_SEND:The session_id of ISIS session_add message: session_id (Peer_address=[106.16.27.222], peer_address_length =[4],Source_addresss=[106.16.27.221], Source_address_length =[4],if_name=[ten-gigabitethernet0/5/1/11.100], vrf_id=[0]\n \n \n \n \n\n\n\n处理过程:1、查找相关资料，未见相关说明；\n2、联系研发处理，答复为B设备上面的ER开启了ISIS多拓扑，这是5G网络的东西，现网R8000不支持ISIS多拓扑，所以ISIS对应不上并上报告警，对现网无影响，可以忽略。\n根因:ER开启了ISIS多拓扑，现网R8000不支持ISIS多拓扑，所以ISIS对应不上并上报告警，对现网无影响，可以忽略。\n解决方案:修改ISIS告警级别高于info即可。\r\n \n原因分类:无\n"}
{"instruction": "某运营商OSS基站管理路由同时引入2/3/4G vrf且匹配多个RT值的案例。1.我司R8000-10设备与HUAWEI对接并接入BBIP核心网；\n2.R8000-10创建多个前缀列表分别匹配从核心网发送的2G\\3G\\4G核心路由；\n3.与华为建立BGP-peer时在入方向引入route-map匹配peimit 2G\\3G\\4G核心路由；\n4.在2G\\3G\\4G核心前缀列表中分别peimit OSS核心路由，发现只有2G vrf中成功引入OSS核心路由(10.216.224.0/24)，3G/4G vrf中无此路由；原前缀列表以及route-map如下：\nip prefix-list VPN_2G_BSC seq 5 permit 10.243.49.128/27\r\nip prefix-list VPN_2G_BSC seq 10 permit 10.243.49.160/27\r\nip prefix-list VPN_2G_BSC seq 15 permit 10.105.17.192/26\nip prefix-list VPN_2G_BSC seq 20 permit 10.216.224.0/24\r\nip prefix-list VPN_3G_RNC seq 5 permit 0.0.0.0/0\r\nip prefix-list VPN_3G_RNC seq 10 permit 10.243.48.128/27\r\nip prefix-list VPN_3G_RNC seq 15 permit 10.243.48.160/27\r\nip prefix-list VPN_3G_RNC seq 20 permit 10.229.128.128/26\nip prefix-list VPN_3G_RNC seq 25 permit 10.216.224.0/26\r\nip prefix-list VPN_4G_EPC seq 10 permit 189.40.170.0/27 le 32\r\nip prefix-list VPN_4G_EPC seq 15 permit 189.40.170.33/32\r\nip prefix-list VPN_4G_EPC seq 20 permit 189.40.117.0/24 le 32\r\nip prefix-list VPN_4G_EPC seq 25 permit 189.40.118.0/24 le 32\r\nip prefix-list VPN_4G_EPC seq 30 permit 189.40.113.0/24 le 3\nip prefix-list VPN_4G_EPC seq 35 permit 10.216.224.0/26\n！\nroute-map FROM_HUAWEI permit 5\r\n match ip address VPN_2G_BSC\r\n set ext-community rt 65450:39899\n！\nroute-map FROM_HUAWEI permit 7\r\n match ip address VPN_3G_RNC\r\n set ext-community rt 65450:19899\r\n!\r\nroute-map FROM_HUAWEI permit 10\r\n match ip address VPN_4G_EPC\r\n set ext-community rt 65450:29899\n ", "input": "", "output": "案例主题:某运营商OSS基站管理路由同时引入2/3/4G vrf且匹配多个RT值的案例\n案例编号:AL2021042313681\n网络场景:我司R8000-10与华为对接，R8000-10为路由反射器\r\n \n\n现象描述:1.我司R8000-10设备与HUAWEI对接并接入BBIP核心网；\n2.R8000-10创建多个前缀列表分别匹配从核心网发送的2G\\3G\\4G核心路由；\n3.与华为建立BGP-peer时在入方向引入route-map匹配peimit 2G\\3G\\4G核心路由；\n4.在2G\\3G\\4G核心前缀列表中分别peimit OSS核心路由，发现只有2G vrf中成功引入OSS核心路由(10.216.224.0/24)，3G/4G vrf中无此路由；原前缀列表以及route-map如下：\nip prefix-list VPN_2G_BSC seq 5 permit 10.243.49.128/27\r\nip prefix-list VPN_2G_BSC seq 10 permit 10.243.49.160/27\r\nip prefix-list VPN_2G_BSC seq 15 permit 10.105.17.192/26\nip prefix-list VPN_2G_BSC seq 20 permit 10.216.224.0/24\r\nip prefix-list VPN_3G_RNC seq 5 permit 0.0.0.0/0\r\nip prefix-list VPN_3G_RNC seq 10 permit 10.243.48.128/27\r\nip prefix-list VPN_3G_RNC seq 15 permit 10.243.48.160/27\r\nip prefix-list VPN_3G_RNC seq 20 permit 10.229.128.128/26\nip prefix-list VPN_3G_RNC seq 25 permit 10.216.224.0/26\r\nip prefix-list VPN_4G_EPC seq 10 permit 189.40.170.0/27 le 32\r\nip prefix-list VPN_4G_EPC seq 15 permit 189.40.170.33/32\r\nip prefix-list VPN_4G_EPC seq 20 permit 189.40.117.0/24 le 32\r\nip prefix-list VPN_4G_EPC seq 25 permit 189.40.118.0/24 le 32\r\nip prefix-list VPN_4G_EPC seq 30 permit 189.40.113.0/24 le 3\nip prefix-list VPN_4G_EPC seq 35 permit 10.216.224.0/26\n！\nroute-map FROM_HUAWEI permit 5\r\n match ip address VPN_2G_BSC\r\n set ext-community rt 65450:39899\n！\nroute-map FROM_HUAWEI permit 7\r\n match ip address VPN_3G_RNC\r\n set ext-community rt 65450:19899\r\n!\r\nroute-map FROM_HUAWEI permit 10\r\n match ip address VPN_4G_EPC\r\n set ext-community rt 65450:29899\n \n处理过程:参考友商NOKIA配置，如下：\n\nConfigurações no Nokia como Exemplo:\n\n \nFNS-SSA01-NKI01CO#\n        policy-options\n            begin\n            prefix-list \"OSS_ACESSO\"\n               prefix 10.220.30.0/25 prefix-length-range 25-32\n            exit\n \npolicy-statement \"IMPORT_IAS_SERVICO\"\n                entry 27\n                    from\n                        prefix-list \"OSS_ACESSO\"\n                    exit\n                    action accept\n                        community replace \"VPN_3G_CORE\" \"VPN_4G_CORE\" “VPN_2G_CORE”\n                    exit\n                exit\n根因:查阅前缀列表和route-map匹配规则，发现route-map被调用后，匹配动作将会从最小的序列号开始执行，如果该序列号中的条件都被匹配了则执行set命令，如果条件不匹配，则切换到下一个序列号继续进行匹配动作;本案例中原route-map FROM_HUAWEI permit 5被调用，将OSS核心路由10.216.224.0/24匹配set ext-community rt 65450:39899，但引入另外两个vrf中时又将该路由打上其他rt值\n解决方案:1.放弃在各前缀列表分别匹配、分别引入的不同vrf的思路；新建prefix-list OSS_ACESSO peimit 10.216.224.0/24，并创建route-map FROM_HUAWEI permit 3 同时set 多个rt值；\r\nno ip prefix-list VPN_2G_BSC seq 20 permit 10.216.224.0/24\r\nno ip prefix-list VPN_4G_EPC seq 145 permit 10.216.224.0/24\nip prefix-list OSS_ACESSO seq 5 permit 10.216.224.0/24\n \nroute-map FROM_HUAWEI permit 3\r\n  match ip address OSS_ACESSO\r\n  set ext-communit rt 65450:19899 65450:39899 65450:2989\n2.配置后问题解决，效果如下：\n\n原因分类:无\n"}
{"instruction": "某网络规划网元采用loopback单IP上管。1.设备较分散和偏远，需经友商网络三层路由至网管服务器和运营商监控平台，无法使用我司网管写SN方式开通；\n2.设备只分配了一个loopback IP和其他端口 IP，且需loopback ip为设备管理IP和业务终端IP；\n \n ", "input": "", "output": "案例主题:某网络规划网元采用loopback单IP上管\n案例编号:AL2021042313691\n网络场景:设备与友商IGP（OSPF）互联，采用公网路由单IP 、loopback上管\r\n \n\n现象描述:1.设备较分散和偏远，需经友商网络三层路由至网管服务器和运营商监控平台，无法使用我司网管写SN方式开通；\n2.设备只分配了一个loopback IP和其他端口 IP，且需loopback ip为设备管理IP和业务终端IP；\n \n \n处理过程:1.首站需现场配置好公网协议以及端口IP；与友商对接后确认我司设备能收到网管路由；\n2.R8000-10需手动开启dcn或pdcn并配置私网VRF；R800进入config模式后enable dcn（通常默认开启）；\n3.下挂其他站点与首站会自动建立私网DCN连接，可从首站转登录至下挂站点进行公网配置；\n \n根因:受限应用场景\r\n \n解决方案:1.对于R8000设备loopback上网管，需要完成如下配置的修改：\n    nmu source-vpn public ip 167.68.1.1 （ip地址是局方分配loopback ip）   ##该配置默认是私网，需根据工位loopback ip地址进行修改，将原配置no掉然后新增该配置；\n2.对于R800设备loopback上网管方法：\n  1.）在loopback 0中使能单IP上网管功能，如下：\n       interface loopback0\n         ip address 180.18.1.201/32\r\n         dcn ip enable    ##使能该接口单IP上网管功能\r\n         no shutdown\r\n         commit\n   2.）在R835E中转登录到操作系统，并登陆6111的NMU进程，修改R835E上网管用的开关key 1和key 2：\n        Ag1#fos enable    ###  该命令可以转登录到操作系统\n\r\n        Linux 2.6.34.15-rt-WR4.3.0.0_preempt_rt (R835E-2) (08:43 on Wednesday, 13 March 2019)\n\r\n        login: root\n        Password:     ###用户名和密码为root/root\n        Last login: Wed Mar 13 08:34:02 from localhost\n\r\n        Wind River Linux glibc_cgl (cgl) 4.3\n \r\n        root@R835E-2:/root/> telnet 127.1 6111     ####该命令登陆NMU进程，用户名和密码为fiberhome/fiberhome\n        Trying 127.0.0.1...\n        Connected to 127.1.\n        Escape character is '^]'.\n\r\n        VnppOS version 7.8.3 for CiTRANS devices VnppRouter Mar 29 2018 15:23:59\n\r\n        User Access Verification\n\r\n        Username: fiberhome\n        Password:\n        fiberhome#\n        fiberhome#agent dump-my-idip     ####该命令查看本站的SN号\n        My SN Information: \n        ------------------------\n        SN: 123450987611               ####该设备的SN号\n        SN length: 12\n        Device Type:0 ID1:1 ID2:203 Area Flag:0x80    ####ID1和ID2是当前的key1和key2值\n        fiberhome#agent idip-set sn 123450987611 key1 121 key2 112 default-area-flag 1 area-type 1 ip-address 180.18.1.1 mask 255.255.255.255 priority 1   ####配置设备的key1和key2值，IP地址可以随便设置即可，实际上网管使用的是loopback0的地址；\n      3.）在网管上添加R835E网元，注意网元IP为R835E的loopback 0地址，并一定确保key1和key2值的准确，完成设备上网管；\n原因分类:无\n"}
{"instruction": "OLT下搜索不到新增ONU问题排查始末。    某运营商GPON业务，通过app远程开通，系统对接第三方连到UNM2000网管TL1接口，通过TL1指令的LST-UNREGONU查找ONU再授权白名单做数据。某日，发现app无法发现新ONU设备，无法开通，后在UNM2000网管主界面的未授权ONU列表中搜不到设备，再测试单独搜索OLT线卡则可以搜到ONU，但仍无法写入主控白名单。此举影响整个流程，影响新装机，用户报障。", "input": "", "output": "案例主题:OLT下搜索不到新增ONU问题排查始末\n案例编号:AL202201052001\n网络场景:\n现象描述:    某运营商GPON业务，通过app远程开通，系统对接第三方连到UNM2000网管TL1接口，通过TL1指令的LST-UNREGONU查找ONU再授权白名单做数据。某日，发现app无法发现新ONU设备，无法开通，后在UNM2000网管主界面的未授权ONU列表中搜不到设备，再测试单独搜索OLT线卡则可以搜到ONU，但仍无法写入主控白名单。此举影响整个流程，影响新装机，用户报障。\n处理过程:1、收到问题报障。流程复盘，用户通过app远程开通，对接第三方系统，第三方系统再对接UNM2000网管TL1接口，通过TL1指令LST-UNREGONU查询，正常流程可以查询到发现ONU并授权白名单做数据开通。但此处出现无法查询到该OLT下该PON口的新增未授权ONU。\n\n \n2、通过接口测试其它OLT网元同样该指令LST-UNREGONU查询，发现正常，确认网管TL1接口不存在问题，排除该疑点。\n\n \n3、怀疑该异厂家ONU上报能力特殊，通过查看能力命令查看该ONU上报能力：\n\n查看发现，为4LAN口、1语音，有pptp和veip上报，是正常的GPON HGU设备上报。\n \n4、继续查看GPON线卡和HSWA主控盘发现表的老化时间，发现均为正常老化时间：\n\n \n5、开始怀疑PON口光模块、PON芯片等问题，但是通过GCOB线卡命令行查看，能发现ONU在未授权表，Info_Ready状态，替换光模块、线卡PON口，以及将ONU挂至其它线卡下均能发现该ONU，也是Info_Ready状态，但始终在主控盘unauth表中看不到。\n\n再进入主控盘，查看未授权onu依旧无法看到，无论哪块线卡PON口有未授权的ONU发现，在主控下查看未授权发现表均无ONU发现，如此显示：\n\n \n6、开启主控盘打印，查看ONU授权类打印。set debug debug10 onu_auth print enable log disable，发现有ONU发现的打印信息如下：\n[S37019291][T:-155362119][M60][PD10]handle_Onu_AuthMsg_sp_PT201902012359: ret = -504. \r\n[S37019300][T:-155361831][M60][PD10]send_AuthMsg_NewOnu: check_If_OnuReplace: ret = -503. \r\n[S37019301][T:-155361831][M60][PD10]onuauth_DmAPI_Func: cmdID 0x198, ret = 0. \r\n[S37019302][T:-155361831][M60][PD10]handle_Onu_AuthMsg_sp_PT201902012359: msgType(5), obj(13-3), onuType(762), ponType(712) \r\n[S37019303][T:-155361831][M60][PD10]handle_Onu_AuthMsg_sp_PT201902012359: physn(CMDCa448fad5), phypwd(), logsn(), regid() \r\n[S37019304][T:-155361831][M60][PD10]authen_NewOnu_by_Physn: ret = -503. \r\n[S37019305][T:-155361831][M60][PD10]authen_NewOnu_by_Phypwd: ret = -504. \r\n[S37019306][T:-155361831][M60][PD10]send_OnuAuth_Alarm: alarmType 77, action 1 \r\n[S37019307][T:-155361830][M60][PD10]send_OnuAuth_Alarm: ret 0 \n发现有物理地址白名单未认证的打印：authen_NewOnu_by_Physn: ret = -503. \n以及物理密码相关的打印：authen_NewOnu_by_Phypwd: ret = -504. \n由此怀疑与物理密码设置有关，查看pon认证模式，物理标识/逻辑标识(不含密码)/密码混合认证，没有错误：\n\n \n7、进一步怀疑其它PON认证设置，通过命令行查看白名单冲突范围，show whitelist conflict-range，终于发现问题，如下：\n\n等于物理密码要求在pon内唯一，而实际上所有设备都没有设置物理密码，为空，故新发现ONU也为空物理密码，被主控判断物理密码PON内重复，故ONU无法上线。\n \n8、通过onu目录下，设置set whitelist password conflict-range olt命令，将物理密码由pon内唯一改为olt内唯一，即PON内物理密码相同不冲突，之后未授权表立即发现了ONU，可以正常授权动作了，问题解决。\n根因:1、由于物理密码要求在pon内唯一，而实际上所有设备都没有设置物理密码，均为空，故新发现ONU也为空物理密码，被主控判断物理密码PON内重复，故ONU无法上线。需要将whitelist password is unique in PON更改为whitelist password is unique in OLT。\n2、如whitelist logic-id is unique in OLT，表示在整个OLT内要求唯一的逻辑SN id，不可重复；如whitelist logic-id is unique in PON，表示在整个OLT内不要求逻辑SN id唯一，不同线卡不同PON口均可重复出现白名单（实际物理上线时），在同一PON内不允许重复出现。\n \n如下图所示，当设置为logic-id is unique in PON时，可以实现不同PON口使用相同逻辑SN，同PON内不能重复：\n\n解决方案:onu目录，将password认证由pon内唯一改为olt唯一，pon内不冲突检测，即通过命令 set whitelist password conflict-range olt 设置。\n原因分类:无\n"}
{"instruction": "RAID卡无法识别或BMC界面无法组建RAID。1、BIOS界面无法识别RAID卡\n2、BMC Web界面无法识别RAID卡或无法组建RAID\n \n ", "input": "", "output": "案例主题:RAID卡无法识别或BMC界面无法组建RAID\n案例编号:AL202112211621\n网络场景:无\n现象描述:1、BIOS界面无法识别RAID卡\n2、BMC Web界面无法识别RAID卡或无法组建RAID\n \n \n处理过程:1. BIOS 界面无法识别 RAID卡 \n1) 准备工作： \r\na.  在排查之前记录 BIOS，BMC，及“问题”出现之前，做了哪些操作，有无提示性信息或报错信息（截图或拍照）； \r\nb. 记录问题相关FW 版本（包括 RAID卡，BIOS，BMC，背板  FW），登录BMC WEB界面导出BMC日志。\n2) 排查步骤： \r\na.  在不断电的情况下，登录BMC WEB界面，查看  BMC SEL是否有PCI或RAID 卡的相关报错信息，及查看硬件“清单”是否能识别到 RAID卡和Riser 卡及HDD等信息（理论上，BIOS中识别不到RAID卡，在 BMC WEB中也无法识别）； \r\n如图所示： \n\n \nb.  在完成步骤a检查之后，导出BMC日志，给研发人员分析。BMC WEB主页-快捷操作-服务，点击“服务”进行下载。如图所示： \n \n\n \nc.  在可以关机断电的情况下，检查 RAID 卡和硬盘背板的连接线缆是否有松动；在无松动的基础上，检查 RAID卡与Riser卡的安装情况；以上可以做线缆的重新插拔，RAID卡重新安装，Riser卡的重新安装; \n \n\n \nd.  将 RAID 卡安装在 Riser 卡上的另一个槽位上，查看是否可以识别；如操作无效，尝试 PCI 设备最小化，移除其它外接卡，只保留 Riser 卡和 RAID 卡，再上电，查看识别情况。如果依然无法识别，将RAID卡直接安装在主板的PCIE槽位上（排查是否由Riser 卡设备导致的问题） \n\r\ne.  在完成以上信息记录、检查、操作之后，假如故障依然存在，联系二线或三线人员。 \n \n2.  BMC WEB 界面无法识别RAID 卡或无法组建 RAID   \n1）准备工作: \r\n参见问题1 的准备工作 \r\n2）排查步骤： \r\na. 登录 BMC WEB 界面，查看硬件“清单”中 PCI 或其他硬件，是否能识别到 RAID卡，Riser卡；如没有显示设备，尝试右击 BMC web页面“重新加载”和重启 BMC, 如依然无法识别，请进入 BIOS配置界面-System Settings-Storage查看RAID卡是否可以正常识别，如果还是无法识别，参见问题1; \nb．查看硬盘的状态是否是 UG状态（Unconfigured Good），如果硬盘的状态非 UG状态，在BMC WEB 界面是无法组建RAID的（会提示“请稍等，正在初始化 RAID适配器”）, 非UG状态的硬盘，在BIOS 界面也是无法组建 RAID的; \r\n需要进入BIOS 配置界面，进行修改， 具体步骤如下（b.1 - b.4）： \r\nb.1 开机进入BIOS 配置界面-System Settings-Storage-选择 RAID卡-Main Menu-Drive Management，如图所示： \n\nb.2 查看硬盘的状态，如果硬盘非 UG 状态，是不能组建 RAID 的，需要手动进行修改，如图所示，此硬盘的状态是（Foreign）Configuration good，如图所示： \n\nb.3 如果此硬盘没有数据，可以清除，如存在数据可以进行导入操作，选择Configuration Management-Manage Foreign Configuration（导入配置）；Clear Configuration （清除外来配置）；如图所示： \n\n \nb.4 如查看的硬盘状态是Ubad（Unconfigured Bad），可以选中硬盘-回车，将硬盘设置为Unconfigured Good,如图所示： \n \n\n再次查看物理硬盘（Drive Management）状态，为 Foreign；返回主菜单，进入Configutation Management 界面，选择Manage Foreign Configuration,进行导入配置或是清除外来配置。 \r\nc. BMC WEB 中无法识别或组建 RAID，但是在 BIOS 界面可以识别，组建 RAID；说明RAD卡及相关的硬件没有问题。 \n \n# 如有 OS 操作使用权限可以在系统下安装 storcli package(安装完的默认路径是：/opt/MeagRAID/storcli，执行storcli命令也需要在此路径下操作)，使用storcli命令进行组建RAID； \r\nstorcli64 /cx  add  RAID r0|1|5|6|10|50|60 Size=,,..|*all name=,drives=e:s|e:s-x|e:s-x,y;e:s-x,y,z \r\n例如: storcli64 /c0 add RAID r1 size=all name=test drives=65:0,65:1 \n \nd. 当重新加载页面或重启BMC之后，RAID卡依然无法识别在 BMC WEB界面。 在条件许可的情况下，将机器关机，断电（将电源线缆拔出），等1分钟左右，再接上电源线缆，再开机。（目的:让BMC重新加载服务器的硬件设备） \n\r\ne. 如重新机器断电在上电重新加载完硬件设备，在 BMC WEB 界面依然无法识别 RAID卡，请联系研发人员确认是否有新的BMC固件，以及获取更进一步的技术支持。 \n根因:无\n解决方案:按上述步骤排查。\n原因分类:无\n"}
{"instruction": "PON网络关于OLT主控切换过程中语音中断的技术案例。【现象描述】\n某本地PON网络，某站点在验收过程中，进行主控切换，切换之前进行语音通话，当发起切换命令（force switch）之后，通话双方听不见对方声音，等待约2分钟,语音恢复正常，可以正常通话，着急设备验收急需解决该问题。", "input": "", "output": "案例主题:PON网络关于OLT主控切换过程中语音中断的技术案例\n案例编号:AL202112131411\n网络场景:网络拓扑如下：\n \n\n现象描述:【现象描述】\n某本地PON网络，某站点在验收过程中，进行主控切换，切换之前进行语音通话，当发起切换命令（force switch）之后，通话双方听不见对方声音，等待约2分钟,语音恢复正常，可以正常通话，着急设备验收急需解决该问题。\n处理过程:1.检查OLT的基础配置，该站点采用短定时和LACP+trunk的配置模式，信息如下：\nRAB-1156-HayErrahma-F2-1\\interface# show trunk all\r\n------------------------------\r\n          Trunk-id  1\r\n------------------------------\r\nMembers list     : 19:3(up)  20:3(down)  \r\nMaster port      : 19:3\r\nTrunk mode       : LACP\r\nLoad balance mode: src-dst-mac\n\r\nRAB-1156-HayErrahma-F2-1\\protocol\\lacp# show lacp channel-group trunks\nLACP GROUP state information is:\r\nGroup Id: 1                      Mode: LACP\r\nSystem Priority: 50000               System ID: 48f9-7ceb-1b01\r\nPriority Preemption: disable\r\n--------------------------------------------------------------------------------\r\nActorPortName          Status     PortPri PortKey PortState\r\n19:3                   select     32768   1       0x3f\r\n20:3                   Unselect   32768   1       0x4f\r\n--------------------------------------------------------------------------------\r\nActorPortName        SysPri   SystemID          PortPri  PortNo  PortKey  PortState\r\n19:3                 32768    0000-0000-0005    32768    2       1585     0x3d\r\n20:3                 0        0000-0000-0000    0        0       0        0x2\r\n \n2. 语音采用单层vlan，使用sip协议，语音通过DHCP方式获取IP地址，信息如下：\n\n\n\n4、对该站点的主控盘进行槽位互换、主控盘更换、上联盘端口更换、软件版本更换至2019年Q2（现网OLT版本是2021T1），都无法解决该问题，语音依旧会在主控切换过程中中断约2分钟左右。\n5.进行镜像配置，镜像配置过程中需要注意：常规配置镜像在主用主控盘，主控切换之后镜像配置会丢失，上联口会up和down一下， 所以抓不到切换之后的报文。需要在备用主控盘配置镜像，要抓备盘切换为主盘后的报文，等切换后电脑端口up后开始抓包，有2~3分钟的时间，就有时间进行抓包。镜像命令如下：\nRAB-1156-HayErrahma-F2-1(DEBUG_H)\\switch> set mirror mode port_mode\nRAB-1156-HayErrahma-F2-1\\maintenance\\mirror# set mirror source trunk 1 destination port 19:4 direction 0\n说明：串口线连接主用主控盘csonsle口进行切换命令下发（force switch），完成之后，迅速连接至备用主控盘的consle口，同时网口连接OLT上联镜像端口用wirshake启动抓包。\n \n6.获取到报文发现，主控切换过程中，OLT上联口持续向上层设备发送请求报文，但是未收到上层IMS平台设备的回应，信息如下：\nONT mac 地址：FC-A6-CD-5F-A3-C9;\nONT IP 地址: 10.20.196.2;\nIP地址（DHCP服务器）:10.112.1.61;\n\n根因:OLT上联口持续向上层设备发送请求报文，但是未收到上层IMS平台设备的回应。\n怀疑和上层交换机对LACP的处理方式有关，通过报文排除我司设备的问题。\n解决方案:怀疑和上层交换机对LACP的处理方式有关，通过报文排除我司设备的问题。该问题在验收和维护过程中，通过配置镜像抓包方式和LACP+TRUNK配置方式的类似问题有指导意义。\n原因分类:无\n"}
{"instruction": "某网络工程下行大量异常报文导致摄像监控业务不通的案例--通过QoS规则规避。某网络监控工程，平时会随机出现部分摄像头取不到画面、摄像头无法上线到监控平台的问题，摄像头时常不通问题。", "input": "", "output": "案例主题:某网络工程下行大量异常报文导致摄像监控业务不通的案例--通过QoS规则规避\n案例编号:AL20211115932\n网络场景:\nOLT：AN5516-01(HSWA、GCOB)，RP01200（2018T2SP2）\nONU：AN5121-4G（RP0104）\nAN5121-4G下挂分别1~3部数量不等的摄像头监控，图形回传，途径OLT--Cisco交换机--9306交换机--OTN网络--视频网存储平台。\n现象描述:某网络监控工程，平时会随机出现部分摄像头取不到画面、摄像头无法上线到监控平台的问题，摄像头时常不通问题。\n处理过程:1、通过远程到监控平台，PING测摄像头，发现不少摄像头始终不能ping通，ping测超时无法学习到摄像头ARP条目；同时有部分随机能上线，有部分又随机下线无法ping通；现象比较随机。\n2、在OLT上开启Super-Vlan三层接口，配置了同摄像头VLAN和网段的地址，进入3000接口分别往NNI平台、UNI侧摄像头ping测，结果ping测PON以下摄像头的现象与第1点在监控平台测试时一致，而往上层ping测平台正常。\n3、怀疑环路或广播风暴导致异常，将OLT ld_macmv环回检测功能开启，发现大量摄像头地址和智能管理前端地址在网络上漂移，且 MAINBOARD MAC MOVE LIST 和 SLOT MAC MOVE LIST 都存在大量地址漂移条目，条目有近百条，且均为AN5121-4G下摄像头地址（通过前面OUI厂商9c-14-63地址查询获知）和智能管理前端地址（通过前面OUI厂商00-19-ad地址查询获知） 。\n4、仅通过现象，在上联Trunk1和UNI侧11槽均发现这些同类终端地址，存在NNI和UNI侧环回两种可能，检查ld_macmv设置，当前为pri：nni higher than uni，Pon-inside：使能。将其更改为pri：uni higher than nni，Pon-inside：去使能，发现漂移表发生变化，则漂移地址全部出现在主控交换端。\n5、赴OLT上联口抓取相关下行报文，结果镜像Trunk1口发现，抓到从上层交换机大量下行arp广播报文，且源地址均为OLT下的摄像头和智能管理前端设备地址，并且有不带VLAN id和带监控VLAN id重复发送的arp广播报文。\n6、通知上层交换机端排查环回，释放掉下行大量广播报文，但交换机维护人员拒不承认环回，但事实摆在当前，为紧急解决出现的故障，被迫使用QoS手段先丢弃掉这些在监控VLAN中泛洪的终端arp广播包。使用QoS流规则：以太网类型为0x0806（2054），源mac地址数值加掩码匹配00-19-ad-00-00-00；流策略：禁止，匹配的规则丢弃，其它流通过；绑定上联口即可。\n7、QoS生效后，再实测发现摄像头均能长ping不掉线，业务恢复正常。\n根因:故障根因：\n    ONU下挂摄像头和智能管理前端会发送ARP广播报文，这些报文通过视频监控VLAN到达上层交换机后，被环回再次广播到视频监控VLAN和不带802.1Q报文的广播通道中，这些泛洪的报文造成大量冲击进入AN5121-4G和摄像头，造成监控业务中断。\n    当风暴震荡随机减弱时，摄像头再次上线，又由于ld_macmv设置pon-inside监控使能，且nni优先级大于uni优先级，则GPON线卡learning mode被设置为normal模式，故发现相同mac以不同gemport上报误判断为UNI侧环回。当ld_macmv再设置为uni优先级大于nni优先级后，得出正确判断终端侧地址漂移是上层NNI环回造成。\n \nOLT上联口镜像抓取的下行报文，从上层环回下来的以摄像头、智能管理前端为源MAC地址的泛洪广播报文：\n\n \n引申知识点：\n1、关于ld_macmv设置，有时需要匹配相对应的环回场景，才能得到正确的预期结果。\r\n  1>.如果是上层环回：set ld_macmv enable pkt drop pri uni alarm enable pon-inside disable，环回漂移地址条目会在MAINBOARD MAC MOVE LIST中出现，漂移MAC一般为UNI终端MAC。\r\n  2>.如果是ONU侧环回--  set ld_macmv enable pkt drop pri nni alarm enable pon-inside enable，环回漂移地址条目会在SLOT MAC MOVE LIST中出现，漂移MAC一般为上层交换或Bras MAC。\n2、起初PON-Inside设置环回检测，SLOT MAC MOVE LIST也出现了漂移，是因为开关打开后，通过线卡show iwf_obj命令知晓了线卡地址环回检测方式，查看learning mode，发现是normal模式，而改为move模式则正常。normal模式不允许gemport内MAC飘移（5121-4G终端侧受攻击后，gemport发生变化，normal模式检测相同mac通过不同gemport上报，认为环回）；而move模式允许gemport内MAC飘移（move模式允许相同mac通过不同gemport上报，不认为环回）。\n解决方案:1、临时方案：通过QoS规则，在HSWA主控侧丢弃从上层环回下来的以摄像头、智能管理前端为源MAC地址的泛洪广播报文。使用QoS流规则：以太网类型为0x0806（2054），源mac地址数值加掩码匹配00-19-ad-00-00-00；流策略：禁止，匹配的规则丢弃，其它流通过；绑定上联口即可。具体操作：\n流分类规则：\n\n流策略：\n\n再将以上流分类规则和流策略绑定到指定业务上联口（环回报文下来的上联口）。\n命令行：\nset flow_rule_profile 8 Dis_0019ad 2 0 value_mask 0019ad000000 ffffff000000 5 equal 2054 null \nset flow_policy_profile 6 name dis_0019_fp pri 1 acl enable forward disable \nset slot 20 port 2 attach 6 8\n \n2、最终解决方案：与客户沟通，解决上层交换的环回问题，消除除从上层环回下来的以摄像头、智能管理前端为源MAC地址的泛洪广播。\n原因分类:无\n"}
{"instruction": "设备底层show mas con zebos check后显示主备不同步。1.设备底层show mas configure-file zebos check后显示主备不同步；\n2.SRCQ2俩块主控盘工作正常且底层可以ping通登录", "input": "", "output": "案例主题:设备底层show mas con zebos check后显示主备不同步\n案例编号:AL202111231054\n网络场景:巴西某数通工程\n现象描述:1.设备底层show mas configure-file zebos check后显示主备不同步；\n2.SRCQ2俩块主控盘工作正常且底层可以ping通登录\n处理过程:1.首先show tne board检查单盘状态\nBSLA-ROD01-FHI01AG#show tne board\r\nAddr Board_type Board_name Status Config Service WaitList down_speed down_mid max_len report sta_num send_num timeout_num\r\n  3  0x3800302  XSK2       OK       0x0     0          0    High       50%     64K ignore        0        0        0\r\n  4  0x380066f  SRCQ2(M)   OK       0x0    60          0    High       50%     64K    yes        0        0        0\r\n  5  0x380066f  SRCQ2(S)   OK       0x0    60          0    High       50%     64K     no    15221        0        0\r\n  6  0x38003a3  MSQ1       OK       0x0     0          0    High       50%     64K ignore        0        0        0\r\n  8  0x3800302  XSK2       OK       0x0     0          0    High       50%     64K ignore        0        0        0\n单盘状态正常\n \n2.使用show mas configure-file zebos check检查同步状态\nBSLA-ROD01-FHI01AG#show mas configure-file zebos check\r\nZEBOS.CFG Info         Size            Last Modify Time            MD5 CheckSum\r\nRCU1                   8109            2021-11-16 09:37:49         25c4355c0f8f117f23cac4bd10ffe9f1    \r\nConclusion             Equal                                     No  Equal\n \n3.进入问题单盘 cd /dev/shm/nandsim/run/NMU/目录\ndu -sh*\nfiberhome@t104x-835e-4:/root>cd /dev/shm/nandsim/run/NMU/\r\nfiberhome@t104x-835e-4:/dev/shm/nandsim/run/NMU>du -sh *\r\n112K    AppSoftFeedDog\r\n0       BoardInfo\r\n192K    cabextract\r\n161M    driver.log\r\n4.0K    files.md5\r\n4.1M    libDBEPt1040.so\n \n4.driver.log日志过大，占用太多内存，对其进行删除\nrm driver.log\n5.删除完之后登录设备进行查看\nBSLA-ROD01-FHI01AG#show mas configure-file zebos check\r\nZEBOS.CFG Info         Size            Last Modify Time            MD5 CheckSum\r\nRCU1                   8109            2021-11-16 09:37:49         25c4355c0f8f117f23cac4bd10ffe9f1   \r\nRCU2                   8109            2021-11-16 09:37:48         25c4355c0f8f117f23cac4bd10ffe9f1   \r\nConclusion             Equal                                       Equal                        \n     \n备注：driver.log 每六秒一打印，如果长时间不断电运行，日积月累会导致driver.log日志过大，建议定期进行主备检查。\n6.如果删除driver.log日志内存还不够 ，再到如下目录进行检查操作\n情况一：清除syslog相关日志：\r\ncd /var/volatile/log/\r\n1.删除过大的系统日志文件：\r\nrm -rf syslog\r\nrm -rf daemon.log\r\n2.重启syslog服务：\r\nsystemctl stop syslog.socket\r\nsystemctl restart syslog.socket\n3，清除wtmp文件：\r\ncat /dev/null > /var/log/wtmp\n情况二：检查单盘目录下是否有较大core文件产生，如有可删除，释放内存\n如：\n\n\nrm core.24674\n \n根因:内存占用过大会导致主备同步不一致\nV3R4SP1，会对flash_cleaner.sh脚本进行优化，解决driver.log文件增长问题\n解决方案:清理不必要的log，释放内存\r\n \n原因分类:无\n"}
{"instruction": "电信IPRAN专线开通A-B-B-A模型（PW冗余+动态BFD+无用户VLAN）。参数规划：\n\n", "input": "", "output": "案例主题:电信IPRAN专线开通A-B-B-A模型（PW冗余+动态BFD+无用户VLAN）\n案例编号:AL202201112141\n网络场景:该模型只适用于不同B对的E-line业务\n采用PW冗余保护，动态BFD，无用户侧VLAN。\n\n\n现象描述:参数规划：\n\n\n处理过程:===============================================================================\nA-1设备配置：\n===============================================================================\nmpls l2-circuit PW10001-main-Eline 10001 1.1.1.1 control-word vccv cc-type 4 bfd bfd-cv-type 2 min-tx 50 min-rx 50 mul 3 lsp-ping-enable\nmpls l2-circuit PW10002-back-Eline 10002 2.2.2.2 control-word vccv cc-type 4 bfd bfd-cv-type 2 min-tx 50 min-rx 50 mul 3 lsp-ping-enable\n \nmpls vpws vpws PW10001-main-Eline 101\n vpws-vc PW10001-main-Eline\n vpws-vc PW10002-back-Eline\nexit\n \ninterface GE0/1/8\n switchport\n no shutdown\n duplex full\n mpls-l2-circuit PW10001-main-Eline ethernet\n mpls-l2-circuit PW10002-back-Eline ethernet secondary\n vc-mode revertive\n commit\nexit\n \n业务删除步骤：\ninterface GE0/1/8\nno mpls-l2-circuit PW10001-main-Eline ethernet\nno mpls-l2-circuit PW10002-back-Eline ethernet\nexit\nno mpls vpws vpws PW10001-main-Eline 101\nno mpls l2-circuit PW10001-main-Eline 10001 1.1.1.1\nno mpls l2-circuit PW10002-back-Eline 10002 2.2.2.2\n \n===============================================================================\nA-2设备配置：\n===============================================================================\nmpls l2-circuit PW10001-main-Eline 10001 3.3.3.3 control-word vccv cc-type 4 bfd bfd-cv-type 2 min-tx 50 min-rx 50 mul 3 lsp-ping-enable\nmpls l2-circuit PW10002-back-Eline 10002 4.4.4.4 control-word vccv cc-type 4 bfd bfd-cv-type 2 min-tx 50 min-rx 50 mul 3 lsp-ping-enable\n \nmpls vpws vpws PW10002-back-Eline 101\n vpws-vc PW10001-main-Eline\n vpws-vc PW10002-back-Eline\nexit\n \ninterface GE0/4/8\n switchport\n no shutdown\n duplex full\n mpls-l2-circuit PW10001-main-Eline ethernet\n mpls-l2-circuit PW10002-back-Eline ethernet secondary\n vc-mode revertive\n commit\nexit\n \n业务删除步骤：\ninterface GE0/4/8\nno mpls-l2-circuit PW10001-main-Eline ethernet\nno mpls-l2-circuit PW10002-back-Eline ethernet\nexit\nno mpls vpws vpws PW10002-back-Eline 101\nno mpls l2-circuit PW10001-main-Eline 10001 1.1.1.1\nno mpls l2-circuit PW10002-back-Eline 10002 2.2.2.2\n \n===============================================================================\nB-1设备配置：（LDP邻接到相同的地址只需配置一次）\n===============================================================================\nrouter ldp\n targeted-peer ipv4 3.3.3.3\n exit\nexit\n \nmpls ss-pw PW10001-main-to-A-1-Eline 10001 5.5.5.5 control-word\nmpls ss-pw PW10001-main-to-B-3-Eline 10001 3.3.3.3 control-word\n \nmpls ms-pw PW10001-main-Eline PW10001-main-to-A-1-Eline PW10001-main-to-B-3-Eline \n \n业务删除步骤：\nno mpls l2-circuit PW10001-main-to-A-1-Eline \nno mpls l2-circuit PW10001-main-to-B-3-Eline \nno mpls ms-pw PW10001-main-Eline\n \n===============================================================================\nB-2设备配置：（LDP邻接到相同的地址只需配置一次）\n===============================================================================\nrouter ldp\n targeted-peer ipv4 4.4.4.4\n exit\nexit\n \nmpls ss-pw PW10002-back-to-A-1-Eline 10002 5.5.5.5 control-word\nmpls ss-pw PW10002-back-to-B-4-Eline 10002 4.4.4.4 control-word\n \nmpls ms-pw PW10002-back-Eline PW100012-back-to-A-1-Eline PW10002-back-to-B-4-Eline \n \n业务删除步骤：\nno mpls l2-circuit PW10002-back-to-A-1-Eline \nno mpls l2-circuit PW10002-back-to-B-4-Eline \nno mpls ms-pw PW10002-back-Eline\n \n===============================================================================\nB-3设备配置：（LDP邻接到相同的地址只需配置一次）\n===============================================================================\nrouter ldp\n targeted-peer ipv4 1.1.1.1\n exit\nexit\n \nmpls ss-pw PW10001-main-to-A-2-Eline  10001  6.6.6.6 control-word\nmpls ss-pw PW10001-main-to-B-1-Eline  10001  1.1.1.1 control-word\n \nmpls ms-pw PW10001-main-Eline PW10001-main-to-A-2-Eline PW10001-main-to-B-1-Eline \n \n业务删除步骤：\nno mpls l2-circuit PW10001-main-to-A-2-Eline\nno mpls l2-circuit PW10001-main-to-B-1-Eline\nno mpls ms-pw PW10001-main-Eline\n \n===============================================================================\nB-4设备配置：（LDP邻接到相同的地址只需配置一次）\n===============================================================================\nrouter ldp\n targeted-peer ipv4 2.2.2.2\n exit\nexit\n \nmpls ss-pw PW10002-back-to-A-2-Eline 10002 6.6.6.6 control-word\nmpls ss-pw PW10002-back-to-B-2-Eline 10002 2.2.2.2 control-word\n \nmpls ms-pw PW10002-back-Eline PW10002-back-to-A-2-Eline PW10002-back-to-B-2-Eline\n \n业务删除步骤：\nno mpls l2-circuit PW10002-back-to-A-2-Eline\nno mpls l2-circuit PW10002-back-to-B-2-Eline\nno mpls ms-pw PW10002-back-Eline\n根因:不涉及\n解决方案:A设备（800）上查看业务状态\nshow mpls vc-table 看专线的VC/BFD状态。看到对应的PW的BFD状态为BFD-UP为正常。\n\nB设备（8000）上查看业务状态\nshow mpls mspw查看MSPW实例与SSPW的对应关系。\n\n 8000上show mpls l2vc查看SSPW的状态active为正常。\n原因分类:无\n"}
{"instruction": "10GE上联业务不通问题排查始末。    某地PON接入工程，采用GPON HGU作为用户终端，某日将上联进行改造，拟将千兆上联改造为万兆双上联，连接到主备bras作上联链路备份，且双bras之间启VRRP虚拟网关。改造后发现从19:1（XFP）上联到主用bras正常，从20:1（XFP）上联到备用bras不通，无法ping通备用bras接口地址，主备链路倒换后无法连到备用bras，无法ping通虚拟VRRP网关，只能再倒回到主用bras链路使用。", "input": "", "output": "案例主题:10GE上联业务不通问题排查始末\n案例编号:AL202112021271\n网络场景:\nOLT：AN5516-01 V4.0 2018T2SP2 (RP1200)\nAN5516-01B      version is 0.12(V104R002SP13.HSWA.B01,GENERAL), Compiled Time:Jan 10 2019 09:54:37\nOLT接双10GE上联，其中每条10GE为单成员端口独立的Trunk聚合（启静态LACP），每条聚合链路连接至bras，19:1(XFP)连接主bras，20:1(XFP)连接备bras，两台bras之间启VRRP虚拟网关，OLT管理VLAN透传VRRP心跳，形成V字形保护。\n现象描述:    某地PON接入工程，采用GPON HGU作为用户终端，某日将上联进行改造，拟将千兆上联改造为万兆双上联，连接到主备bras作上联链路备份，且双bras之间启VRRP虚拟网关。改造后发现从19:1（XFP）上联到主用bras正常，从20:1（XFP）上联到备用bras不通，无法ping通备用bras接口地址，主备链路倒换后无法连到备用bras，无法ping通虚拟VRRP网关，只能再倒回到主用bras链路使用。\n处理过程:1>.OLT上联改造当日，无法PING通备用bras接口地址，发现备用链路无法学习到mac和vlan信息，但主用链路正常学习mac+vlan，以及正常ping测bras接口。\n \n2>.测试倒换链路到备用bras，也无法成功，关主用bras端口，直接脱管，只能切回主用bras链路。\n \n3>.进入OLT主控device目录，show uplink port all，查看20:1上联口正常up。\n \n4>.检查OLT配置，单端口Trunk聚合配置正确，端口协商为强制万兆全双工，未找到异常配置。进入protocol\\lacp目录，sh lacp channel-group trunks，链路状态双方0x3d正常。\n \n5>.查询20:1上联口实时性能，上联口clear  uplink_port_perform_data对统计实时性能清零，观察流入流出字节数，结果发现没有流入流出字节数增长极为缓慢。\n \n6>.在端口物理连接、端口状态、配置、链路层检查配置都正常的情况下，统计未看到流入流出字节，怀疑系统内部未转发，进一步排查OLT系统内聚合组情况。先梳理该OLT上联聚合成员关系，进入主控bcm目录，通过trunk show查询聚合口关系表如下：\nBCM.0> trunk show                                                                                                                                 \nDevice supports 136 trunk groups:                                                                                                                \n  128 front panel trunks (0..127), 8 ports/trunk                                                                                                 \n  8 fabric trunks (128..135), 16 ports/trunk                                                                                                      \ntrunk 1: (front panel, 2 ports)=ge0,ge2 dlf=any mc=any ipmc=any psc=destmac (0x2)                                                                \ntrunk 2: (front panel, 1 ports)=xe19 dlf=any mc=any ipmc=any psc=srcdestmac (0x3)                                                                 \ntrunk 3: (front panel, 1 ports)=xe18 dlf=any mc=any ipmc=any psc=srcdestmac (0x3)\n即：\nTrunk2: 19:1(逻辑17口，物理xe19)\nTrunk3: 20:1(逻辑23口，物理xe18)\n再进入主控shell模式，输入hal_show_trunk_info，查看聚合组索引：\n-> hal_show_trunk_info                                                                                                                                          \n trunkid            ifindex                                                                                               \n 1                      31                                                                                                                                 \n trunkid            ifindex\n 2                      33                                                                                                                             \n trunkid            ifindex                                                                                                                            \n 3                      36                                                                                                                        \nvalue = 0 = 0x0\n即20:1上联口CPU内部端口索引ifindex=36。\n \n7>.然后进入主控super-vlan接口，service目录telnet 127.0.0.1 3000，查看管理VLAN 101所在端口索引：\n127.0.0.1#0> ifconfig lag3                                                                                                                       \nlag3    Link type:Ethernet  HWaddr 00:0a:c2:21:f5:5a  Queue:none                                                                                 \n        UP RUNNING SIMPLEX BROADCAST MULTICAST SWITCHPORT MASTER                                                                                 \n        INNERARPPROXYSTATE:0                                                                                                                     \n        INTERARPPROXYSTATE:0                                                                                                                      \n        physical if arp proxy:1                                                                                                                  \n        arp_switch:1                                                                                                                              \n        MTU:1500  metric:1  VR:0  ifindex:35                                                                                                      \n        RX packets:0 mcast:0 errors:0 dropped:0                                                                                                   \n        TX packets:0 mcast:0 errors:0                                                                                                            \n        collisions:0 unsupported proto:0                                                                                                         \n        RX bytes:0  TX bytes:0\n即20:1上联口ip协议栈端口索引ifindex=35。\n \n8>.综合第6>和7>点，发现协议栈内部index 35，外面适配层是index 36，所以对不上，故管理vlan 101没添加成功，所以到备用bras不通。\n \n9>.删除Trunk3，重新创建，重新创建Trunk聚合组后，ip协议栈和cpu的ifindex一致，到bras链路正常，流量正常，问题解决。\n根因:1>.由于该OLT改造过程中重复创建trunk组操作，然后就出现概率性的ifindex索引两者不一致问题，CPU端口索引ifindex=36，IP协议栈端口索引ifindex=35。现象是报文到cpu了，但是再到ip协议栈不处理，不学习arp，不处理收到的报文。\n \n2>.三层接口中，可以直接通过vlan 查看协议栈加入端口号。通过该命令，看到协议栈里面的ten-gigabitethernet 0/0/1，就是我们通常用的logic port编号，trunk组对应lagx，协议里面没有trunk3看到信息(ten-gigabitethernet 0/0/23)，只有trunk2的信息(ten-gigabitethernet 0/0/17)，说明端口20:1确实是没有成功加入协议栈，所以需要重新创建trunk3聚合组，查看是否成功加入协议栈。此处bcm命令，也跟vlan目录下show vlan_port的逻辑端口结果是一致对应的。\n\n解决方案:1、极低概率问题，频繁创建Trunk组操作后，发现索引不一致问题，删除当前错误索引的聚合组，重新创建聚合组，查看端口cpu和ip协议栈索引一致即可。\n2、AN5516系统升级2021T1之后软件。\n原因分类:无\n"}
{"instruction": "控平网络CCU升级后出现无法Telnet问题处理和解决案例。控平网络，CCU相关信息：2200853R1B，从RP0201SP7/2019.8.27升级至RP0201/2021.3.18\n其现象是使用CRT通过通道转登录到设备主控盘后，telnet 127.0.0.1 6111命令无法连接进主控命令行终端，telnet命令卡在当前shell界面。设备的网元IP可以ping通并且设备正常上管，业务不受影响。初步判断主控核心模块工作正常，问题在telnet 6111接入主控终端的转登录某环节出现问题。\ntelnet 6111转登录简要原理过程如下：\n\n模块①，是6111端口转登录流程在OS上的127.0.0.1监听。\n模块②，是6222端口转登录流程在OS上的127.0.0.1监听。\n模块③，是主控NMU软件里的IP栈模块。\n模块④，是主控软件6111端口telnet服务的实际服务端也就是IMI模块。\n模块⑤，是IP栈以前6222调试端口的实际服务端。\n如图，红色线是6111端口的转登录流程，涉及模块①③④。绿线是IP栈调试端口的转登录流程，涉及模块②③⑤，新版软件这条线由于安全需求，已关闭。也就是模块②默认关闭。\n目前的问题环境，上次现网操作有限的信息确认模块①正常，OS本地有6111端口监听，并且telnet 127.1 6111时，本地可以看到一条TCP连接产生。\n由于IP栈的调试端口6222的开关设置在6111命令行当中，而6111又无法登陆所以无法正常手动打开6222这条绿线去获取IP栈的状态。本次排查手册就是利用ROS诊断终端打开6222这条绿线，打开后看其是否能够登录，如果能够登录再从中获取必要信息。", "input": "", "output": "案例主题:控平网络CCU升级后出现无法Telnet问题处理和解决案例\n案例编号:AL202201252361\n网络场景:控平网络，CCU相关信息：2200853R1B，RP0201/2021.3.18\n现象描述:控平网络，CCU相关信息：2200853R1B，从RP0201SP7/2019.8.27升级至RP0201/2021.3.18\n其现象是使用CRT通过通道转登录到设备主控盘后，telnet 127.0.0.1 6111命令无法连接进主控命令行终端，telnet命令卡在当前shell界面。设备的网元IP可以ping通并且设备正常上管，业务不受影响。初步判断主控核心模块工作正常，问题在telnet 6111接入主控终端的转登录某环节出现问题。\ntelnet 6111转登录简要原理过程如下：\n\n模块①，是6111端口转登录流程在OS上的127.0.0.1监听。\n模块②，是6222端口转登录流程在OS上的127.0.0.1监听。\n模块③，是主控NMU软件里的IP栈模块。\n模块④，是主控软件6111端口telnet服务的实际服务端也就是IMI模块。\n模块⑤，是IP栈以前6222调试端口的实际服务端。\n如图，红色线是6111端口的转登录流程，涉及模块①③④。绿线是IP栈调试端口的转登录流程，涉及模块②③⑤，新版软件这条线由于安全需求，已关闭。也就是模块②默认关闭。\n目前的问题环境，上次现网操作有限的信息确认模块①正常，OS本地有6111端口监听，并且telnet 127.1 6111时，本地可以看到一条TCP连接产生。\n由于IP栈的调试端口6222的开关设置在6111命令行当中，而6111又无法登陆所以无法正常手动打开6222这条绿线去获取IP栈的状态。本次排查手册就是利用ROS诊断终端打开6222这条绿线，打开后看其是否能够登录，如果能够登录再从中获取必要信息。\n处理过程:1 使用CRT登入问题网元主控盘shell，敲入命令“netstat -apnt”再次确认OS本地的6111端口以及25端口（ROS诊断平台端口）监听存在\n\n2 登录ROS诊断平台并进入enable模式，telnet 127.1 25， 用户密码diag/diag\n3 ROS终端命令info threads，显示NMU软件所有工作线程\n其中重点确认线程：1b是模块③，1e是模块⑤，28&2a是模块②，29&2b是模块①，2e是模块④。\n4 对步骤3中的每一个线程模块执行命令ti TID、tt TID，其中TID是上图中的各模块的第一列的ID值，例如上图第一行的PTRACE模块\n逐个模块执行上述命令打印各模块信息直到zECDH模块，也就是TID为152的模块。\n5 执行命令lkup ipnet_term_sw      d &ipnet;_term_sw 1 1:\n红框中00代表该开关值目前是0。\n6 修改开关值为1，执行命令m &ipnet;_term_sw 1，并在接下来的两行提示终端中依次输入1（开关值）和 / （当前修改操作结束符）\n7 再次打印该变量确认修改成功\n8 打开开关，调用开关函数。输入命令lkup ipcom_sa_sock_switch以及call ipcom_sa_sock_switch 1\n9 连续exit退出ROS诊断终端。回到OS本地shell输入确认本地6222端口是否打开\n如果排查步骤能顺利执行到此步，可发现步骤1中这个端口监听是没有开启的。\n10 OS上执行命令，登录IP栈调试终端，看是否可正常登录 telnet 127.1 6222\n11 在IP栈终端中输入命令，查看NMU软件内的6111、6222端口监听netstat -a\n如果无6111端口监听，则问题属于NMU的telnet协议模块，也就是zIMI。\n12 确认该两个监听的Fd分别是6、16，执行命令查看它们的详细信息，依次输入\nnetstat -d 6 和 netstat -d 16\n13 再次输入命令netstat –a\n可看到当前6222调试终端在NMU软件内的转登录连接，也就是模块③⑤之间的绿色线。\n14 新开一个OS的登录shell，执行命令netstat -apnt\n可看到当前6222调试终端在OS内的转登录连接，也就是模块②③之间的绿色线。步骤13、14可看到从OS一次完整的转登录（6222）过程，也就是②-③-⑤的连接关系。\n15 参照13、14步骤思路，新开第3个OS登录shell，尝试telnet登入6111端口\ntelnet 127.1 6111\n问题网元应该会卡在红框之内的输出，不会提示后续的用户密码等输出。\n16 在步骤14中的OS终端输入命令，按照上次现网操作经验应该可看到OS上的转登录连接，也就是模块①③之间的红色连线： netstat -apnt\n17 在步骤13当中的IP栈6222调试端口中再次输入命令netstat -a：\n正常情况下应该能看到这一对TCP连接，也就是模块③④之间的红色连线。如步骤16、17均正常，则说明一次从OS的6111端口转登录到NMU的过程①-③-④正常建立。\nnetstat -d 4096\n根因:暂无法确定最终根因，总部在实验室环境挂测和模拟现网操作升级都未复现，需要持续观察别的网络升级情况\n解决方案:进行CCU主备切换即可解决\n1 检查各网元的告警、时隙状态、标签状态、通道状态（不能有异常或者倒换的通道）是否正常，检查完后要做记录，切换前、后检查应一致;\n2 检查ODUK1+1保护状态APS字节是否正常;\n3 检查主备 CCU 控平运行状态是否正常\n4 备份主备用控平数据库；\n4.1 使用CRT登录主用CCU，输入命令ason.sh -backup log 后会出现备份文件名；文件名格式为：log—网元IP—日期时间\n4.2 登录备用CCU使用 SSH 10.1.1.备用CCU槽位，拷贝日志\n4.3 主用CCU中“log-”文件在/asonshared/teststub/node路径下\n5 检查主备 CCU 数据库同步状态是否一致（要求yes）。主备用CCU都要检查。\n6 检查主备用CCU的通信状态（正常）。主备用CCU都要检查。\n7 切换前检查主备数据库同步一致性\n在主备切换前检查主备用数据库，是否同步一致，确保控平数据库正常。在cd /asonshared/teststub/node 下输入ll *.db，比较数据库四个db文件时间是否一致\n8 主备切换\n8.1 在网管上进行CCU主备切换操作，在主用CCU上进行操作，并保证主备切换后主备CCU盘正常上网管；\n原因分类:无\n"}
{"instruction": "SNMP采集问题与自测工具使用。客户反馈第三方平台SNMP采集不到某新开站点端口和描述信息（ifDesc），怀疑我司设备SNMP配置错误或者其他问题；\n ", "input": "", "output": "案例主题:SNMP采集问题与自测工具使用\n案例编号:AL202207204782\n网络场景:1.客户采用第三方平台SNMP采集我司设备信息；\n2.我司设备配置相应SNMP模块；\n \n现象描述:客户反馈第三方平台SNMP采集不到某新开站点端口和描述信息（ifDesc），怀疑我司设备SNMP配置错误或者其他问题；\n \n处理过程:1.现网服务器部署SNMP自测工具（总部接口人处索取，并参考自测工具使用说明）；\n2.检查确认我司设备SNMP配置正确，查询我司相关设备最新MIB库中ifDesc的OID，使用自测工具采集测试；结果显示自测正常；\n \nD:\\snmp-????\\bin>snmpwalk -v2c -c ngnbrro 10.41.78.16 1.3.6.1.2.1.2.2.1.2\r\nIF-MIB::ifDescr.1 = STRING: DCNP2P1\r\nIF-MIB::ifDescr.2 = STRING: DCNP2P2\r\nIF-MIB::ifDescr.3 = STRING: DCNP2P3\r\nIF-MIB::ifDescr.4 = STRING: DCNP2P4\r\nIF-MIB::ifDescr.5 = STRING: DCNP2P5\r\nIF-MIB::ifDescr.6 = STRING: DCNP2P6\r\nIF-MIB::ifDescr.7 = STRING: DCNP2P7\r\nIF-MIB::ifDescr.8 = STRING: DCNP2P8\r\nIF-MIB::ifDescr.9 = STRING: DCNP2P9\r\nIF-MIB::ifDescr.10 = STRING: DCNP2P10\r\nIF-MIB::ifDescr.11 = STRING: DCNP2P11\r\nIF-MIB::ifDescr.12 = STRING: DCNP2P12\r\nIF-MIB::ifDescr.134483968 = STRING: XGE0/1/1\r\nIF-MIB::ifDescr.134488064 = STRING: GE0/1/2\r\nIF-MIB::ifDescr.134492160 = STRING: GE0/1/3\r\nIF-MIB::ifDescr.134496256 = STRING: GE0/1/4\r\nIF-MIB::ifDescr.134746112 = STRING: Conexao ao Anel AGG SOL-AAE01-FHI01AG XGE0/3\r\n/1 - LC569172\r\nIF-MIB::ifDescr.134750206 = STRING: XGE0/2/1.4094\r\nIF-MIB::ifDescr.134750208 = STRING: XGE0/2/2\r\nIF-MIB::ifDescr.134754302 = STRING: XGE0/2/2.4094\r\nIF-MIB::ifDescr.134754304 = STRING: Conexao ao Anel AGG SOL-SOCH01-FHI01AG XGE0/\r\n8/1\r\nIF-MIB::ifDescr.134758398 = STRING: XGE0/2/3.4094\r\nIF-MIB::ifDescr.134758400 = STRING: XGE0/2/4\r\nIF-MIB::ifDescr.135008256 = STRING: Conexao ao Anel AGG TIG-GPO01-FHI01AG XGE0/8\r\n/1\r\nIF-MIB::ifDescr.135012350 = STRING: XGE0/3/1.4094\r\nIF-MIB::ifDescr.135012352 = STRING: Conexao ao Anel AGG MEU-MGM01-FHI01AG XGE0/3\r\n/1 - LC535606\r\nIF-MIB::ifDescr.135016446 = STRING: XGE0/3/2.4094\r\nIF-MIB::ifDescr.135794688 = STRING: GE0/6/1\r\nIF-MIB::ifDescr.135798782 = STRING: GE0/6/1.4094\r\nIF-MIB::ifDescr.135798784 = STRING: GE0/6/2\r\nIF-MIB::ifDescr.135799309 = STRING: Conexao ao servico 4G - eNodeb SR-SOCHJ0\r\nIF-MIB::ifDescr.135801072 = STRING: Conexao ao servico 4G - eNodeb SR-SOCHJ0\r\nIF-MIB::ifDescr.135802878 = STRING: GE0/6/2.4094\r\nIF-MIB::ifDescr.135802880 = STRING: GE0/6/3\r\nIF-MIB::ifDescr.135802889 = STRING: Conexao ao servico 3G NodeB 114822 - CE1682\r\n- FLAFLACPL152757\r\nIF-MIB::ifDescr.135802936 = STRING: Conexao ao servico 3G NodeB 114828 - CE1698\r\n- FLAFLACPL152763\r\nIF-MIB::ifDescr.135803006 = STRING: Conexao ao servico 3G NodeB 114867 - CY1690\r\n- FLAFLACPL152799\r\nIF-MIB::ifDescr.135803378 = STRING: Conexao ao servico 3G NodeB 114865 - CE1689\r\n- FLAFLACPL152797\r\nIF-MIB::ifDescr.135803421 = STRING: Conexao ao servico 3G NodeB 115249 - CE1691\r\n- FLAFLACPL153293\r\nIF-MIB::ifDescr.135803428 = STRING: Conexao ao servico 2G - eNodeb SR-SOJCJ0\r\nIF-MIB::ifDescr.135803462 = STRING: Conexao ao servico 3G NodeB 115247 - CE1680\r\n- FLAFLACPL153291\r\nIF-MIB::ifDescr.135803463 = STRING: Conexao ao servico 3G NodeB 115252 - CE1681\r\n- FLAFLACPL153296\r\nIF-MIB::ifDescr.135803464 = STRING: Conexao ao servico 3G NodeB 114841 - CE1684\r\n- FLAFLACPL152776\r\nIF-MIB::ifDescr.135803465 = STRING: Conexao ao servico 3G NodeB 115248 - CE1685\r\n- FLAFLACPL153292\r\nIF-MIB::ifDescr.135803466 = STRING: Conexao ao servico 3G NodeB 114831 - CE1686\r\n- FLAFLACPL152766\r\nIF-MIB::ifDescr.135803467 = STRING: Conexao ao servico 3G NodeB 114834 - CE1699\r\n- FLAFLACPL152769\r\nIF-MIB::ifDescr.135803469 = STRING: Conexao ao Servico 3G -  Nodeb 114811 - CE16\r\n87 - FLAFLACPL152746\r\nIF-MIB::ifDescr.135803475 = STRING: Conexao ao servico 3G NodeB 114846 - CE1696\r\n- FLAFLACPL152781\r\nIF-MIB::ifDescr.135803476 = STRING: Conexao ao servico 3G NodeB 114817 - CE1697\r\n- FLAFLACPL152752\r\nIF-MIB::ifDescr.135803478 = STRING: Conexao ao servico 3G NodeB 114866 - CY1689\r\n- FLAFLACPL152799\r\nIF-MIB::ifDescr.135803942 = STRING: Conexao ao servico 3G NodeB 114837 - CE1683\r\n- FLAFLACPL152772\r\nIF-MIB::ifDescr.135804921 = STRING: Conexao ao servico 4G - eNodeb 18NLSOSO00- A\r\nccid: 101000\r\nIF-MIB::ifDescr.135804938 = STRING: Conexao ao servico 4G - eNodeb NLSOCH01 - SO\r\nLFLACPL269476\r\nIF-MIB::ifDescr.135804993 = STRING: Conexao ao servico 4G - eNodeb NLSOSO00- Tra\r\nil: FLAFLACPL143421\r\nIF-MIB::ifDescr.135804994 = STRING: Conexao ao servico 4G - eNodeb NLSOSO00- Acc\r\nId: 107883\r\nIF-MIB::ifDescr.135805169 = STRING: Conexao ao servico 4G - eNodeb SR-SOJCJ0\r\nIF-MIB::ifDescr.135805170 = STRING: Conexao ao servico 4G - eNodeb SR-SOCEJ0\r\nIF-MIB::ifDescr.135805336 = STRING: Conexao ao servico 4G - eNodeb NLSOPL00- TRA\r\nIL: SOLFLACPL203386\r\nIF-MIB::ifDescr.135805339 = STRING: Conexao ao servico 4G - eNodeb 7NLSOCH00 - T\r\nrail: FLAFLACPL205733\r\nIF-MIB::ifDescr.135805341 = STRING: Conexao ao servico 4G - eNodeb 514945-SR-SOC\r\nE04(NLSOCE04) FLAFLACPL208102\r\nIF-MIB::ifDescr.135805342 = STRING: Conexao ao servico 4G - eNodeb NLSOCE00- Tra\r\nil: FLAFLACPL206686\r\nIF-MIB::ifDescr.135805344 = STRING: Conexao ao servico 4G - eNodeb NLSOPL00- TRA\r\nIL: SOLFLACPL203386\r\nIF-MIB::ifDescr.135806974 = STRING: GE0/6/3.4094\r\nIF-MIB::ifDescr.135806976 = STRING: GE0/6/4\r\nIF-MIB::ifDescr.135807105 = STRING: Conexao ao servico 3G NodeB 114877 - CY2451\r\n- FLAFLACPL152810\r\nIF-MIB::ifDescr.135807484 = STRING: Conexao ao servico 3G - eNodeb SR-SQSQJ1\r\nIF-MIB::ifDescr.135807485 = STRING: GE0/6/4.509\r\nIF-MIB::ifDescr.135807519 = STRING: Conexao ao servico 3G - eNodeb SR-SQSQJ1\r\nIF-MIB::ifDescr.135807674 = STRING: Conexao ao Servico 3G - CE2637\r\nIF-MIB::ifDescr.135807929 = STRING: Conexao ao servico 2G - eNodeb\r\nIF-MIB::ifDescr.135807930 = STRING: Conexao ao servico 3G - eNodeb\r\nIF-MIB::ifDescr.135808054 = STRING: Conexao ao servico 3G NodeB 114898 - CE2621\r\n- FLAFLACPL152832\r\nIF-MIB::ifDescr.135808055 = STRING: Conexao ao servico 3G - eNodeb 587612-CE2661\r\n-SOLFLACPL294404\r\nIF-MIB::ifDescr.135808898 = STRING: Conexao ao servico 3G NodeB 103479FLA /CEN01\r\n-FLA /CEN01 40ETH SITE CE2615\r\nIF-MIB::ifDescr.135809031 = STRING: Conexao ao servico 2G - eNodeb 579325_SR-HCH\r\nCJ0 - CUBSOLCPL283460\r\nIF-MIB::ifDescr.135809045 = STRING: Conexao ao servico 3G - eNodeb 579324_SR-HCH\r\nCJ0 - CUBSOLCPL283459\r\nIF-MIB::ifDescr.135809072 = STRING: Conexao ao Servico 4G - NLHCHC00\r\nIF-MIB::ifDescr.135809096 = STRING: Conexao ao servico 4G - eNodeb NLFPFP00 - PS\r\nFFLACPL279517\r\nIF-MIB::ifDescr.135809144 = STRING: Conexao ao servico 4G - eNodeb 579323_SR-HCH\r\nCJ0 - CUBSOLCPL283458\r\nIF-MIB::ifDescr.135809267 = STRING: Conexao ao servico 4G - eNodeb SR-SQSQJ1\r\nIF-MIB::ifDescr.135809289 = STRING: Conexao ao servico 4G - eNodeb NLTABA00 -Acc\r\nid 111281\r\nIF-MIB::ifDescr.135809449 = STRING: Conexao ao servico 4G - eNodeb NLSOJC03 - SO\r\nLFLACPL279651\r\nIF-MIB::ifDescr.135810264 = STRING: Conexao ao servico 4G - eNodeb 580751 - SR-S\r\nQSQJ0(4G) - SNQFLACPL285116\r\nIF-MIB::ifDescr.135811070 = STRING: GE0/6/4.4094\r\nIF-MIB::ifDescr.135811072 = STRING: GE0/6/5\r\nIF-MIB::ifDescr.135815168 = STRING: GE0/6/6\r\nIF-MIB::ifDescr.135819264 = STRING: GE0/6/7\r\nIF-MIB::ifDescr.135823360 = STRING: GE0/6/8\r\nIF-MIB::ifDescr.136056832 = STRING: Conexao ao Anel AGG SOL-SODC01-FHI01AG XGE0/\r\n3/1 - LC591858\r\nIF-MIB::ifDescr.136060926 = STRING: XGE0/7/1.4094\r\nIF-MIB::ifDescr.136060928 = STRING: XGE0/7/2\r\nIF-MIB::ifDescr.136065024 = STRING: XGE0/7/3\r\nIF-MIB::ifDescr.136069120 = STRING: XGE0/7/4\r\nIF-MIB::ifDescr.136318976 = STRING: Conexao ao Anel AGG FLA-CEN01-FHI01CO ten-gi\r\ngabitethernet0/2/2/2 - LC533982\r\nIF-MIB::ifDescr.136323070 = STRING: XGE0/8/1.4094\r\nIF-MIB::ifDescr.136323072 = STRING: Conexao ao Anel AGG SOL-AAE01-FHI01AG XGE0/8\r\n/1 - LC569173\r\nIF-MIB::ifDescr.136327166 = STRING: XGE0/8/2.4094\r\nIF-MIB::ifDescr.1207959552 = STRING: null\r\nIF-MIB::ifDescr.1879048193 = STRING: inloopback\r\nIF-MIB::ifDescr.1879048194 = STRING: mngt0\r\nIF-MIB::ifDescr.1879048195 = STRING: oamif\r\nIF-MIB::ifDescr.1879048196 = STRING: loopback0\r\nIF-MIB::ifDescr.1879048197 = STRING: loopback1023\r\nIF-MIB::ifDescr.1879048207 = STRING: loopback3\n3.与客户确认第三方平台是否使用了正确的OID并反馈我司自测正常；\n根因:客户第三方平台配置异常或服务异常\n解决方案:客户排查第三方平台配置\n原因分类:无\n"}
{"instruction": "HG6245D型SFU新开通语音业务注册失败的技术案例。某本地PON网络，某站点在新产品HG6245D型ONU放装过程中，使用SFU模式，采用sip协议进行语音配置，语音业务可以获取IP地址，但是注册失败，需要及时处理避免客户的正常放装工作，由于疫情影响，不能去客户家中抓包，需要通过远程在ONU上进行抓包。该站点还有其他型号的ONU：AN5506-04FS，业务使用正常。", "input": "", "output": "案例主题:HG6245D型SFU新开通语音业务注册失败的技术案例\n案例编号:AL202206064211\n网络场景:\n现象描述:某本地PON网络，某站点在新产品HG6245D型ONU放装过程中，使用SFU模式，采用sip协议进行语音配置，语音业务可以获取IP地址，但是注册失败，需要及时处理避免客户的正常放装工作，由于疫情影响，不能去客户家中抓包，需要通过远程在ONU上进行抓包。该站点还有其他型号的ONU：AN5506-04FS，业务使用正常。\n处理过程:1、检查OLT的基础配置，该站点采用短定时和LACP+trunk的上联口10GE配置模式，信息如下：\nRAB-1045-HayErrahma4-F2-1\\interface# show trunk all\nMembers list: 19:1(up)20:1(down)\nMaster port: 19:1\nTrunk mode: LACP\nLoad balance mode: src-dst-mac \n2、语音采用单层vlan，使用sip协议，语音通过DHCP方式获取IP地址，信息如下：\n!ngn interface config -------------------------------------------------\nset new_ngn_uplink_interface name MLGvoip@1161 protocol_type SIP mgc 1 ims.inwi.ma 5060 mgc 2 10.112.1.4 5060 m_dns ipv4 0.0.0.0 s_dns ipv4 0.0.0.0 sip_reg_addr ims.inwi.ma sip_proxy_addr 10.112.1.4\n!ngn interface config end ---------------------------------------------\n!ngn user config -------------------------------------------------\nset new_ngn_uplink_user serv MLGvoip@1161 vid 1161 ip_m dhcp dhcp_opt enable dom @ims.inwi.ma pro 5060 user_in 0\nset ngn_uplink_user_port phone 1 usern +212538930197 sip_user_n +212538930197 sip_user_p 5iqwRI3HVOleKRy4 user_in 0\n3、该ONU获取的语音获取的IP如下，但是注册失败：\n\n\n4、对该站点的HG6245D型SFU进行远程抓包，先进入onu的shell下面，ping语音代理服务器ip地址，显示不通：\nONU的 mac是 ：84-06-FA-DA-FB-A9\nONU获取的IP地址：10.177.2.6\n语音网关IP是：10.177.0.1\n\n在进行ONU的shell下面进行打印抓包，显示该ONU 发送了 arp 请求报文, 但是网关服务器没有回复：\n#tcpdump -i voip0 -vv &&\ntcpdump: listening on voip0, link-type EN10MB (Ethernet), capture size 262144 bytes\r\n07:10:09.738235 ARP, Ethernet (len 6), IPv4 (len 4), Request who-has 10.177.0.1 tell 10.177.2.6, length 28\r\n07:10:10.001121 IP6 (hlim 255, next-header ICMPv6 (58) payload length: 16) fe80::8606:faff:feda:fba9 > ff02::2: [icmp6 sum ok] ICMP6, router solicitation, length 16\r\n          source link-address option (1), length 8 (1): 84:06:fa:da:fb:a9\r\n            0x0000:  8406 fada fba9\r\n07:10:10.741098 ARP, Ethernet (len 6), IPv4 (len 4), Request who-has 10.177.0.1 tell 10.177.2.6, length 28\r\n07:10:11.743091 ARP, Ethernet (len 6), IPv4 (len 4), Request who-has 10.177.0.1 tell 10.177.2.6, length 28\r\n07:10:13.746237 ARP, Ethernet (len 6), IPv4 (len 4), Request who-has 10.177.0.1 tell 10.177.2.6, length 28\r\n07:10:14.009422 IP6 (hlim 255, next-header ICMPv6 (58) payload length: 16) fe80::8606:faff:feda:fba9 > ff02::2: [icmp6 sum ok] ICMP6, router solicitation, length 16\r\n          source link-address option (1), length 8 (1): 84:06:fa:da:fb:a9\r\n            0x0000:  8406 fada fba9\r\n07:10:14.749098 ARP, Ethernet (len 6), IPv4 (len 4), Request who-has 10.177.0.1 tell 10.177.2.6, length 28\r\n07:10:15.751104 ARP, Ethernet (len 6), IPv4 (len 4), Request who-has 10.177.0.1 tell 10.177.2.6, length 28\r\n07:10:16.754210 ARP, Ethernet (len 6), IPv4 (len 4), Request who-has 10.177.0.1 tell 10.177.2.6, length 28\r\n07:10:17.757113 ARP, Ethernet (len 6), IPv4 (len 4), Request who-has 10.177.0.1 tell 10.177.2.6, length 28\r\n07:10:18.017118 IP6 (hlim 255, next-header ICMPv6 (58) payload length: 16) fe80::8606:faff:feda:fba9 > ff02::2: [icmp6 sum ok] ICMP6, router solicitation, length 16\r\n          source link-address option (1), length 8 (1): 84:06:fa:da:fb:a9\r\n            0x0000:  8406 fada fba9\r\n07:10:18.759091 ARP, Ethernet (len 6), IPv4 (len 4), Request who-has 10.177.0.1 tell 10.177.2.6, length 28\r\n07:10:19.762207 ARP, Ethernet (len 6), IPv4 (len 4), Request who-has 10.177.0.1 tell 10.177.2.6, length 28\r\n07:10:20.765254 ARP, Ethernet (len 6), IPv4 (len 4), Request who-has 10.177.0.1 tell 10.177.2.6, length 28\r\n07:10:21.767094 ARP, Ethernet (len 6), IPv4 (len 4), Request who-has 10.177.0.1 tell 10.177.2.6, length 28\r\n07:10:22.025118 IP6 (hlim 255, next-header ICMPv6 (58) payload length: 16) fe80::8606:faff:feda:fba9 > ff02::2: [icmp6 sum ok] ICMP6, router solicitation, length 16\r\n          source link-address option (1), length 8 (1): 84:06:fa:da:fb:a9\r\n            0x0000:  8406 fada fba9\r\n07:10:23.286443 ARP, Ethernet (len 6), IPv4 (len 4), Request who-has 10.177.0.1 tell 10.177.2.6, length 28\r\n07:10:24.289180 ARP, Ethernet (len 6), IPv4 (len 4), Request who-has 10.177.0.1 tell 10.177.2.6, length 28\r\n07:10:25.291083 ARP, Ethernet (len 6), IPv4 (len 4), Request who-has 10.177.0.1 tell 10.177.2.6, length 28\r\n07:10:26.033121 IP6 (hlim 255, next-header ICMPv6 (58) payload length: 16) fe80::8606:faff:feda:fba9 > ff02::2: [icmp6 sum ok] ICMP6, router solicitation, length 16\r\n          source link-address option (1), length 8 (1): 84:06:fa:da:fb:a9\r\n            0x0000:  8406 fada fba9\r\n07:10:26.780230 ARP, Ethernet (len 6), IPv4 (len 4), Request who-has 10.177.0.1 tell 10.177.2.6, length 28\r\n07:10:27.781095 ARP, Ethernet (len 6), IPv4 (len 4), Request who-has 10.177.0.1 tell 10.177.2.6, length 28\r\n07:10:28.783178 ARP, Ethernet (len 6), IPv4 (len 4), Request who-has 10.177.0.1 tell 10.177.2.6, length 28\r\n07:10:29.789202 ARP, Ethernet (len 6), IPv4 (len 4), Request who-has 10.177.0.1 tell 10.177.2.6, length 28\r\n07:10:30.041121 IP6 (hlim 255, next-header ICMPv6 (58) payload length: 16) fe80::8606:faff:feda:fba9 > ff02::2: [icmp6 sum ok] ICMP6, router solicitation, length 16\r\n          source link-address option (1), length 8 (1): 84:06:fa:da:fb:a9\r\n            0x0000:  8406 fada fba9\r\n07:10:30.791086 ARP, Ethernet (len 6), IPv4 (len 4), Request who-has 10.177.0.1 tell 10.177.2.6, length 28\r\n07:10:31.793172 ARP, Ethernet (len 6), IPv4 (len 4), Request who-has 10.177.0.1 tell 10.177.2.6, length 28\r\n07:10:32.796230 ARP, Ethernet (len 6), IPv4 (len 4), Request who-has 10.177.0.1 tell 10.177.2.6, length 28\r\n07:10:33.797091 ARP, Ethernet (len 6), IPv4 (len 4), Request who-has 10.177.0.1 tell 10.177.2.6, length 28\r\n07:10:34.049151 IP6 (hlim 255, next-header ICMPv6 (58) payload length: 16) fe80::8606:faff:feda:fba9 > ff02::2: [icmp6 sum ok] ICMP6, router solicitation, length 16\r\n          source link-address option (1), length 8 (1): 84:06:fa:da:fb:a9\r\n            0x0000:  8406 fada fba9\n6、新版本的ONU，可以通过远程打印信息进行报文分析，关于Tcpdump使用说明，详细见附件word说明：\n根因:上层语音服务器配置问题，通过报文排除我司设备的问题。该问题在验收和维护过程中，尤其在当前疫情之下，无法进入用户家中，通过远程打印抓包方式处理类似问题具有指导意义。\n解决方案:上层语音服务器配置问题，客户IP team重新检查和配置之后，语音业务恢复正常，注册成功。\n原因分类:无\n"}
{"instruction": "综合网管通过snmp采集异常的情况处理方法汇总。通常情况下综合网管采集路由不通或者采集状态异常都会导致采集失败，本案例汇总我遇到过的各类采集问题与解决过程。\r\n ", "input": "", "output": "案例主题:综合网管通过snmp采集异常的情况处理方法汇总\n案例编号:AL202202232682\n网络场景:联通IPRAN网络综合网管通过SNMP采集遇到的各种问题汇总\n现象描述:通常情况下综合网管采集路由不通或者采集状态异常都会导致采集失败，本案例汇总我遇到过的各类采集问题与解决过程。\r\n \n处理过程:\n配置类问题\n\n配置类问题基本表现为OSPF邻居状态异常或至网内路由均可达，但至综合网管路由不通\n\nospf邻居状态问题：\n\n\n以800设备为例，所有端口配置完成后需在配置最后进行commit操作，否则端口更改后的配置不生效。\n邻居状态未建立的情况可更具该文档核查两端的设备配置，确保配置正常。\n \n\n路由不通问题：\n\n通过TRACER路由查看路由可达位置，\nA、若路由在网内中断（如下图），可通过在异常站点查看相关配置下图为10.112.193.39处排查配置等问题\n\n \nB、若路由已从网内发出（如下图），可基本排除网内配置原因，核查设备至服务器中断节点路由过滤，是否缺少配置静态路由等原因\n \n\n \n\n配置未生效的情况\n\n1、snmp可以ping通  snmp自测无返回情况处理\n当8000或835设备可以带源ping通服务器如下图所示，可按本文档进行处理\n835EV3：\n异常\n\n正常\n\n8000-3\n异常：\n\n正常\n \n\n处理方法：\n8000：（字体加粗部分）\nF85208-ASG-JZ-R8003#show run snmp\n!                                                                                                    \nsnmp-agent enable\nsnmp-agent trap enable\nsnmp-agent community fiberhome fiber-RE\nsnmp-agent group fiberhn any fiberhome\nsnmp-agent access fiberhn any noauth prefix _all_ _none_ _all_\nsnmp-agent target-host trap address 10.255.0.115\nsnmp-agent vrf FHNMVPN\nsnmp-agent trap source 172.19.33.144 interface loopback 1023\nF85208-ASG-JZ-R8003#con t\nchange to configuration mode\nF85208-ASG-JZ-R8003(config)#no snmp-agent trap source\nF85208-ASG-JZ-R8003(config)#no snmp-agent vrf FHNMVPN\nF85208-ASG-JZ-R8003(config)#snmp-agent vrf FHNMVPN\ninf:0x20b0600, set command snmp-agent vrf FHNMVPN success.\nF85208-ASG-JZ-R8003(config)#snmp-agent trap source 172.19.33.144 interface loopback 1023\nF85208-ASG-JZ-R8003(config)#exit\nF85208-ASG-JZ-R8003#save\n \n \n835：（字体加粗部分）\n情况1：\nF12061-CSG-XGA-R835E#con t\nF12061-CSG-XGA-R835E(config)#snmp agent-stop\nF12061-CSG-XGA-R835E(config)#snmp agent-start\nF12061-CSG-XGA-R835E(config)#exit\nF12061-CSG-XGA-R835E#wri\n \n情况2：\n\nrouter#con t\nrouter(config)#no snmp access fiberhn                                     \nrouter(config)#no snmp group fiberhn               \nrouter(config)#no snmp comm fiber-RE\nrouter(config)#snmp comm fiberhome 0.0.0.0/0 fiber-RE\nrouter(config)#snmp group fiberhn any fiberhome\nrouter(config)#snmp access fiberhn any noauth prefix _all_ _none_ _all_\nrouter(config)#exit\nrouter#wri                   \n根因:目前遇到的问题基本属于路由问题和配置问题，处理过程模块汇总了目前出现比较多的几种情况。可解决大部分采集异常的问题。\r\n \n解决方案:通过打通路由，完善配置可以解决部分采集问题\n原因分类:无\n"}
{"instruction": "关于OTNM2000网管升级865/860zebos仿真增效方法。在进行zebos仿真时，当需要仿真的设备量过大，使用该方法除了上述第六步仍需每一步手动完成外，其余操作可压缩在几分钟内完成所有操作，方便快捷，出错率低，效率大大提升。", "input": "", "output": "案例主题:关于OTNM2000网管升级865/860zebos仿真增效方法\n案例编号:AL202205184001\n网络场景:在OTNM2000网管升级时，涉及800设备的zebos仿真比对，如果人工对每个设备仿真结果进行相应的建每台设备文件夹、放置工具、放置设备配置原文件、更改名称，仿真完成后，对生成的zebos改名为设备IP等操作过于繁琐，会占用大量时间，通过dos命令编写脚本，可快速完成大部分工作。\n现象描述:在进行zebos仿真时，当需要仿真的设备量过大，使用该方法除了上述第六步仍需每一步手动完成外，其余操作可压缩在几分钟内完成所有操作，方便快捷，出错率低，效率大大提升。\n处理过程:使用该方法前需已完成If.7z的生成，并完成解压，以下所有操作默认在该解压完成的文件夹（If）中进行，脚本编写过程中使用excel可以更加便捷的完成大量设备的脚本编写。\n \n \n1、List\n在解压后的If文件夹中建立txt文件，\n写入该命令：\ndir *.* /b >list.txt  \n     保存并关闭txt文本，将该文件后缀由txt更改为dat，更改完毕后双击运行即可获得list.txt，该文本中包含所有If文件夹中的所有设备原文件，并每个网元一行。\n \n2、建文件夹\n     在通过excel分列功能可提取出If文件夹中所有设备ip明细，每个ip一行，在ip列中前一列插入DOS命令md，对每一个ip建立文件夹，并以IP命名。同样在If文件夹中新建txt文本，写入excel中编辑好的命令，保存并关闭txt文本，将该文件后缀由txt更改为dat，更改完毕后双击运行即可每个IP建立一个空文件夹。\n     命令示例：\n          md 12.62.3.62\n          md 12.21.254.1\n          md 12.22.254.1\n          md 12.104.12.104\n          md 12.10.6.10\n          md 12.23.254.1\n     \n3、复制工具\n通过copy命令，仿真工具的两个文件nmprotobuf.dll和w32sim.exe复制进每个设备文件夹中，通过excel可加工获得下列命令。同样在If文件夹中新建txt文本，写入excel中编辑好的命令，保存并关闭txt文本，将该文件后缀由txt更改为dat，更改完毕后双击运行即可完成复制\n命令示例：\n          copy nmprotobuf.dll 12.62.3.62\n          copy nmprotobuf.dll 12.21.254.1\n          copy nmprotobuf.dll 12.22.254.1\n          copy nmprotobuf.dll 12.104.12.104\n          copy nmprotobuf.dll 12.10.6.10\n          copy nmprotobuf.dll 12.23.254.1\n          copy w32sim.exe 12.62.3.62\n          copy w32sim.exe 12.21.254.1\n          copy w32sim.exe 12.22.254.1\n          copy w32sim.exe 12.104.12.104\n          copy w32sim.exe 12.10.6.10\n          copy w32sim.exe 12.23.254.1     \n4、复制原文件\n将If文件夹中设备原文件复制进每个IP对应的文件夹中。同样在If文件夹中新建txt文本，写入excel中编辑好的命令，保存并关闭txt文本，将该文件后缀由txt更改为dat，更改完毕后双击运行即可完成复制\n \n命令示例：\n          copy 104_25_12.62.3.62_IPRAN.dat 12.62.3.62\n          copy 10_1_12.21.254.1_IPRAN.dat   12.21.254.1\n          copy 10_2_12.22.254.1_IPRAN.dat   12.22.254.1\n          copy 115_29_12.104.12.104_IPRAN.dat   12.104.12.104\n          copy 118_6_12.10.6.10_IPRAN.dat   12.10.6.10\n          copy 11_1_12.23.254.1_IPRAN.dat   12.23.254.1\n5、更改名称.bat\n将所有的设备配置原文件，按照仿真工具的要求使用rename命令更改成otnm_config。同样在If文件夹中新建txt文本，写入excel中编辑好的命令，保存并关闭txt文本，将该文件后缀由txt更改为dat，更改完毕后双击运行即可完成一键改名。\n命令示例：\n           ren 12.62.3.62\\*.dat otnm_config\n          ren 12.21.254.1\\*.dat otnm_config\n          ren 12.22.254.1\\*.dat otnm_config\n          ren 12.104.12.104\\*.dat otnm_config\n          ren 12.10.6.10\\*.dat otnm_config\n          ren 12.23.254.1\\*.dat otnm_config\n6、仿真生成zebos\n   该步骤暂为测试出合适的dos命令，需手动进入每个文件夹中把运行w32sim.exe，可同时运行多台设备的仿真，Juin运行多少和电脑的配置有关。\n \n7、zebos改名\n 将生成的的zebos文件更名为设备ip，方便通过比对工具进行配置比对。同样在If文件夹中新建txt文本，写入excel中编辑好的命令，保存并关闭txt文本，将该文件后缀由txt更改为dat，更改完毕后双击运行即可完成一键改名。\n     命令示例：\n          ren 12.62.3.62\\zebos.cfg 12.62.3.62.cfg\n          ren 12.21.254.1\\zebos.cfg 12.21.254.1.cfg\n          ren 12.22.254.1\\zebos.cfg 12.22.254.1.cfg\n          ren 12.104.12.104\\zebos.cfg 12.104.12.104.cfg\n          ren 12.10.6.10\\zebos.cfg 12.10.6.10.cfg\n          ren 12.23.254.1\\zebos.cfg 12.23.254.1.cfg\n8、汇总zebos\n     为方便使用配置比对工具进行批量比对，新建文件夹”zebosnew”，将生成的仿真配置全部复制进该文件夹中。同样在If文件夹中新建txt文本，写入excel中编辑好的命令，保存并关闭txt文本，将该文件后缀由txt更改为dat，更改完毕后双击运行即可完成一键复制汇总。\n      命令示例：\n          copy 12.62.3.62\\12.62.3.62.cfg zebosnew\n          copy 12.21.254.1\\12.21.254.1.cfg zebosnew\n          copy 12.22.254.1\\12.22.254.1.cfg zebosnew\n          copy 12.104.12.104\\12.104.12.104.cfg zebosnew\n          copy 12.10.6.10\\12.10.6.10.cfg zebosnew\n          copy 12.23.254.1\\12.23.254.1.cfg zebosnew\n根因:纯手工进行操作效率低，出错率高，耗时长，使用dos命令节约时间，效率提高\n解决方案:使用dos命令完成相关操作。\n原因分类:无\n"}
{"instruction": "通过Redfish订阅告警。下面的操作步骤中，笔记本IP为10.82.20.7，服务器BMC IP为10.82.20.237。BMC用户名ADMIN，BMC密码ADMIN。\n命令应根据实际情况进行修改。", "input": "", "output": "案例主题:通过Redfish订阅告警\n案例编号:AL202202212621\n网络场景:通过Redfish订阅告警，订阅后服务器产生的告警可以及时上报到告警平台上。\n现象描述:下面的操作步骤中，笔记本IP为10.82.20.7，服务器BMC IP为10.82.20.237。BMC用户名ADMIN，BMC密码ADMIN。\n命令应根据实际情况进行修改。\n处理过程:1、向需要上报告警的服务器下发redfish命令。命令如下：\ncurl -X POST -u ADMIN:ADMIN -H 'Content-Type':'application/json' -d '{\"Destination\":\"http://10.82.20.7\", \"Context\":\"zenglx\", \"EventTypes\":[\"Alert\",\"StatusChange\"], \"Protocol\":\"Redfish\"}' https://10.82.20.237/redfish/v1/EventService/Subscriptions/ -ks\n\"Destination\"是告警要发往的地址。如果用笔记本测试，需将此地址改为笔记本IP。\n\"Context\"是由客户提供的字符串，与Destination一起存储。\n\"EventTypes\"是上报事件的类型，可以填一个或者多个。如果有多个，写在中括号里面，用逗号分开。取值有：\"StatusChange\" 、\"ResourceUpdated\" 、\"ResourceAdded\" 、\"ResourceRemoved\" 和\"Alert\" 。\n\"Protocol\"固定为\"Redfish\"。\n\n配置后可以用命令查询订阅。命令如下：\ncurl -X GET -u ADMIN:ADMIN https://10.82.20.237/redfish/v1/EventService/Subscriptions -ks\n查出来有几个，服务器就有几个订阅。往下一级查询，可以查询订阅的详细信息。\n\n上述配置完成后，服务器就可以上报告警了。\n \n2、如何确认配置是否正确呢？可以用自己的笔记本接服务器，看看能否正常收到Redfish上报的告警。笔记本需要有WSL环境或者Linux虚拟机，并连接公网。下面的设置以WSL环境的Ubuntu 20.04为例。\n \n3、笔记本需要下载一个Linux下运行的Redfish-Event-Listener软件，该软件可以接收Redfish上报的事件。\n下载地址：https://github.com/GiacomoCortesi/Redfish-Event-Listener\n[本案例附件已提供]\n \n4、Redfish-Event-Listener软件基于Python编写，笔记本需要联网下载python的库文件requests和http_parser。方法如下：\n（1）备份Ubuntu源。\ncd  /etc/apt\ncp  sources.list  sources.list_bak\n（2）修改Ubuntu源，加快下载速度。\n用nano或vim编辑sources.list，删除原有内容，粘贴以下内容：\ndeb http://mirrors.aliyun.com/ubuntu/ focal main restricted universe multiverse\r\ndeb-src http://mirrors.aliyun.com/ubuntu/ focal main restricted universe multiverse\ndeb http://mirrors.aliyun.com/ubuntu/ focal-security main restricted universe multiverse\r\ndeb-src http://mirrors.aliyun.com/ubuntu/ focal-security main restricted universe multiverse\ndeb http://mirrors.aliyun.com/ubuntu/ focal-updates main restricted universe multiverse\r\ndeb-src http://mirrors.aliyun.com/ubuntu/ focal-updates main restricted universe multiverse\ndeb http://mirrors.aliyun.com/ubuntu/ focal-proposed main restricted universe multiverse\r\ndeb-src http://mirrors.aliyun.com/ubuntu/ focal-proposed main restricted universe multiverse\ndeb http://mirrors.aliyun.com/ubuntu/ focal-backports main restricted universe multiverse\r\ndeb-src http://mirrors.aliyun.com/ubuntu/ focal-backports main restricted universe multiverse\n（3）安装pip。\napt-get  install  python3-pip\n（4）安装库文件。\npip  install  requests  http_parser\n \n5、进入Redfish-Event-Listener所在目录，编辑config.ini文件。\n[Information]\r\nUpdated = April 24, 2017\r\nDescription = Redfish Event Listener Tool\n[SystemInformation]\r\nListenerIP = 10.82.20.7       #修改为笔记本IP\r\nListenerPort = 80                #默认443，修改为80\r\nUseSSL = off                       #默认on，修改为off\n[CertificateDetails]\r\ncertfile = cert.pem\r\nkeyfile = server.key\n[SubsciptionDetails]\r\nDestination = http://10.82.20.7                #修改为笔记本IP，注意前面加上http://\r\nEventTypes = Alert,StatusChange             #订阅的事件类型，与第一步下发的redfish命令中的事件类型一致\r\nContext = zenglx                                       #与第一步下发的redfish命令一致\r\nProtocol = Redfish\r\nSubscriptionURI = /redfish/v1/EventService/Subscriptions\n[ServerInformation]\r\nServerIPs = https://10.82.20.237               #服务器IP\r\nUserNames = ADMIN                                #服务器BMC用户名\r\nPasswords = ADMIN                                  #服务器BMC密码\r\ncertcheck = off\n \n6、运行Redfish-Event-Listener软件。将软件解压，并进入所在目录。然后运行如下命令即可：\npython3 RedfishEventListener_v1.py\n\n \n7、使用IPMITool模拟生成告警，看能否收到告警上报。\nIPMITool模拟生成告警的命令如下：\nipmitool -I lanplus -H 10.82.20.237 -U ADMIN -P ADMIN event 1\nipmitool -I lanplus -H 10.82.20.237 -U ADMIN -P ADMIN event 2\nipmitool -I lanplus -H 10.82.20.237 -U ADMIN -P ADMIN event 3\n\n \n8、笔记本收到告警上报时，会在界面显示告警信息。如下所示：\n\n根因:无\n解决方案:无\n原因分类:无\n"}
{"instruction": "锦州移动政务网项目路由器开通OSPF无法建邻问题。政务网总点设备配置如下：\n\n\n\n\n我司现场路由器配置数据如下：\ninterface GigaEthernet0/2.1030\r\n ip address 10.150.4.6 255.255.255.252\r\n no ip directed-broadcast\r\n encapsulation dot1Q 1030\r\n ip ospf cost 100\r\n ip ospf hello-interval 1\r\n ip ospf network point-to-point\r\n!\r\ninterface GigaEthernet0/2.2030\r\n ip address 10.150.5.6 255.255.255.252\r\n no ip directed-broadcast\r\n encapsulation dot1Q 2030\r\n ip ospf hello-interval 1\r\n ip ospf network point-to-point\r\n!\r\ninterface GigaEthernet0/3\r\n ip address 10.150.67.1 255.255.255.192\r\n!\nrouter ospf 1\r\n router-id 10.150.4.6\r\n network 10.150.4.4 255.255.255.252 area 64\r\n network 10.150.67.0 255.255.255.192 area 64\r\n redistribute connect\nrouter ospf 2\r\n router-id 10.150.5.6\r\n network 10.150.5.4 255.255.255.252 area 64\r\n redistribute connect\r\n!", "input": "", "output": "案例主题:锦州移动政务网项目路由器开通OSPF无法建邻问题\n案例编号:AL202209075574\n网络场景:我司路由器新进锦州移动政务网项目开通中心医院、妇幼保健院站点，项目为替换迈普路由器，按原迈普路由器配置数据配置到我司路由器后直连子接口通信正常，OSPF无法建邻。\n现象描述:政务网总点设备配置如下：\n\n\n\n\n我司现场路由器配置数据如下：\ninterface GigaEthernet0/2.1030\r\n ip address 10.150.4.6 255.255.255.252\r\n no ip directed-broadcast\r\n encapsulation dot1Q 1030\r\n ip ospf cost 100\r\n ip ospf hello-interval 1\r\n ip ospf network point-to-point\r\n!\r\ninterface GigaEthernet0/2.2030\r\n ip address 10.150.5.6 255.255.255.252\r\n no ip directed-broadcast\r\n encapsulation dot1Q 2030\r\n ip ospf hello-interval 1\r\n ip ospf network point-to-point\r\n!\r\ninterface GigaEthernet0/3\r\n ip address 10.150.67.1 255.255.255.192\r\n!\nrouter ospf 1\r\n router-id 10.150.4.6\r\n network 10.150.4.4 255.255.255.252 area 64\r\n network 10.150.67.0 255.255.255.192 area 64\r\n redistribute connect\nrouter ospf 2\r\n router-id 10.150.5.6\r\n network 10.150.5.4 255.255.255.252 area 64\r\n redistribute connect\r\n!\n处理过程:路由器ping总点互联地址通信正常：\nRouter_config#ping 10.150.5.5\r\nPING 10.150.5.5 (10.150.5.5): 56 data bytes\r\n!!!!!\r\n--- 10.150.5.5 ping statistics ---\r\n5 packets transmitted, 5 packets received, 0% packet loss\r\nround-trip min/avg/max = 0/0/1 ms\r\nRouter_config#ping 10.150.4.5\r\nPING 10.150.4.5 (10.150.4.5): 56 data bytes\r\n!!!!!\n路由器无法建邻：\nRouter_config#show ip ospf neighbor\r\n----------------------------------------------------------------------------\r\n                                OSPF process: 1\n\r\n                                 AREA: 64\r\nNeighbor ID     Pri   State            DeadTime   Neighbor Addr   Interface\r\n----------------------------------------------------------------------------\r\n                                OSPF process: 2\n\r\n                                 AREA: 64\r\nNeighbor ID     Pri   State            DeadTime   Neighbor Addr   Interface\r\n----------------------------------------------------------------------------\n因无法发现OSPF建邻过程，不能正确判断原因，开启DEBUG ,查看路由器建邻发包信息\nRouter#debug ip ospf packet detail\r\n<191>Jan 10 18:17:24 Router OSPF 05CA1C40 [Core 0]: OSPF: Recvive packet, length [64]\r\n<191>Jan 10 18:17:24 Router OSPF 05CA1C40 [Core 0]: OSPF: Recvive packet, length [64]\n发现能收到OSPF hello包，再进行debug ip ospf event\n<191>Jan 10 18:19:26 Router OSPF 05CA1C40 [Core 0]: OSPF[1]: Dead-interval mismatch in received hello, source = 10.150.4.5. Dead interval: remote = 4, local = 40\r\n<191>Jan 10 18:19:26 Router OSPF 05CA1C40 [Core 0]: OSPF[2]: Dead-interval mismatch in received hello, source = 10.150.5.5. Dead interval: remote = 4, local = 40\n从debug信息发现对端华为设备Dead interval: remote = 4，本端Dead interval: remote = 40，将我司路由器ip ospf dead-interval设置为 4 ，重新查看OSPF邻居，邻居已经正常建立\n<190>Jan 10 18:26:45 Router OSPF 05CA1C40 [Core 0]: OSPF[1]: Loading Done with Nbr 0.83.43.41 on GigaEthernet0/2.1030, database Synchronized (FULL)\n<190>Jan 10 18:27:48 Router OSPF 05CA1C40 [Core 0]: OSPF[2]: Loading Done with Nbr 0.86.132.162 on GigaEthernet0/2.2030, database Synchronized (FULL)\nRouter_config#show ip ospf nei\r\n----------------------------------------------------------------------------\r\n                                OSPF process: 1\n\r\n                                 AREA: 0.0.0.64\r\nNeighbor ID     Pri   State            DeadTime   Neighbor Addr   Interface\r\n0.83.43.41      1     FULL/-           3          10.150.4.5      GigaEthernet0/\r\n2.1030\r\n----------------------------------------------------------------------------\r\n                                OSPF process: 2\n\r\n                                 AREA: 64\r\nNeighbor ID     Pri   State            DeadTime   Neighbor Addr   Interface\r\n0.86.132.162    1     FULL/-           3          10.150.5.5      GigaEthernet0/\r\n2.2030\r\n----------------------------------------------------------------------------\n根因:路由器Dead interval: remote = 40和对端华为设备Dead interval: remote = 4不同，导致邻居路由器默认对端设备关机，OSPF无法长时间建邻\n解决方案:在我司路由器配置Dead interval: remote = 4\ninterface GigaEthernet0/2.1030\r\n ip address 10.150.4.6 255.255.255.252\r\n encapsulation dot1Q 1030\r\n ip ospf cost 100\r\n ip ospf hello-interval 1\r\n ip ospf dead-interval 4\r\n ip ospf network point-to-point\r\n!\r\ninterface GigaEthernet0/2.2030\r\n ip address 10.150.5.6 255.255.255.252\r\n encapsulation dot1Q 2030\r\n ip ospf hello-interval 1\r\n ip ospf dead-interval 4\r\n ip ospf network point-to-point\r\n!\r\ninterface GigaEthernet0/3\r\n ip address 10.150.67.1 255.255.255.192\r\n!\n原因分类:无\n"}
{"instruction": "长江计算鲲鹏服务器主板 VDDQ 掉电复位风险升级升级办法。服务器掉电复位风险、服务器概率出现主板 VDDQ 电源 abnormal power-off 告警。\n", "input": "", "output": "案例主题:长江计算鲲鹏服务器主板 VDDQ 掉电复位风险升级升级办法\n案例编号:AL202209195712\n网络场景:联通 R220K V2 中 S920X00、S920S00，iBMC 版本低于 6.26（不包含），iBMC(VD)版本低于3.01.12.38（不包含）。\n现象描述:服务器掉电复位风险、服务器概率出现主板 VDDQ 电源 abnormal power-off 告警。\n\n处理过程:规避措施：升级新 BMC、BIOS 版本。\n解决方案：iBMC 要求下电后升级，服务器下电后升级 iBMC 解决该问题，iBMC 版本升级到如下解决问题的版本，BIOS、CPLD 必须配套升级。具体参考版本配套表。\n\n根因:VDDQ 电源环路参数兼容不足存在服务器掉电复位风险，故障率为 1/1000，需要升级 BMC、BIOS 版本解决此风险问题。\n解决方案:2. 通过 iBMC Web 升级 iBMC、主板 CPLD\n2.1. 通过 iBMC Web 升级 iBMC\niBMC 升级不会改变 iBMC 系统的用户名和密码。升级过程中请勿刷新浏览器当前升级页面。升级时间约\n20 分钟。\n步骤 1 在 iBMC 的 Web 界面中选择“iBMC 管理 > 固件升级”，如下图所示。\n\n步骤 2 在“固件升级”区域，单击.... 弹出“选择要加载的文件”窗口。\n步骤 3 选择升级包存放在本地 PC 上的路径。\n步骤 4 单击“打开”。成功设置升级包的路径并返回“固件升级”界面。如果界面存在“升级完成后\n立即自动重启 iBMC，使升级的固件生效”选项时，需要勾选该选项。\n步骤 5 单击“开始升级”。弹出确认对话框，单击“确定”。\niBMC 系统开始执行升级操作。\n升级 iBMC 系统备用镜像大约需要 5 分钟～10 分钟。升级成功后，“固件升级”界面提示升级成功。\n升级完成后 iBMC 系统会自动重新启动，同时 iBMC 主备镜像会自动倒换，无需点击 iBMC 页面上的“主\n备分区镜像倒换”按钮。\n对于版本号为 Vxxx 格式的 iBMC，请继续执行步骤 6，对于版本号为 x.xx.xx.xx 格式的 iBMC， 请继续\n执行步骤 7。\n步骤 6 升级原主用镜像。iBMC 重启完成后，重新登录 iBMC 界面。重复执行步骤 1 到步骤 5，升级 iBMC\n系统的原主用镜像。\n步骤 7 iBMC 重启完成后，重新登录 iBMC 界面，此时主备用镜像为最新版本。\n步骤 8 在 iBMC 的 Web 界面中查询 iBMC 版本。确认升级后的 iBMC 版本号为最新版本\n \n2.2. 通过 iBMC Web 升级主板 CPLD iBMC\nBIOS 和 CPLD 均需要升级时，需要先升级 BIOS 且升级生效后再升级 CPLD，否则可能导致 BIOS 升级异\n常。升级后，需要重新启动服务器才能使新版本的 CPLD 生效。重启服务器将会影响业务运行。\n步骤 1 在 iBMC 的 Web 界面中选择“iBMC 管理 > 固件升级”。打开“固件升级”界面，如下图所\n示。\n\n步骤 2 单击.... ，选择需要升级的文件。\n步骤 3 单击“开始升级”弹出“启动升级”对话框。\n步骤 4 单击“确定”开始升级。升级过程约 3 分钟，升级成功后界面提示“升级成功”。\n步骤 5 在服务器不同工作状态下升级 CPLD 固件，新版本 CPLD 的生效方式不同，具体操作如下：\n1.服务器下电状态下升级固件的生效方式：CPLD 升级完成后 iBMC 会自动对服务器进行一次断电和\n上电，服务器上电完成后新版本 CPLD 生效。\n2.服务器上电状态下升级固件的生效方式：升级完 CPLD 后，需要对服务器手动进行下电：选择导\n航树中“系统管理 > 电源&功率”，在“服务器上下电”界面对服务器进行“下电”操作。\n服务器下电后，此时 iBMC 会自动复位，待 iBMC 复位完成后新版本 CPLD 生效，同时 iBMC 会根据\n服务器当前设置的“通电开机策略”自动进行上电或下电。\n步骤 6 查询升级后固件版本是否为目标版本：在 iBMC 的 Web 界面中选择“系统管理 > 系统信息”。\n在该页面中查询升级后的主板 CPLD 版本。\n \n3. 通过 Toolkit 软件升级 iBMC、主板 CPLD\n\n\n\n\n4. 升级回退操作\n4.1. 回退原则\n版本升级失败后，软件版本依然为升级前版本，不需要进行回退操作。当出现以下问题，请联系技术支\n持确认是否需要进行回退操作。\n 升级过程中出现重大异常，无法定位问题原因，在规定时间内无法排障。\n 完成升级后，出现新版本功能异常等问题。\n 留给完成后续升级操作的时间太短，无法在预定时间内完成升级，为避免因升级操作继续中断业务\n的情况持续到业务高峰期来临时段，执行回退。\n4.2. 回退操作\n 确定回退的目标版本号。建议回退到升级前版本。\n 回退到指定版本时，回退操作方式和第 2 节、第 3 节升级操作相同\n原因分类:无\n"}
{"instruction": "接入网管关于ONU的上下型流量分析方法的技术案例。某本地PON网络，某新产品HG6245D型ONU放装过程中，发现一段时间的历史性能采集之后，该ONU的下行流量（性能指标：Down Octets Trans ferred）增量小于上行流量（性能指标：up Octets Trans ferred）增量，针对此问题，我们需要对ONU采集的历史性能源文件进行分析。", "input": "", "output": "案例主题:接入网管关于ONU的上下型流量分析方法的技术案例\n案例编号:AL202209055511\n网络场景:\n现象描述:某本地PON网络，某新产品HG6245D型ONU放装过程中，发现一段时间的历史性能采集之后，该ONU的下行流量（性能指标：Down Octets Trans ferred）增量小于上行流量（性能指标：up Octets Trans ferred）增量，针对此问题，我们需要对ONU采集的历史性能源文件进行分析。\n处理过程:1，随机选择一台HG6245D型ONU，8:45-8：59和 9:00-9：15，这两个时间段的历史性能流量信息如下：\n\n2，查找上行和下行传送字节数的性能代码在D:\\unm2000\\server\\data\\xml文件夹下，找到如下文件：[PUB]PmType-STD.xml，查找信息，Down Octets Trans ferred的性能代码：725，up Octets Trans ferred的性能代码：700.（见附件word中详细说明）\n \n3，找到历史性能采集的ONU的原始文件，打开查看是乱码，需要进行解析，两个对应时间段的文件如下（见附件word中详细说明）\n\n1462\n725\n0\nBytes\nDown Octets Trans ferred\n下行传送字节数\n1\n3\nanm\n0\n\n \n\n1439\n700\n0\nBytes\nUP Octets Trans ferred\n上行传送字节数\n1\n3\nanm\n0\n\n4，对原始文件进行解析，使用管理员权限打开解析工具，输入对应文件名称，回车即可解析出来一个result的文件，该文件是16进制，解析工具（见附件word中）和解析结果图片如下：\n\n5，解析出来的文件是16进制，对应文件的里面的主要内容说明如下（见附件word中详细说明）：\npon traffic statistics result:\n00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00    [reserve bit 32]\n07 e6 08 10 08 2d 00    [start time]   采集开始时间\n07 e6 08 10 09 00 00    [end time]    采集结束时间\n00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00    [reserve bit 16]\n00 00 00 01    [perform item:1]:\n00 01 00 01 00 01    [object:slot 1 pon 1 onu 1]  onu的槽位pon口号和onu号\n00 00 00 00 00 00 00 00 00 00 00 00 00 00    [reserve bit 16]\n00 00    [self perform num:0]\n00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00    [reserve bit 16]\n00 05    [port num:5]\n00 01 02 c8 00 25    [port_id:1 port_type:712 perf_num:37]  如下为设备性能码：\nff 02 f4 01 00 02 00 00 00 00    [code:756  size:4]\nff 02 f7 01 00 02 00 00 00 00    [code:759  size:4]\nff 04 38 01 00 02 00 00 00 00    [code:1080  size:4]\nff 04 37 01 00 02 00 00 00 00    [code:1079  size:4]\nff 04 0d 01 00 02 00 00 00 00    [code:1037  size:4]\nff 02 f6 01 00 02 00 00 00 00    [code:758  size:4]\nff 02 f9 01 00 02 00 00 00 00    [code:761  size:4]\nff 03 19 01 00 02 00 00 17 19    [code:793  size:4]\nff 03 1a 01 00 02 00 00 01 42    [code:794  size:4]\nff 03 1b 01 00 02 00 00 05 25    [code:795  size:4]\nff 03 1c 01 00 02 00 00 01 06    [code:796  size:4]\nff 03 1d 01 00 02 ff ff fc c8    [code:797  size:4]\nff 03 1e 01 00 02 ff ff fc d7    [code:798  size:4]\nff 0c ad 01 00 00 00 00 00 00    [code:3245  size:4]\nff 04 07 01 00 02 00 00 00 00    [code:1031  size:4]\nff 04 4c 01 00 02 00 00 00 00    [code:1100  size:4]\nff 02 bc 01 01 00 00 00 00 00 3d ec 73 08    [code:700  size:8]\nff 02 d5 01 01 00 00 00 00 02 e3 1d 65 45    [code:725  size:8]\n6，解析出来的10进制结果如下：\n\n\n\n\n时间\n\n\n性能\n\n\n代码\n\n\n16进制\n\n\n10进制\n\n\n\n\n8:45\n\n\nDown Octets Trans ferred\n\n\n725\n\n\n02 e3 1d 65 45\n\n\n12400289093\n\n\n\n\nup Octets Trans ferred\n\n\n700\n\n\n3d ec 73 08\n\n\n1038906120\n\n\n\n\n9:00\n\n\nDown Octets Trans ferred\n\n\n725\n\n\n02 e3 1d 96 98\n\n\n12400301720\n\n\n\n\nup Octets Trans ferred\n\n\n700\n\n\n3d ec ab eb\n\n\n1038920683\n\n\n\n\n将10进制结果相减（9点的数值减去8点的数值）得到如下9:00-9：15的流量增量数值：\nDown Octets Trans ferred：12627bytes，\nup Octets Trans ferred：14563bytes.\n如上两个数值和第一步骤中网管界面看到的9:00-9：15的流量增量数值一致。\n \n \n根因:ONU的实时性能或者历史性能的流量问题，通过最后研发判断为2021T3（不包含）之前的OLT（5000系列）版本都存在该问题，OLT的上下行代码相反导致。该问题在处理过程中，学会了对网管原始代码的分析，通过该办法可以快速判断网管上直接读取的流量数据的准确性，对以后处理类似问题具有指导意义。\n解决方案:对OLT升级到2021T3(保护)及其以上版本解决。\n原因分类:无\n"}
{"instruction": "通过redfish批量采集服务器信息。shell脚本可在WSL或者linux虚拟机运行，需要安装有python3，且能ping通BMC IP。运行方法：\n1、将脚本保存为redfish.sh，和iplist.txt放在同一个文件夹。\n2、修改iplist.txt，一个IP一行。\n3、将redfish.sh添加可执行权限：chmod +x redfish.sh\n4、运行脚本：./redfish.sh\n5、所有IP采集完成后，会提示END ALL COLLECTION!!!，查看脚本目录下的total.csv即可。\n \n \n", "input": "", "output": "案例主题:通过redfish批量采集服务器信息\n案例编号:AL202208315371\n网络场景:该脚本可以通过redfish批量收集服务器的/redfish/v1/Systems/1 和/redfish/v1/Managers/1，然后提取所需要的信息，包括BMCIP、SN、HostName、PartNumber、Model、BiosVersion和BMCVersion。如果需要其它信息，也可用类似的\n提供两种方式：\n方式1：如果linux环境可以访问所有服务器BMC IP，可以运行shell脚本收集所有服务器信息。\n方式2：如果可以访问所有服务器BMC IP的linux环境，可以先在windows环境下运行BAT脚本，将所有服务器的信息收集打包。然后再将压缩包放到linux环境中，运行shell脚本提取服务器信息。需要准备windows版的curl。\n \n \n现象描述:shell脚本可在WSL或者linux虚拟机运行，需要安装有python3，且能ping通BMC IP。运行方法：\n1、将脚本保存为redfish.sh，和iplist.txt放在同一个文件夹。\n2、修改iplist.txt，一个IP一行。\n3、将redfish.sh添加可执行权限：chmod +x redfish.sh\n4、运行脚本：./redfish.sh\n5、所有IP采集完成后，会提示END ALL COLLECTION!!!，查看脚本目录下的total.csv即可。\n \n \n\n处理过程:#!/bin/bash\ntestdir=`pwd`\n##检查是否有curl，否则红色闪烁提示\ntest -e /usr/bin/curl || echo -e \"\\033[5;31m curl do not exist,please install first! \\033[0m\"\n##检查是否有python3，否则红色闪烁提示\ntest -h /usr/bin/python3 || echo -e \"\\033[5;31m python3 do not exist,please install first! \\033[0m\"\necho \"BMCIP,SN,HostName,PartNumber,Model,BiosVersion,BMCVersion\" > total.csv\nfor line in $(cat iplist.txt)\ndo\n        echo -e \"\\e[1;34mProcessing with ${line} ...\\e[0m\"\n        curl -X GET -u ADMIN:ADMIN https://${line}/redfish/v1/Systems/1 -ks | python3 -m json.tool > system.log\n        curl -X GET -u ADMIN:ADMIN https://${line}/redfish/v1/Managers/1 -ks | python3 -m json.tool > manager.log\n        bmcip=${line}\n        sn=$(grep -i SerialNumber system.log|awk -F'\"' '{print $4}')\n        host=$(grep -i HostName system.log|awk -F'\"' '{print $4}')\n        pn=$(grep -i PartNumber system.log|awk -F'\"' '{print $4}')\n         ##Model字段有两个，第二个为CPU型号。grep -m 1表示只取一个结果，就过滤掉了第二个。\n        model=$(grep -m 1 -i Model system.log|awk -F'\"' '{print $4}')\n        biosver=$(grep -i BiosVersion system.log|awk -F'\"' '{print $4}')\n        bmcver=$(grep -i FirmwareVersion manager.log|awk -F'\"' '{print $4}')\n        echo ${line},${sn},${host},${pn},${model},${biosver},${bmcver}>> total.csv\ndone\nrm -rf system.log\nrm -rf manager.log\necho -e '\\n'\necho \"*************************************************\"\necho \"*                                                                        *\"\necho \"*                END ALL COLLECTION!!!                 *\"\necho \"*                                                                        *\"\necho \"*************************************************\"\necho -e '\\n'\nexit\n \n \n根因: \nBAT收集脚本：\n1、将脚本保存为collect.bat，和iplist.txt、7za.exe一起，放在curl.exe文件所在目录。\n2、修改脚本中的BMC密码。\n3、修改iplist.txt，一个IP一行。\n4、打开cmd，进入curl目录后，运行collect.bat。运行后，会自动收集日志并打包。\n5、提示完成后，将curl目录下的tar压缩包发回即可。\n \nSHELL分析脚本：\n1、将脚本保存为analysis.sh，与收集到的压缩包放在同一个文件夹。\n2、运行脚本：./analysis.sh xxxx.tar   [xxxx.tar为压缩包的文件名]\n3、运行完成后，压缩包解压出来的文件夹下会生成total.csv文件。查看该文件即可。\n \n \n\n解决方案:BAT收集脚本：\n@echo off\n@chcp 936\ntitle -----收集redfish信息-----\n \nREM 根据时间建立文件夹\nif \"%time:~0,1%\"==\" \"  set \"time=0%time:~1%\"\nfor /f \"tokens=*\" %%a in ('time/t') do set now=%%a\nset ymd=%date:~0,4%%date:~5,2%%date:~8,2%\nset hms=%now:~0,2%%now:~3%%time:~6,2%\nset folder=%ymd%_%hms%\nmkdir %folder%\n \nREM 收集日志\necho.&echo.;\nfor /f \"tokens=*\" %%i in (iplist.txt) do (\n        echo  正在处理服务器 %%i...\n        curl -X GET -u ADMIN:ADMIN --connect-timeout 10 -m 10 https://%%i/redfish/v1/Systems/1 -ks  > %%i.system.log\n        curl -X GET -u ADMIN:ADMIN --connect-timeout 10 -m 10 https://%%i/redfish/v1/Managers/1 -ks > %%i.manager.log\n        move %%i.system.log %folder% >Nul 2>Nul\n        move %%i.manager.log %folder% >Nul 2>Nul\n        echo ------------------------------------\n)\n \nREM 打包为ZIP\necho  正在打包，请稍等！\n7za a -ttar %folder%.tar  %folder% >NUL\necho ------------------------------------\necho  压缩包文件名为%folder%.tar\necho.\necho  请将%cd%下的%folder%.tar发回！\nrmdir /s /q %folder%\necho.&echo;  ！！！完成！！！\n \n \nSHELL分析脚本：\n \n#!/bin/bash\n \nif [ ${#} != \"1\" ];then\n        echo \"Input parameter error!\"\n        echo \"Usage: $0 FILENAME\"\n        exit 1\nfi\n \nstarttime=`date +'%Y-%m-%d %H:%M:%S'`\necho -e \"\\e[1;34mUnpacking Files, Please wait ...\\e[0m\" \ntar -xvf $1 1>nul\nfolder=$(echo ${1} | awk -F\".\" '{print $1}')\n \n#将文件用python处理，分为多行\n#保存多行文件，原来的单行文件删除\nls $folder >  filelist.txt\nls $folder |grep .system.log  >  filesys.txt\ncd $folder\nwhile read line\ndo\n       cat ${line}|python3 -m json.tool > ${line}.python  2>nul\n        rm -rf ${line}\n        mv ${line}.python ${line}\ndone < ../filelist.txt\n \n#BMC IP从文件名中获取\n#system.log中，Model字段有两个，第一个是服务器型号，第二个是CPU型号。grep -m 1只显示第一个。\n#BMC版本从manager.log中读取，文件名需要从xxxxx.system.log改为xxxxx.manager.log\necho \"BMCIP,SN,HostName,PartNumber,Model,BiosVersion,BMCVersion\" > total.csv\nwhile read line\ndo\n        echo  -e \"\\e[1;34mProccessing ${line} ...\\e[0m\" \n        manfile=$(echo ${line}|sed -e s/system/manager/g)\n        bmcip=$(echo ${line}|cut -d. -f 1-4)\n        sn=$(grep -i SerialNumber ${line}|awk -F'\"' '{print $4}')\n        host=$(grep -i HostName ${line}|awk -F'\"' '{print $4}')\n        pn=$(grep -i PartNumber ${line}|awk -F'\"' '{print $4}')\n        model=$(grep -m 1 -i Model ${line}|awk -F'\"' '{print $4}')\n        biosver=$(grep -i BiosVersion ${line}|awk -F'\"' '{print $4}')\n        bmcver=$(grep -i FirmwareVersion ${manfile}|awk -F'\"' '{print $4}')\n        echo ${bmcip},${sn},${host},${pn},${model},${biosver},${bmcver} >> total.csv\ndone < ../filesys.txt\n \nendtime=`date +'%Y-%m-%d %H:%M:%S'`\nstart_sec=$(date --date=\"$starttime\" +%s);\nend_sec=$(date --date=\"$endtime\" +%s);\ncost=$[$end_sec - $start_sec];\n \necho  -e '\\r'\necho \"###########################################\"\necho \"#                                                                                        #\"\necho \"#                         !!! FINISHED !!!                                       #\"\necho \"#                                                                                        #\"\necho \"###########################################\"\necho  -e '\\r'\necho \"Elapsed Time: ${cost} seconds\"\necho  -e '\\r'\necho \"Please view total.csv in folder ${folder}.\"\necho  -e '\\r'\nrm -rf ../filelist.txt\nrm -rf ../filesys.txt\ncat total.csv\n \n \n \n \n原因分类:无\n"}
{"instruction": "PTN异常流量（带宽利用率异常）排查方案。流量异常", "input": "", "output": "案例主题:PTN异常流量（带宽利用率异常）排查方案\n案例编号:AL202210106252\n网络场景:PTN异常流量（带宽利用率异常）\n现象描述:流量异常\n处理过程:PTN异常流量（带宽利用率异常）排查方案\n \n涉及公式（以一个流量方向为例）\n端口15min均值：(packs*20+bytes)*8/900\n端口15min峰值：flows\n端口日均值：所有15min均值的均值\n端口日峰值：所有15min均值的最大值   \n所有15min峰值的最大值（特定）\n \n链路：看源宿端口   链路的发送是宿端口的接收   链路的接收是源端口的接收\n15min链路均值：源或宿端口15min接收均值\n15min链路峰值：源或宿端口15min接收峰值\n链路日均值：源或宿端口所有15min接收均值的均值\n链路日峰值：源或宿端口所有15min接收均值的最大值  \n源或宿端口所有15min峰值的最大值（特定）\n \n传输系统：有父环的看出环端口，均值为出环端口的均值之和，峰值为出环端口峰值之和\n15min传输系统均值：所有出环端口15min均值之和\n15min传输系统峰值：所有出环端口15min峰值之和\n日传输系统均值：所有15min传输系统均值的均值\n日传输系统均值：所有15min传输系统均值的最大值\n所有15min传输系统峰值的最大值 （特定）\n \n无父环的看环上所有端口，均值为所有端口均值的均值，峰值为所有端口峰值最大\n15min传输系统均值：所有途径端口15min均值的均值\n15min传输系统峰值：所有途径端口15min峰值最大\n日传输系统均值：所有15min传输系统均值的均值\n日传输系统均值：所有15min传输系统均值的最大值\n所有15min传输系统峰值的最大值（特定）\n \n电路：看uni端口流量\n \n根据上面公式，可以看出所有对象的流量最终都是由端口流量加工，下面排查过程分2个部分，一部分根据分析端口来确认（端口、链路、传输系统）的异常流量，一部分如何查找用于计算电路流量的uni端口，根据此端口来确认电路的异常流量\n \n查看端口异常流量\n1. web上根据趋势图找到异常时间点\n\n2. 如果是端口直接去网管上查看，如果是链路，传输系统，根据上述公式，找到影响对象的源宿端口、出环端口、环上途径端口，再去网管上查看\n3. 在网管上查看异常时间点的原始流量，均值和峰值异常，查看bytes和packas（峰值异常看flows），网管界面查看最好展示多个时间点，以便突出显示异常值，需排查设备\n\n \n查看电路异常流量\n1. 查找用于计算电路流量的uni端口（电路源宿端口）。网管侧查找电路时不带标签，后续可以用流量工具上的电路lable排除同名电路，lable取的是电路路由表反向-工作的第一个标签，\n\nTunnel，根据tunnel名称（去掉标签_label），在网管上过滤查看其ID（ID默认在列显示中隐藏），sqlyog登录pas数据库（unm2000 unm2K10 60298）,在pasdb.t_businessport中cobjid过滤ID，即可查到neid、boardid及其portkey(线路号)，如果有2条记录，为流量方向由不同端口分开上报，1条记录，为流量方向一个端口统一上报，上述操作即可查到是哪个网元端口哪个线路号上报的tunnel流量（ne board一般为源宿网元，在网管上查看tunnel路由即可找到,portkey也会在路由上的端口上标识）\n\n\n \n\nweb上根据趋势图找到异常时间点，在网管上查看异常时间点的原始流量，均值和均值异常，查看bytes和packas（特定峰值异常看flows），网管界面查看最好展示多个时间点，以便突出显示异常值，需排查设备\n\n \n\n \n\npw，根据pw名称（不去除_label），在web数据库mongodb里面查看其ID，使用robmongodb工具（admin fiberhome 26501），在pm_base_db中找到pw_day_日期表中过滤PW名称，右键view docment\n\n查询框输入db.getCollection('pw_day_20210808').find({ \"objNm\" : \"pw名称\"})，找到其ID。\n\n\n在pasdb.t_businessport中cobjid过滤ID，即可查到neid、boardid及其portkey(线路号)，如果有2条记录，为流量方向由不同端口分开上报，1条记录，为流量方向一个端口统一上报，上述操作即可查到是哪个网元端口哪个线路号上报的pw流量（ne board一般指电路路由源宿网元单盘，在流量工具上查看pw所属的L2VPN，在网管上根据L2VPN找到pw，后在网管上查看pw的路由，即可确认网元+portkey）\n\n \n\nweb上根据趋势图找到异常时间点，在网管上查看异常时间点的原始流量，均值和均值异常，查看bytes和packas（峰值异常看flows），网管界面查看最好展示多个时间点，以便突出显示异常值，需排查设备（与tunnel排查一样）\n\n \n \n \n \n \n根因:流量异常存在网管计算及设备上报等多种原因，需要排查判断\n解决方案:根据排查结果分析确认，此案例介绍分析方法\n原因分类:无\n"}
{"instruction": "下载E-LAN时网管报vc+vpls命令空返回值0X000000000处理方法。。下载E-LAN时网管回报vc+vpls命令空，返回值0X000000000，则表示VC无法绑定E-LAN，E-LAN无法在680本站生成。", "input": "", "output": "案例主题:下载E-LAN时网管报vc+vpls命令空返回值0X000000000处理方法。\n案例编号:AL202210126972\n网络场景:下载ELAN业务报错。\r\n \n现象描述:下载E-LAN时网管回报vc+vpls命令空，返回值0X000000000，则表示VC无法绑定E-LAN，E-LAN无法在680本站生成。\n处理过程:第一步：进入congfig模式下进行debug创建log日志\nRouter#con te\nRoute(config)r#debug nmagent msg recv send 回车\nRouter(config)#log file 123.log  ————创捷一个文件名为123的log日志\n \n下载L2VPN，等待报错\n \n然后关闭debug\n \nRoute(config)r#debug namgent off \n \n第二步：\n在home/log下拷出123.log_0,打开123.log_0日志，查找error_code\n\n \n \n第三步：找到erro_code:后不为0的语句；\n\n第四步：如上图转到erro_code: 1249这一行；\n\n \n第五步：\n看erro_code: 1249这一行的上面几行，会发现\n判断：\n\nVCid冲突，则把上图中292这个 vc id在zebos中找出来，协议栈删除残留VC\nvc 的oam冲突，则到otnm/ui/log下找到MSMPIPRanAgent_MSMPServer.exe.log文件打开，找到最后的下载时间后面的一段，查找363-1.32-6.124，stCfg.m_wTp_id=833,如下：\n\nstCfg.m_arVcname=363-1.32-6.124 stCfg.m_dwVcid=292 stCfg.m_byVctype=0 stCfg.m_dwPeer=302124290 stCfg.m_byOutlsppolicy=1 stCfg.m_dwTunnelid=559 stCfg.m_wLspid=1 stCfg.m_bySignal=0 stCfg.m_dwInlabel=113858 stCfg.m_dwOutlabel=113858 stCfg.m_dwNexthop=0 stCfg.m_byVc_bfd_en=0 stCfg.m_byDelaytime=5 stCfg.m_dwBfd_my_id=0 stCfg.m_wTp_id=833 stCfg.m_wPw_index=278 stCfg.m_byDelaytime=5 stCfg.m_byVc_prot_type=0 stCfg.m_bySpoke_mesh_mode=0 stCfg.m_byPolicer_mode=0 stCfg.m_wCir=0 stCfg.m_wPir=1000 stCfg.m_dwCbs=0 stCfg.m_dwPbs=0 stCfg.m_byCm=0\n表明833这个oam id在ZEBOS中，有TUNNEL的y1731 833与之冲突，找出来删除即可\nmpls-tp y1731 initiative oam-id 833 oam-level vc mep source-mep-id 1 peer-mep-id 1 lsp-exp 0 pw-exp 7 mel 7 cv 3\nmpls ilm-entry 110987 XGE0/7/1 pop inloopback 127.0.0.1 171.3.0.3/32 tunnel-name 363-1.114-9.232.1e103f4d.1 lsp-id 4 ingress 18.15.173.15 egress 171.3.0.3 y1731 833\n \n上述两条都得删掉。\n \n协议栈各种删残留数据的命令行\n \n1)删除ftn tunnel\n对于这句删除到18.1.13.1截止：mpls ftn-entry tunnel-id 557 18.1.13.1/32 112350 171.3.1.126 XGE0/2/3 primary tunnel-name 363-1.15-4.22d.1e10403a.0 lsp-id 1 ingress 171.3.0.3 egress 18.1.13.1 y1731 826\nRoute(config)#no mpls ftn-entry tunnel-id 557 18.1.13.1/32 112350 171.3.1.126 XGE0/2/3 primary tunnel-name 363-1.15-4.22d.1e10403a.0 lsp-id 1 ingress 171.3.0.3 egress 18.1.13.1\n2)删除ilm tunnel\n对于这句：mpls ilm-entry 113763 XGE0/7/1 pop inloopback 127.0.0.1 171.3.0.3/32 tunnel-name 363-1.31-8.52.1e1035e7.1 lsp-id 2 ingress 18.2.229.2 egress 171.3.0.3 y1731 114  \n Route(config)#no mpls ilm-entry 113763 XGE0/7/1 id号\n注意：这个id号要到协议栈中去查   \nRoute#sh mpls ilm-table回车\n在显示的很多行中搜索113763这条标签，找到这条ilm 其中INDIX就是他的id号\n3)删除VC实例及与E-lan的绑定关系——参照技术通知V2.1.1删除VPLS节点时的操作配置\n \n4)删除VC 的OAM条目\n Router(config)#no mpls-tp y1731 initiative oam-id 833 \n \n \n \n根因:残留。\n解决方案:清除残留\n原因分类:无\n"}
{"instruction": "R865设备动态RSVP隧道BFD-DOWN告警异常持续问题处理方案。R865设备在V2R6SP3版本下，当动态RSVP隧道的主用或备用路径发生线路中断并修复后存在概率性bfd会话异常无法自动恢复从而导致BFD-DOWN告警异常持续；\n正常状态：\n       当动态RSVP隧道的主用或备用路径发生NNI侧线路光路中断时，此时相应路径上的BFD会话中断，触发BFD-DOWN告警上报并持续，同时RSVP会话状态同步刷新。当NNI侧光路修复后BFD会话重新建立并协商成功，此时故障期间产生的BFD-DOWN告警会伴随着消除；\n异常情况：\n       当动态RSVP隧道的主用或备用路径发生NNI侧线路光路中断并修复后，在光功率、接口协商模式及ISIS/BGP会话正常的情况下，BFD及RSVP会话状态持续处于down状态，且BFD-DOWN告警持续上报（不消除）", "input": "", "output": "案例主题:R865设备动态RSVP隧道BFD-DOWN告警异常持续问题处理方案\n案例编号:AL202210157715\n网络场景:某网络采用R865+R8000-10设备组网，核心汇聚层部署L3层动态协议并建立RSVP-Tunnel\nR865设备版本：V2R6SP3版本\nR8000-10设备版本：V3R2SP7版本\n\n现象描述:R865设备在V2R6SP3版本下，当动态RSVP隧道的主用或备用路径发生线路中断并修复后存在概率性bfd会话异常无法自动恢复从而导致BFD-DOWN告警异常持续；\n正常状态：\n       当动态RSVP隧道的主用或备用路径发生NNI侧线路光路中断时，此时相应路径上的BFD会话中断，触发BFD-DOWN告警上报并持续，同时RSVP会话状态同步刷新。当NNI侧光路修复后BFD会话重新建立并协商成功，此时故障期间产生的BFD-DOWN告警会伴随着消除；\n异常情况：\n       当动态RSVP隧道的主用或备用路径发生NNI侧线路光路中断并修复后，在光功率、接口协商模式及ISIS/BGP会话正常的情况下，BFD及RSVP会话状态持续处于down状态，且BFD-DOWN告警持续上报（不消除）\n处理过程:1、网管界面查询目标网元NNI线路侧光路修复情况，观察接口光功率、协商状态；\n2、设备底层协议栈查询ISIS/BGP/RSVP/BFD协议会话状态；\n3、协议栈登录NP盘查询标签下发错误日志（核实标签冲突情况）；\n4、清除冲突标签；\n5、执行NP盘同步命令，将新生成的标签映射至NP盘生效；\n6、网管界面执行目标网元告警同步操作；\n根因:R865设备在V2R6SP3版本下RSVP分配机制存在软件缺陷；\n场景一：\n目标设备存在标签残留现象，新生成的mpls ilm-table in-label 标签与原有标签冲突\n场景二：\n目标设备无标签残留，新生成的mpls ilm-table in-label 标签未能成功下发至NP盘\n解决方案:方案一：\n1.登录目标设备后转登线路NP盘所在槽位\n在NP盘单盘系统界面，输入“L2VpnPrintErrCfg  5”命令查询错误打印log信息\n将错误打印里RevLabel=后面的参数转化为十进制并记录下来；\n\n记录完成后退出NP盘界面\n2. 登录协议栈输入“show mpls ilm-table in-label 65047  \n注：65047为上步记录的十进制参数\n\n如查询到存在两条或多条入标签一致的条目，即可判定为存在残留；\n（残留确认方法：在主控中show rsvp session，找到入标签为冲突标签的那一条，session中存在的为需要的，不能删除，删除show mpls ilm-table in-label xxxxx中的另一条，一般up-time那一列中时间最长的是残留标签）\n3.删除重复标签\n举例：\nR1#show mpls ilm-table\nCode   In-Label  In-Intf       Out-Label  Out-Intf       Nexthop         FEC                ILM-ID   LSP-Type    LSP-ID  Ingress          Up-Time\nR  >   528385    GE0/9/2        0         inloopback     0.0.0.0          1.1.1.1/32          15    ELSP_CONFIG  1       8.8.8.8          00:03:36\n删除调试命令：\nR1#ilm  ipv4  del rsvp GE0/9/2  528385 1.1.1.1/32 nexthop 0.0.0.0  0 inloopback  pop  ftn-ix 15    //对于ILM类型，如果出接口为inloopback，则为pop，如果有出标签和出接口，则为swap\n如步骤2中的残留标签删除命令如下：\n\n删除完成后，使用show mpls ilm-table in-label xxxxx命令再次确认是否只剩一条表项，如果删除失败，请联系研发。\n4.删除残留的标签后需要把残留标签剩下所需标签对应的rsvp session clear一遍，保证标签能重新下发给单盘。命令如下：clear  rsvp  session  TUNNEL-ID  LSP-ID  INGRESS  EGRESS\n\n\n一般执行完以上步骤后RSVP会话会刷新，异常BFD-DOWN告警即可消失，部分特定情况下少量异常告警仍不会消除，如遇此种情况请执行以下方案二。\n \n方案二：\n1、登录目标设备网元协议栈，对已插NP盘的高速槽位执行如下同步命令；\nrouter#con t\nrouter（config）#tne set-cfg board-addr 2 cfg-id 10\nrouter（config）#tne set-cfg board-addr 2 cfg-id 100\nrouter（config）#exit\nrouter#wri\n说明：命令board-addr 2语句中的数字2表示NP盘槽位，所有已插入NP盘的槽位均需执行上述命令；\n \n2、网管界面同步网元告警。\n \n原因分类:无\n"}
{"instruction": "XSO3板卡故障导致VRRP双主，业务上下行不一致而中断的案例。客户报障：22:27分40余个3GFE业务中断，主要分布于RNC09和RNC41。根据断站清单查找对应接入设备，发现中断站点散布于多个汇聚环，排除接入层和汇聚层问题。", "input": "", "output": "案例主题:XSO3板卡故障导致VRRP双主，业务上下行不一致而中断的案例\n案例编号:AL202210167823\n网络场景:\n场景说明：1、横联7/3和10/3组成lag1(手工非负载分摊)，作为心跳。\n2、RNC主备倒换模式为非恢复式，故障前RNC下行走备用，传输侧上行也会走备用出口，即流量过横联如上图绿线所示。\n现象描述:客户报障：22:27分40余个3GFE业务中断，主要分布于RNC09和RNC41。根据断站清单查找对应接入设备，发现中断站点散布于多个汇聚环，排除接入层和汇聚层问题。\n处理过程:任意找一条中断的业务，从主用落地ping汇聚网关，从汇聚ping无线基站IP，均可以ping通。从落地查业务至基站的私网路由也正常，初步判断分组网内是通的，故障原因可能在落地设备本身或者落地-RNC之间的链路。\n2、网管查看主用落地，发现22:27主落地7槽1口至主核心出现ISIS邻居改变告警，由于告警时间和断站时间几乎一致，怀疑跟故障相关。登录主落地检查ISIS邻居，发现主落地7槽1口至主核心的ISIS中断，10槽1口至备用落地的ISIS邻居正常。\n\n3、网管上检查7槽1口收发光性能和端口状态，发现收发光正常，端口是up,对端主核心互连接口3/1/1收发光和端口状态也均正常。这与ISIS邻居中断不匹配。\n    底层ping对端主核心的互联端口IP，发现ping不通，这与ISIS中断匹配。\n\n检查RSVP隧道，发现主落地7槽1口方向的RSVP down，10槽1口方向的RSVP up，这与ISIS中断是匹配的。此时业务在网内走10槽1口方向。\n\n检查主用落地的BGP会话，发现BGP会话均正常，无刷新。\n综上分析，ISIS邻居中断的原因暂时不明，需继续排查。且ISIS邻居中断不是断站的原因。\n4、考虑故障抢通原则，关断了主落地7槽1口的激光器，发现业务未恢复。将激光器打开后，业务仍然未恢复，且ISIS邻居仍然中断。\n   综合以上4步的排查结果，初步确认业务中断不在落地至核心以下，应该在落地本身或落地-RNC之间。\n5、此时开始排查网间是否有问题，首先检查主备落地和RNC网间互联端口，发现收发光和端口状态也均无问题。\n6、检查VRRP保护，主用落地VRRP保护为master（主用）状态，备用落地VRRP保护为master（主用）状态，该现象不正常，正常只能有一个master。\n7、1月31日0:13，尝试优先恢复业务，考虑VRRP主用路由器只能有1个，由于备用落地也是master状态，怀疑主用落地有问题，未能成功降级为备用，故决定先关闭主用落地出接口，让网间业务走备用方向。先关闭与RNC09的互联端口GE0/3/1，发现业务未恢复。\n8、1月31日0:25，将主落地GE0/3/1端口打开，关闭备用落地出接口GE0/3/1，确认RNC09业务恢复。关闭备用落地出接口GE0/14/4，确认RNC41业务恢复。\n9、此时可以断定是VRRP状态异常是业务中断的直接原因，且故障前这两个RNC走备用端口下行。继续排查导致VRRP状态异常的原因。此时检查主备VRRP保护的track BFD，发现该BFD down.且时间和断站时间吻合。\n\n10、检查bfd关联的端口L3VE口 ip配置和lag1信息,发现lag1成员口为7/3、10/3，其中7/3口为主用接口。且ping L3VE的对端IP均不通。\n\n\n此时怀疑7槽3口也有问题，检查7槽3口收发光，发现收发光正常，端口状态up。决定关断7/3口，使lag口切换至10/3。关断后，trackBFD变为up，备用落地VRRP角色变为backup(备用)。\n\n此时确定7/3端口存在问题。\n    检查7槽在用的7/1、7/2、7/3的端口收发包和收发速率，以及mcc的ospf邻居,发现均存在问题。\n\n\n登录7槽位XSO3单盘底层芯片发现，端口转发芯片持续打印timeout,已无法响应业务流转发。\n\n此时可以确认7槽板卡存在问题。\n11、为避免隐患进一步影响业务运行，决定将其复位。复位后，端口收发速率恢复正常。但存在隐患，最终需更换板卡。\n \n根因:本次故障主要由主落地7槽位XSO3盘端口转发芯片故障引起。端口转发芯片出现故障后，无法响应业务数据包的转发请求，此时可见端口状态中收发速率为0。\nVRRP保护的主备路由器通过横联lag1口传递信令，该横联通道使能trackBFD检测，trackBFD的up/down即作为VRRP倒换侧触发条件。\n当lag1的主用成员口7/3发生异常时，由于7/3端口异常后仍保持up状态，lag并未切换至备用成员口10/3，导致主备落地的trackBFD信令通信失败，trackBFD down。track BFD down后,备用落地认为主用落地节点已经失效，直接升主master.\n由于RNC09/41均工作在备用，RNC均通过备用下行口收发，对接备用落地，RNC至主用落地均不再收发。\n下行路径如右图蓝线所示，是正常的。下行完整路径为：RNC—备落地—备核心—备汇聚—主汇聚—接入设备—无线基站。\n上行路径如右图绿线所示，流量到达主落地后，横联中断，且RNC工作在备用，主用不收发包，主落地不会学到RNC主用端口的MAC地址表，所以数据包在主落地丢弃，上行中断，业务中断。\n正常状态下，上下行路径一致，如左图所示。\n故1月31日0:13分关闭主用落地出接口，效果如图二所示，此时业务不会恢复。\n \n\n                   图一                                                           图二\n其他RNC业务未受影响的原因分析:\n（1）其他RNC均工作在主用，传输正常时，上下行路径一致，如左图所示。\n（2）主落地的7槽位故障时，传输内部RSVP tunnel切换至备用通道，上下行路径如右图所示。即使横联中断，备用落地抢主形成VRRP双主，但传输上行VPNFRR未发生倒换，上行还是发到主用落地，故不影响上下行路径。\n\n                  图三                                                             图四\n故1月31日0:25分关闭备用落地出接口，此时RNC切换至主用，如图四，业务恢复。\n解决方案:1、由于RNC的倒换为非恢复式，为避免RNC工作在备用状态，VRRP工作在主用落地，流量过横联，路径为长路径，隐患点增多，为降低网络运行风险，将RNC主备工作状态检查纳入常态巡检，发现RNC工作在备用时，申请割接时间关断传输备用出接口，将使RNC倒回主用。或RNC主备倒换模式改为恢复式。\n2、将横联心跳lag改为lacp负载分摊模式，成员口使能linkbfd，使一个成员口出问题时，可以迅速切换至其他成员口。\n3、梳理完善现网单盘失效且无告警影响业务的场景，制定案例作为故障应急处置方案，提高故障恢复的效率。\n原因分类:无\n"}
{"instruction": "某运营商集团应用探针pppoeuptime考核后中断时长数据异常。某运营商应用集团IHGU软探针上报数据,利用pppoeuptime字段计算用户中断时长,发现某一日中断表现增加30倍（平日0.4X，这一日直接增加12），经排查烽火占比50%以上,且集中在HG6543C4上\n\n", "input": "", "output": "案例主题:某运营商集团应用探针pppoeuptime考核后中断时长数据异常\n案例编号:AL202210188092\n网络场景:\n现象描述:某运营商应用集团IHGU软探针上报数据,利用pppoeuptime字段计算用户中断时长,发现某一日中断表现增加30倍（平日0.4X，这一日直接增加12），经排查烽火占比50%以上,且集中在HG6543C4上\n\n\n处理过程:1：根据集团计算中断时长算法，明确出pppoeuptime是基于用户拨号开始计算中，直到拨号结束时间一直增加;\n当前消息bootTime和前一条消息bootTime时间差在2min内则判断为未重启；如果超过2min则认为数据异常。由于设备上电后bootTime一直不变，所以只有设备重启才会发生变化。插件异常重启（设备未重启）bootime时间不变\r\n        a) 未发生重启：\r\n       中断时长 = 本次上报时间actualTime  - 上次上报时间actualTime  - 本次上报 PPPOE连接时长PPPOEUpTime -10min\r\n       说明：（本次上报时间actualTime  - 上次上报时间actualTime）==10min。如果上述等式为负值，一般是设备出现PPP掉线，导致有两个以上的周期无法上报，（本次上报时间actualTime  - 上次上报时间actualTime）为N min，而且PPP在线时间清零在开始计数小于（N-10）min。\r\n        如果PPP掉线后，bootTime 不变，（本次上报时间actualTime  - 上次上报时间actualTime）值变大，而且PPP重新计数，导致计算出来的结果为正值，则作为异常数据\r\n        b) 发生重启：\r\n       中断时长 = 本次上报时间actualTime - 本次上报重启时间bootTime - 本次上 报PPPOE连接时长PPPOEUpTime - 10min\r\n           说明：（本次上报时间actualTime - 本次上报重启时间bootTime）= devruntime设备运行时间（该数据光猫上报），PPP拿地址后开始计数，当设备启动拿地址的时间超过2min，则被认为试一次数据异常\n2：根据pppoeuptime原理分析可能因素有1,用户时间拨号中断,2,IHGU终端软件无法取到pppoeuptime,3,IHGU在某个场景下触发pppoeuptime更新;\n3：针对可能原因，根据集团给出的每台每天中断用户时长和次数与3Apppoe话单进行匹配（此类话单是bras判定用户是否真实中断依据）排除掉真实用户中断数据。\n4：针对在3apppoeuptime话单没有中断但是pppoeuptime时间异常设备，提取一天上报中断次数多的用户，现场抓软探针日志（10分钟一次），发现pppoeuptime忽高忽低。\n\n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n5：针对此用户现场抓包和日志定位，用户pppoeuptime变化与IPV6地址续租有相关性，抓包限制每次续租会出现pppoeuptime变更。\n\n \n \n \n \n \n \n \n \n \n \n \n6：研发代码分析，目前HG6543C4判定pppoeuptime是根据是否ip地址信息变化（ip,dns,ipv6 前缀，ipv6dns）只要这个有一项变化pppoeuptime就会变化，这些信息在模块之间传递中处理有些不同，如当IPV6DNS获取只有一个情况，第二个传递在传递过程是用null字符代替而非空，本地存储为空与null字符比较时代码就判定地址信息变化，导致误认为ip变化引起了pppoetime重置。这种在极端情况（到软探针平台网络不同或者丢包严重情况下)会出现数据剧烈波动（30分钟更新一次地址）。\n \n7：对全省所有HG6543C4异常终端排查，匹配3a话单没有中断，但是pppoeuptime有非连续变化，发现主要集中在中兴bras下，少量在华为bras，协调两家bras修改拨号地址中增加一个备用ipv6dns参数，同时将HG6543C4重启，出现这种异常用户降低90%。\n \n8：针对余下的10%再次聚类分析，发现有5%左右跟HG6543C4非最新版本有关，通过比较这些IHGU在rms最新上线时间与IHGU在OLT在线状态比较发现有3%的终端是rms不在线OLT是在线。\n \n9：选取两个IHGU在现场排查是OLT对IHGU管理通道配置存在问题（漏做或者配置错误）\n \n10：协调友商对这些IHGU的rms通道重新做配置（一般推荐根据比对出结果利用TL1批量配置指令重新删除重做）\n \n \n \n根因:HG6543C4软件判定逻辑缺陷，pppoeuptime是根据是否ip地址信息变化（ip,dns,ipv6 前缀，ipv6dns）只要这个有一项变化pppoeuptime就会变化，这些信息在模块之间传递中处理有些不同，如当IPV6DNS获取只有一个情况，第二个传递在传递过程是用null字符代替而非空，本地存储为空与null字符比较时代码就判定地址信息变化，导致误认为ip变化引起了pppoetime重置\n解决方案:最终解决方案\n升级HG6543C4到2022年9月29日以后版本\n \n临时解决方案\n1：非2021年统一版本升级到2021年统一版本\n2：bras侧修改ipv6dns地址池为主备两个，同时重启终端\n \n原因分类:无\n"}
{"instruction": "某地返修5006-10B私网IP不通问题。某地EPON工程现场，局端OLT设备为AN5516-01,ONU为AN5006-10B，最近返修了一端AN5006-10B，收到该设备时发现可以授权，但私网通信不通，而且24个FE端口除FE1外工作灯都不正常，其他23个端口连上PC机后本地连接一直是中断状态。", "input": "", "output": "案例主题:某地返修5006-10B私网IP不通问题\n案例编号:AL2023041712112\n网络场景:\n现象描述:某地EPON工程现场，局端OLT设备为AN5516-01,ONU为AN5006-10B，最近返修了一端AN5006-10B，收到该设备时发现可以授权，但私网通信不通，而且24个FE端口除FE1外工作灯都不正常，其他23个端口连上PC机后本地连接一直是中断状态。\n处理过程:由于刚出现该问题时认为是设备返修未完全修好，于是更换了1端AN5006-10B但仍然私网通信不通，语音和数据均开不通。于是在10B现场通过串口线登录设备，在system目录下ifshow查看4087和4089 VLAN对应的IP。若是私网不通，4087和4089的VLAN是获取不到私网IP的，正常的设备显示如下：system> ifshoweth0      Link encap:Ethernet  HWaddr 00:0A:C2:12:8E:D8          UP BROADCAST RUNNING  MTU:1500  Metric:1          RX packets:1305693 errors:0 dropped:0 overruns:0 frame:0          TX packets:158452 errors:0 dropped:0 overruns:0 carrier:0          collisions:0 txqueuelen:1000          RX bytes:81850315 (78.0 MiB)  TX bytes:14118665 (13.4 MiB)          Interrupt:1 eth1      Link encap:Ethernet  HWaddr 00:1A:1B:1C:1D:1E          UP BROADCAST RUNNING NOARP  MTU:1500  Metric:1          RX packets:767 errors:0 dropped:0 overruns:0 frame:0          TX packets:377 errors:0 dropped:0 overruns:0 carrier:0          collisions:0 txqueuelen:1000          RX bytes:26032 (25.4 KiB)  TX bytes:21100 (20.6 KiB)          Interrupt:1 lo        Link encap:Local Loopback          inet addr:127.0.0.1  Mask:255.0.0.0          UP LOOPBACK RUNNING  MTU:16436  Metric:1          RX packets:61916 errors:0 dropped:0 overruns:0 frame:0          TX packets:61916 errors:0 dropped:0 overruns:0 carrier:0          collisions:0 txqueuelen:0          RX bytes:4218566 (4.0 MiB)  TX bytes:4218566 (4.0 MiB) vlan1160  Link encap:Ethernet  HWaddr 00:0A:C2:12:8E:D8          inet addr:10.40.100.115  Bcast:10.255.255.255  Mask:255.255.255.0          UP BROADCAST RUNNING  MTU:1500  Metric:1          RX packets:1201895 errors:0 dropped:0 overruns:0 frame:0          TX packets:59366 errors:0 dropped:0 overruns:0 carrier:0          collisions:0 txqueuelen:0          RX bytes:57049756 (54.4 MiB)  TX bytes:6978648 (6.6 MiB) vlan4087  Link encap:Ethernet  HWaddr 00:0A:C2:12:8E:D8          inet addr:10.25.105.70  Bcast:10.255.255.255  Mask:255.255.255.255          UP BROADCAST RUNNING  MTU:1500  Metric:1          RX packets:20660 errors:0 dropped:0 overruns:0 frame:0          TX packets:20612 errors:0 dropped:0 overruns:0 carrier:0          collisions:0 txqueuelen:0          RX bytes:1046611 (1022.0 KiB)  TX bytes:1051274 (1.0 MiB) vlan4089  Link encap:Ethernet  HWaddr 00:0A:C2:12:8E:D8          inet addr:10.26.105.70  Bcast:10.255.255.255  Mask:255.255.255.255          UP BROADCAST RUNNING  MTU:1500  Metric:1          RX packets:20812 errors:0 dropped:0 overruns:0 frame:0          TX packets:77843 errors:0 dropped:0 overruns:0 carrier:0          collisions:0 txqueuelen:0          RX bytes:997880 (974.4 KiB)  TX bytes:6054921 (5.7 MiB) vlan4092  Link encap:Ethernet  HWaddr 00:0A:C2:12:8E:D8          inet addr:192.168.0.1  Bcast:192.168.0.255  Mask:255.255.255.255          UP BROADCAST RUNNING  MTU:1500  Metric:1          RX packets:62329 errors:0 dropped:0 overruns:0 frame:0          TX packets:634 errors:0 dropped:0 overruns:0 carrier:0          collisions:0 txqueuelen:0          RX bytes:4476498 (4.2 MiB)  TX bytes:33996 (33.1 KiB)\n根因:故障原因是检修过程中ONU的4087与4089私网通信VLAN被关闭，且检修后也没将VLAN打开，导致现场ONU业务不通， VLAN关闭的原因是：芯德开发的设备，需要自己在设备跑一个脚本导致的，它需要通过这个脚本对设备进行出厂前的检查，但是检查完之后没有还原默认配置导致主从通信出现问题。ODM厂家在测试时，测试脚本会在测试过程中将VLAN关掉，但会在测试完成后恢复默认设置，测试过程必须跑完整个脚本即自动重启后才能断电，否则即有可能没有恢复到默认设置，因此该问题实际上是操作人员没有待其自动重启就过早关电导致其未恢复出厂配置引起的。后续在测试VOIP跑脚本时会有一次恢复出厂设置的动作，后面会在包装前一个工序check mac时增加恢复出厂设置以及检查VLAN的指令并固化在自动化装备软件中，防止上个工序的人为操作问题导致不良品。\n解决方案:若是VLAN被关闭了，可以如下命令打开VLANnetwork> vlan此命令以互动方式进行设置，不用参数。当执行命令后，CLI会显示当前VLAN的开关状态，然后询问用户要开启还是关闭，例如：Current VLAN is disabledVLAN enable [y/n]：y此时用户只能输入“y”或“n”字符，大小写不区分。“y”表示开启，“n”表示关闭。输入y后开启VLAN。\n原因分类:无\n"}
{"instruction": "某地市烽火OLT下挂高带宽用户测速不达标。客户反馈我司OLT下挂部分高带宽用户投诉宽带速率达不到标称值。经过现场测试发现，100M带宽实际测速上行只有100-200KB/s，下行只有3-4M/s，相当于20-30M带宽。", "input": "", "output": "案例主题:某地市烽火OLT下挂高带宽用户测速不达标\n案例编号:AL202210319712\n网络场景:OLT通过聚合组上联汇聚交换机，下挂HGU，HGU带宽带、语音和IPTV业务。\n现象描述:客户反馈我司OLT下挂部分高带宽用户投诉宽带速率达不到标称值。经过现场测试发现，100M带宽实际测速上行只有100-200KB/s，下行只有3-4M/s，相当于20-30M带宽。\n处理过程:1、接到客户故障反馈以后，登录到网管查看发现，故障用户所在OLT的上联口上下行带宽利用率，pon口上下行带宽利用率均未超过40%（其中上行带宽利用率均未超过10%），并且故障发生时OLT的CPU利用率和内存利用率均未超过20%，均在正常范围以内。\n2、查看故障用户设备限速，发现该设备限速模式为对整台HGU用户限速，限速模板为10240k_204800k，即上行10M下行200M，符合省公司要求。将该设备限速取消，即恢复默认上行1000M下行1000M，现场测速依然不达标。后来重启业务板之后，再测速用户上行可以达到1M/s，下行可达7M/s以上，符合带宽速率要求。\n3、2日后客户反馈之前重启业务板恢复的用户又报故障，表明重启业务板只能暂时恢复，并不能彻底解决问题，随后赶往现场处理此问题。\n4、我们与客户维护人员一起去故障用户家里测试，发现将用户设备从网管去授权之后重新注册，不对其下发限速模板，即保持默认值上下行均为1000M，此时测速达标，再对该设备下发10240k_204800k的限速模板，测速不达标。再将ONU限速改为默认值（即上下行1000M），测速依然不达标。反复测试结果依然如此。\n5、鉴于此测试结果，怀疑为限速模板的问题，随后在客户机房下挂测试设备，反复修改ONU限速模板，测试上下行速率，未发现不达标情况，证明限速模板不一定会引发用户上网速度不达标。\n6、次日到用户报故障的OLT抓包，分别对线卡镜像抓包、用户下载时线卡镜像抓包，上联口镜像抓包，用户下载时用户镜像抓包。针对抓取的报文分析，初步判断可能与DBA调度有关。\n7、公司研发在总部进行实验，通过交换设置FP规则，对特定用户MAC地址的报文进行计数，同时将出现问题PON口的其他ONU的link全部去使能，对下行报文统计进去确认，发现下行方向，从交换XE0口进来的报文，到ONU UNI口出口的报文，计数只有个位数的差异，所有中间节点上统计也没有发现有丢包的统计，基本确认下行发现没有丢包；随后对上行，先设置纯TDM模式，给该ONU上行分配固定的15M带宽，用户测试正常。基本确定与上行DBA调度有关。之后通过网管配置DBA模板，将该ONU上行方向最小带宽从之前的640Kbps分别调整到2Mbps，8Mbps，15Mbps，其他不变（上行最大仍然为15Mbps，下行最小640Kbps，最大100Mbps），用户下载速率分别达到70M，93M，95M。最终，通过选择设置上行最小带宽为8Mbps，进行多次测试均可以满足测速需求，确认与芯片DBA调度有关系。 \n8、根据在总部搭环境测试结果，研发给出补丁，对客户全网板卡打补丁之后，未再收到用户报故障。\n根因:1、用户测试不达标，实际是由于现场版本PON芯片DBA的特性以及FTP下载文件需要特殊交换特殊性决定的； 如果单以仪表打数据流，8个ONU，每个ONU 100M完全没有问题；对于FTP传输的速率主要是由于在FTP下载时，上行方向用户需发送短小的应答报文， FTP服务器收到该应答报文后，下行的数据流才能继续发送给用户。而上行方向，OLT存在2个时机给ONU分配带宽：\n① ONU会根据自己队列缓存的数据，当其队列缓存的数据大于一个自定义的门限值时（目前我司ONU默认都是16KBytes），就会向OLT上报Report报文申请带宽，OLT根据ONU请求的带宽分配相应的时隙，以便ONU发送上行数据；\n② 同时 OLT 也会定时主动轮询下面ONU的每个链路（根据COS值，分为8个等级），以便维持基本的OAM和链路开销；而这个轮询间隔也就是下面网管设置的轮询速率。 ONU在接收到这个轮询的请求后，就会将当前队列中的数据上报给OLT。默认情况下，这个轮询间隔是4ms，但是软件设置会存在误差。\n由于FTP传输时，上行ONU的Queue的门限值较小，因而实际上都是通过OLT 轮询来给ONU分配上行时隙，从而影响实际的下载速率。实际上，当用户上行数据流增大时，下行的下载速率反而相应的会提高；\n结合上面的问题原因，该问题最终结论如下：\n由于每个ONU上报Report的门限值不同，且由于FTP本身交互的特殊性，本次OLT PON芯片固件的更新，时延与上一版本有了1ms增加，导致FTP交互时速率下降。\n该问题是由于随着时延增加，而ONU的上行最小保证带宽只有640K，在FTP传输时，上行最小的保证带宽无法满足FTP下载的实时性要求，增加OLT上行的最小保证带宽，使之ONU上行每次可以获取足够的带宽，保证FTP下载时的实时要求，减小因DBA时延产生的负面影响。\n   2、此问题现网都存在。上行最小保证带宽是在上行带宽不够的时候所分配的，且带宽分配是个动态过程，并不固定，所以下挂设备少或者线卡刚启动的时候该问题暴露不出来，随着下挂的业务量逐渐增大，当大带宽下载的用户突发下载时，匹配的上行带宽不足，问题才会出现，并不是所有用户都会出现这个问题，有部分用户推测是没关注或者没上报。\n解决方案:公司紧急出补丁，对现网所有线卡加载补丁（RP0700SP1,编译时间2015.12.22）\n原因分类:无\n"}
